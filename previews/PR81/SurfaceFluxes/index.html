<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Equations · SurfaceFluxes.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">SurfaceFluxes.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../References/">References</a></li><li class="is-active"><a class="tocitem" href>Equations</a><ul class="internal"><li><a class="tocitem" href="#Surface-Fluxes"><span>Surface Fluxes</span></a></li></ul></li><li><a class="tocitem" href="../UniversalFunctions/">Universal Functions</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Equations</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Equations</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/CliMA/SurfaceFluxes.jl/blob/main/docs/src/SurfaceFluxes.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h2 id="Surface-Fluxes"><a class="docs-heading-anchor" href="#Surface-Fluxes">Surface Fluxes</a><a id="Surface-Fluxes-1"></a><a class="docs-heading-anchor-permalink" href="#Surface-Fluxes" title="Permalink"></a></h2><h3 id="Monin-Obukhov-Similarity-Theory-(MOST)"><a class="docs-heading-anchor" href="#Monin-Obukhov-Similarity-Theory-(MOST)">Monin-Obukhov Similarity Theory (MOST)</a><a id="Monin-Obukhov-Similarity-Theory-(MOST)-1"></a><a class="docs-heading-anchor-permalink" href="#Monin-Obukhov-Similarity-Theory-(MOST)" title="Permalink"></a></h3><p>Surface fluxes of momentum, energy and moisture are computed using the Monin-Obukhov Similarity Theory (MOST), which follows from dimensional analysis and similarity laws in stratified boundary layers. The theory gives the fluxes in an unresolved surface layer based on the self-similarity of stratified boundary layers, and can be used to compute exchange coefficients for bulk-formulae for the fluxes at the bottom boundary in simulations of the atmosphere. The MOST similarity profiles depend on one length scale, given by the ratio of velocity and buoyancy scales and known as the Obukhov length:</p><p class="math-container">\[\begin{equation}
\label{eq:monin_obukhov_length}
L_O =  \frac{u_{\star}^2 }{\kappa b_{\star}}.
\end{equation}\]</p><p>Here, <span>${\star}$</span> subscripts indicate a characteristic physical scale of the variable in question in the surface layer. The buoyancy (<span>$b$</span>) is defined as</p><p class="math-container">\[\begin{equation}
b = g \frac{\mathrm{DSE}_v&#39;}{\mathrm{DSE}_v},
\end{equation}\]</p><p>with <span>$\mathrm{DSE}_v&#39;$</span> as the perturbation from a reference virtual dry static energy value, <span>$\mathrm{DSE}$</span>. These mean and perturbation quantities are implicit in the model and can be used to compute the relation between <span>$b_{\star}$</span> and <span>$\phi_{\star}$</span>, where <span>$\phi$</span> represents a thermoynamic scale variable. Following equations (8) and (9) in \citep{Nishizawa18a} we write the physical scale for such a variable <span>$\phi$</span> as:</p><p class="math-container">\[\begin{equation}
\label{eq:thermodynamic_scale}
\phi_{\star} = \frac{\kappa / Pr}{F_h(\Delta z,z_{0\phi}, L_O)} \Delta \phi,
\end{equation}\]</p><p>and a corresponding momentum scale is given by:</p><p class="math-container">\[\begin{equation}
\label{eq:u_star}
u_{\star} = \frac{\kappa}{F_m(\Delta z,z_{0m}, L_O)} \Delta u.
\end{equation}\]</p><p>Here <span>$\kappa = 0.4$</span> is the von-Karman constant, <span>$Pr$</span> is the Prandtl number and <span>$\Delta$</span> corresponds to the difference in values between the two input heights (i.e. <span>$\Delta u = u(z_{in}) - u(z_{srf})$</span>). The formulation of <span>$F_m$</span> and <span>$F_h$</span> is subjective to the choice of discretization as shown in \citep{Nishizawa18a}. In the typical finite-difference form: </p><p class="math-container">\[\begin{equation}
F_h^{(FD)} = \log \left(\frac{\Delta z}{z_{0b}} \right) - \psi_h \left(\frac{\Delta z}{L_O} \right) + \psi_h \left(\frac{z_{0b}}{L_O} \right),
\end{equation}\]</p><p>and </p><p class="math-container">\[\begin{equation}
F_m^{(FD)} = \log \left(\frac{\Delta z}{z_{0m}} \right) - \psi_m \left(\frac{\Delta z}{L_O} \right) + \psi_m \left(\frac{z_{0m}}{L_O} \right).
\end{equation}\]</p><p>Subscripts <span>$h, m$</span> are used to represent the equations corresponding to the exchange of heat and momentum respectively. The characteristics of tracer diffusion are assumed to be identical to those of the thermal diffusion in this system. The expressions for <span>$\psi_m$</span> and <span>$\psi_h$</span> are defined in appendix A in \citep{Nishizawa18a} for various universal functions. Our current approach uses the Businger universal functions by default. </p><p>The correction for the finite volume form <span>$F_h, F_m$</span> are given respectively as:</p><p class="math-container">\[\begin{equation}
F_h^{(FV)} = \log \left(\frac{\Delta z}{z_{0b}} \right) - \Psi_h \left(\frac{\Delta z}{L_O} \right) + \frac{z_{0b}}{\Delta z} \Psi_h \left(\frac{z_{0b}}{L_O} \right) + R_{z0h}\left[\Psi_h \left(\frac{z_{0b}}{L_O} \right) - 1\right]
\end{equation}\]</p><p>and </p><p class="math-container">\[\begin{equation}
F_m^{(FV)} = \log \left(\frac{\Delta z}{z_{0m}} \right) - \Psi_m \left(\frac{\Delta z}{L_O} \right) + \frac{z_{0m}}{\Delta z} \Psi_m \left(\frac{z_{0m}}{L_O} \right) + R_{z0m}\left[\Psi_m \left(\frac{z_{0m}}{L_O} \right) - 1\right],
\end{equation}\]</p><p>with <span>$\Psi_m$</span> and <span>$\Psi_h$</span> as the FV corrected form. Their expressions are found in appendix A in \citep{Nishizawa18a} and here as well we use the Businger universal functions formulation as a default. </p><p>Note that both <span>$F_h$</span> and <span>$F_m$</span> (for FV and FD) are functions of known parameters (<span>$z_{0b}, z_{0m}, \Delta z$</span>) and <span>$L_O$</span> only. Furthermore we can compute <span>$b_{\star}$</span> from the known thermodynamic states. This fact makes (1) a transcendental equation with <span>$L_O$</span> as the only unknown. A numerical solver that iterate over <span>$L_O$</span> can thus find the value for which the error in (1) is smaller than some desired tolerance. </p><p>The most direct computation of <span>$b_{\star}$</span> follows by writing (3) for virtual dry static energy and multiplying by a <span>$(g/\mathrm{DSE}_v)$</span> factor:</p><p class="math-container">\[\begin{equation}
b_{\star} = \frac{g}{ \mathrm{DSE}_v }\frac{\kappa / Pr}{F_h(z,z_{0b}, L_O)} \Delta \mathrm{DSE}_v,
\end{equation}\]</p><p>with <span>$\Delta \mathrm{DSE}_v$</span> computed from the thermodynamic states at the corresponding levels. This approach forces us to assume that the various scalars that take part in the virtual dry static energy has the same roughness length <span>$z_{0b}$</span> but provides a straightforward implementation where any tracer (humidity or other) which plays a role in the virtual dry static energy of air is accounted for in the computation of <span>$L_O$</span>. </p><p>An alternative method common in atmospheric models, is to write <span>$b_{\star}$</span> using the definition of virtual potential temperature as:</p><p class="math-container">\[\begin{equation}
b_{\star} = (1+(\eps_{dv}-1) q_t ) \theta_{\star} +  (\eps_{dv}-1) \theta q_{t,\star},
\end{equation}\]</p><p>with <span>$\theta_{\star}$</span> and <span>$q_{t,\star}$</span> given by (3). Here separate roughness lengths can be assumed for heat and humidity but the implementation would have to change if any additional scalar is added to the air density. For these reasons we implement (10). </p><p>The flux from the top of the boundary layer is given by:</p><p class="math-container">\[\begin{equation}
\overline{w&#39;u&#39;} = - u_{\star}^2,
\end{equation}\]</p><p class="math-container">\[\begin{equation}
\overline{w&#39;\phi&#39;} = - u_{\star} \phi_{\star},
\end{equation}\]</p><p>which could be viewed as alternatives to bulk formula expressions for the sensible and latent heat fluxes if the physical scales are known. Correspondingly, the ratios between the physical scale and its change in the surface layer provides and expression for the exchange coefficient:</p><p class="math-container">\[\begin{equation}
    C_{m} = \frac{u_{\star}^2}{\Delta u^2},
\end{equation}\]</p><p class="math-container">\[\begin{equation}
\label{eq:exchange_coeff_scalar}
    C_{\phi} = \frac{u_{\star} \phi_{\star}}{\Delta u \Delta\phi}.
\end{equation}\]</p><p>Equations (13) and (14) are singular if <span>$\Delta u = 0$</span>, and typically a gustiness parameter <span>$w_{\star}$</span> is added to represent the SGS convective velocity and avoid this singularity. A typical formulation for gustiness is </p><p class="math-container">\[\begin{equation}
    w_{\star} = \left(\overline{w&#39;b&#39;} h_{fc} \right)^{\frac{1}{3}},
\end{equation}\]</p><p>here <span>$h_{fc}$</span> is the height of free convection, a non local estimation of the maximum height (above the surface layer) possible of convective motions based on the atmospheric profile. This formulation of gustiness requires a priori knowledge of the surface fluxes and thus can only be used in cases with prescribed fluxes. More generally gustiness is often taken to be a some assumed constant based on scaling arguments.</p><p>At the same time equation (14) is also singular if <span>$\Delta\phi = 0$</span>. If <span>$\phi$</span> corresponds to buoyancy (<span>$\mathrm{DSE}_v$</span>) then the conditions are neutral, and the buoyancy flux is zero. <span>$L_O$</span> is set to infinity, and the momentum exchange coefficient and heat exchange coefficient are given by the law of the wall:</p><p class="math-container">\[\begin{equation}
C_{m,N} = \left( \frac{\kappa}{ln [\Delta z/z_{0m}]} \right)^2.
\end{equation}\]</p><p class="math-container">\[\begin{equation}
C_{\phi,N} = \frac{\kappa^2}{ln [\Delta z/z_{0b}] ln [\Delta z/z_{0m}]}.
\end{equation}\]</p><p>In neutral conditions  Once the surface conditions are known, the computation of the profile of any variable within the surface layer (for any <span>$z_{sfc} &lt; z &lt; z_{in}$</span>) is done by rewriting (3) and (4) as:</p><p class="math-container">\[\begin{equation}
\phi(z) = \phi_{\star}\frac{F_h(z,z_{0\phi}, L_O)}{\kappa / Pr}  + \phi_{sfc},
\end{equation}\]</p><p class="math-container">\[\begin{equation}
u(z) = u_{\star} \frac{F_m(z,z_{0m}, L_O)}{\kappa} + u_{sfc},
\end{equation}\]</p><p>with <span>$\phi_{\star}$</span> and <span>$u_{\star}$</span> given by (3) and (4) respectively. Here, the same choice of discretization should be used for <span>$F_h$</span> and <span>$F_m$</span> as used to obtain the surface conditions. </p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../References/">« References</a><a class="docs-footer-nextpage" href="../UniversalFunctions/">Universal Functions »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.23 on <span class="colophon-date" title="Thursday 12 January 2023 21:40">Thursday 12 January 2023</span>. Using Julia version 1.8.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
