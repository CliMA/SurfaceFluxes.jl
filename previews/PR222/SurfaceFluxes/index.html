<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Surface Fluxes Theory · SurfaceFluxes.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="SurfaceFluxes.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">SurfaceFluxes.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li class="is-active"><a class="tocitem" href>Surface Fluxes Theory</a><ul class="internal"><li><a class="tocitem" href="#Monin-Obukhov-Similarity-Theory"><span>Monin-Obukhov Similarity Theory</span></a></li><li><a class="tocitem" href="#The-Iterative-Solver"><span>The Iterative Solver</span></a></li><li><a class="tocitem" href="#Discretization-Schemes"><span>Discretization Schemes</span></a></li><li><a class="tocitem" href="#Profile-Recovery"><span>Profile Recovery</span></a></li><li><a class="tocitem" href="#References"><span>References</span></a></li></ul></li><li><a class="tocitem" href="../UniversalFunctions/">Universal Functions</a></li><li><a class="tocitem" href="../PhysicalScales/">Physical Scales</a></li><li><a class="tocitem" href="../ExchangeFluxes/">Exchange Fluxes</a></li><li><a class="tocitem" href="../PrescribedConditions/">Prescribed Conditions</a></li><li><a class="tocitem" href="../TestSuite/">Test Suite</a></li><li><a class="tocitem" href="../API/">API Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Surface Fluxes Theory</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Surface Fluxes Theory</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/CliMA/SurfaceFluxes.jl/blob/main/docs/src/SurfaceFluxes.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Surface-Fluxes-Theory"><a class="docs-heading-anchor" href="#Surface-Fluxes-Theory">Surface Fluxes Theory</a><a id="Surface-Fluxes-Theory-1"></a><a class="docs-heading-anchor-permalink" href="#Surface-Fluxes-Theory" title="Permalink"></a></h1><p>SurfaceFluxes.jl calculates turbulent surface fluxes using <strong>Monin-Obukhov Similarity Theory (MOST)</strong>. This theory allows us to estimate the fluxes of momentum, heat, and moisture from the mean vertical gradients of wind speed, potential temperature, and specific humidity in the surface layer.</p><h2 id="Monin-Obukhov-Similarity-Theory"><a class="docs-heading-anchor" href="#Monin-Obukhov-Similarity-Theory">Monin-Obukhov Similarity Theory</a><a id="Monin-Obukhov-Similarity-Theory-1"></a><a class="docs-heading-anchor-permalink" href="#Monin-Obukhov-Similarity-Theory" title="Permalink"></a></h2><p>The central hypothesis of MOST is that in the surface layer, turbulent fluxes are approximately constant with height and characterized by a single length scale, the <strong>Obukhov length</strong> (<span>$L$</span>), defined as</p><p class="math-container">\[ L = - \frac{u_*^3}{\kappa B},\]</p><p>with</p><ul><li>the friction velocity (scaling velocity) <span>$u_*$</span>,</li><li>the von Kármán constant (<span>$\kappa \approx 0.4$</span>), and</li><li>the surface buoyancy flux <span>$B$</span>.</li></ul><p>The Obukhov length <span>$L$</span> is a dimensionless quantity that characterizes the stability of the surface layer:</p><ul><li><strong>Neutral (<span>$L \to \infty$</span>):</strong> Shear production of turbulence dominates (<span>$B \to 0$</span>).</li><li><strong>Stable (<span>$L &gt; 0$</span>):</strong> Surface cooling, turbulence is suppressed by negative buoyancy (<span>$B &lt; 0$</span>).</li><li><strong>Unstable (<span>$L &lt; 0$</span>):</strong> Surface heating, turbulence is generated by positive buoyancy (<span>$B &gt; 0$</span>).</li></ul><p>The dimensionless stability parameter <span>$\zeta$</span> is defined as</p><p class="math-container">\[ \zeta = \frac{z - d}{L},\]</p><p>where <span>$z$</span> is the height above the surface and <span>$d$</span> is the displacement height. In stable conditions, <span>$L &gt; 0$</span> and <span>$\zeta &gt; 0$</span>, while in unstable conditions, <span>$L &lt; 0$</span> and <span>$\zeta &lt; 0$</span>. The displacement height <span>$d$</span> is a parameter that accounts for the apparent upward &quot;displacement&quot; of the surface due to roughness elements (e.g., vegetation, buildings, etc.)</p><h3 id="Similarity-Relations"><a class="docs-heading-anchor" href="#Similarity-Relations">Similarity Relations</a><a id="Similarity-Relations-1"></a><a class="docs-heading-anchor-permalink" href="#Similarity-Relations" title="Permalink"></a></h3><p>The vertical gradients of mean variables are related to their surface fluxes through universal stability functions <span>$(\phi_m, \phi_h)$</span>,</p><p class="math-container">\[ \frac{\kappa (z-d)}{u_*} \frac{\partial u}{\partial z} = \phi_m(\zeta)\]</p><p>and</p><p class="math-container">\[ \frac{\kappa (z-d)}{\theta_*} \frac{\partial \theta}{\partial z} = \phi_h(\zeta),\]</p><p>where <span>$\theta_*$</span> is the potential temperature scale. Similar relations hold for specific humidity (<span>$q$</span>) and other scalars.</p><p>Integrating these relations yields the profiles for wind speed and potential temperature, which are used to relate surface values to interior values (at height <span>$\Delta z$</span>).</p><h2 id="The-Iterative-Solver"><a class="docs-heading-anchor" href="#The-Iterative-Solver">The Iterative Solver</a><a id="The-Iterative-Solver-1"></a><a class="docs-heading-anchor-permalink" href="#The-Iterative-Solver" title="Permalink"></a></h2><p>The core problem in SurfaceFluxes.jl is to find the stability parameter <span>$\zeta$</span> that satisfies the MOST relations given the atmospheric state (wind speed difference <span>$\Delta U$</span> between interior and surface, virtual potential temperature difference <span>$\Delta \theta_v$</span>, etc.).</p><p>Since <span>$L$</span> depends on the fluxes (via <span>$u_*$</span> and <span>$B$</span>), and the fluxes depend on <span>$L$</span> (via the profiles), this requires an iterative solution.</p><h3 id="Bulk-Richardson-Number"><a class="docs-heading-anchor" href="#Bulk-Richardson-Number">Bulk Richardson Number</a><a id="Bulk-Richardson-Number-1"></a><a class="docs-heading-anchor-permalink" href="#Bulk-Richardson-Number" title="Permalink"></a></h3><p>The solver uses the <strong>Bulk Richardson Number</strong> (<span>$Ri_b$</span>) as a constraint. In terms of state variables, <span>$Ri_b$</span> is defined as</p><p class="math-container">\[ Ri_b(\text{state}) = \frac{g (z-d) \Delta \theta_v}{\theta_{v,\text{ref}} (\Delta U)^2},\]</p><p>where <span>$\theta_v$</span> is the virtual potential temperature. The bulk Richardson number <span>$Ri_b$</span> is a dimensionless quantity that characterizes the stability of the surface layer. In stable conditions, <span>$Ri_b &gt; 0$</span>, while in unstable conditions, <span>$Ri_b &lt; 0$</span>.</p><p>Theoretical analysis shows that <span>$Ri_b$</span> is universally related to <span>$\zeta$</span>:</p><p class="math-container">\[ Ri_b(\zeta) = \zeta \frac{F_h(\zeta)}{F_m(\zeta)^2}.\]</p><p>Here, <span>$F_m$</span> and <span>$F_h$</span> are the dimensionless vertical profiles for momentum and heat (derived from <span>$\phi_m$</span> and <span>$\phi_h$</span>). The bulk Richardson number <span>$Ri_b(\zeta)$</span> is a monotonic function of <span>$\zeta$</span>, enabling a robust and efficient root-finding algorithm.</p><h3 id="Iterative-Solver-(Secant-Method)"><a class="docs-heading-anchor" href="#Iterative-Solver-(Secant-Method)">Iterative Solver (Secant Method)</a><a id="Iterative-Solver-(Secant-Method)-1"></a><a class="docs-heading-anchor-permalink" href="#Iterative-Solver-(Secant-Method)" title="Permalink"></a></h3><p>The function <code>surface_fluxes</code> uses the <strong>Secant Method</strong> (via <a href="https://github.com/CliMA/RootSolvers.jl">RootSolvers.jl</a>) to find the root <span>$\zeta$</span> of the equation</p><p class="math-container">\[ Ri_b(\text{state}) - Ri_b(\zeta) = 0.\]</p><p>The solver is initialized with guesses at <span>$\zeta = -1$</span> and <span>$\zeta = 1$</span>, spanning neutral stability. By default, the solver runs for a fixed number of iterations (<code>maxiter=7</code>, <code>forced_fixed_iters=true</code>) to ensure predictable, branch-free execution on GPUs.</p><p>For the Businger-Dyer similarity functions, a critical bulk Richardson number <span>$Ri_{b,\text{crit}} \approx 0.21$</span> exists, above which no finite <span>$\zeta$</span> satisfies the stability relations due to the asymptotic behavior of the integrated profile functions. In such <strong>supercritical</strong> stable conditions, the solver cannot converge to a finite root. To ensure bounded output, the solution is clamped to physical limits <span>$\zeta \in [-100, 100]$</span> after iteration. While the clamped solution does not satisfy the stability equations exactly, it provides physically reasonable fluxes that smoothly approach zero as stratification increases.</p><p>Once <span>$\zeta$</span> is found, the scaling parameters (<span>$u_*, \theta_*, q_*$</span>) and thus the fluxes of sensible heat, latent heat, and momentum (SHF, LHF, <span>$\tau$</span>) are computed directly.</p><h3 id="Wind-Speed-and-Gustiness"><a class="docs-heading-anchor" href="#Wind-Speed-and-Gustiness">Wind Speed and Gustiness</a><a id="Wind-Speed-and-Gustiness-1"></a><a class="docs-heading-anchor-permalink" href="#Wind-Speed-and-Gustiness" title="Permalink"></a></h3><p>In conditions of very low wind speed, the standard definition of the bulk Richardson number becomes singular as the mean wind speed approaches zero. To represent sub-grid scale variability and ensure numerical stability, SurfaceFluxes.jl uses an <strong>effective wind speed</strong> that includes a &quot;gustiness&quot; component.</p><p>The effective wind speed difference <span>$\Delta U$</span> used in the solver is:</p><p class="math-container">\[    \Delta U = \max\left( \left(\Delta u^2 + \Delta v^2\right)^{1/2}, \, U_{\text{gust}} \right)\]</p><p>where <span>$\Delta u$</span> and <span>$\Delta v$</span> are the horizontal wind components and <span>$U_{\text{gust}}$</span> is a gustiness velocity scale. This prevents the wind speed from vanishing even when the mean horizontal wind is zero (e.g., in free convection).</p><p>Supported parameterizations for <span>$U_{\text{gust}}$</span>:</p><ol><li><strong>Constant Gustiness</strong>: A fixed minimum wind speed value.</li><li><strong>Deardorff Gustiness</strong>: Proportional to the convective velocity scale <span>$w_*$</span>, capturing gustiness induced by boundary layer eddies.</li></ol><h2 id="Discretization-Schemes"><a class="docs-heading-anchor" href="#Discretization-Schemes">Discretization Schemes</a><a id="Discretization-Schemes-1"></a><a class="docs-heading-anchor-permalink" href="#Discretization-Schemes" title="Permalink"></a></h2><p>SurfaceFluxes.jl supports two interpretations of the boundary layer profiles, handled by the <code>UniversalFunctions</code> module:</p><ol><li><strong>Point Value Scheme (Finite Difference)</strong>: Assumes that the inputs represent values at exact heights <span>$z$</span>.</li><li><strong>Layer Average Scheme (Finite Volume)</strong>: Assumes that the inputs represent volume-averaged values over a grid cell. This requires modified universal functions (<span>$\Psi$</span>) as derived by  (<a href="https://doi.org/10.1029/2018MS001534">Nishizawa &amp; Kitamura (2018)</a>).</li></ol><p>See <a href="../UniversalFunctions/">Universal Functions</a> for details on the specific parameterizations.</p><h2 id="Profile-Recovery"><a class="docs-heading-anchor" href="#Profile-Recovery">Profile Recovery</a><a id="Profile-Recovery-1"></a><a class="docs-heading-anchor-permalink" href="#Profile-Recovery" title="Permalink"></a></h2><p>While the primary goal of the iterative solver is to compute surface fluxes from state variables, strictly speaking, MOST defines the full vertical profiles of these variables. Once the fluxes and stability length <span>$L$</span> are known, the value of any variable at an arbitrary height within the surface layer can be recovered using <code>compute_profile_value</code>.</p><p>This is particularly useful for diagnosing variables at specific heights (e.g., 2 m or 10m) or for coupling with other model components that require state variables at different levels.</p><pre><code class="language-julia hljs">compute_profile_value(
    param_set,
    L_MO,
    z0,
    Δz_eff,
    scale,
    val_sfc,
    transport,
)</code></pre><p>This calculates the value of a variable at the effective aerodynamic height <code>Δz_eff</code> based on its surface value <code>val_sfc</code>, its roughness length <code>z0</code>, and its similarity scale <code>scale</code> (e.g., <span>$u_*$</span> or <span>$\theta_*$</span>). For a complete list of functions and their arguments, please refer to the <a href="../API/">API Reference</a>.</p><div class="admonition is-info"><header class="admonition-header">Effective Height</header><div class="admonition-body"><p>Here and throughout, the input argument <code>Δz_eff</code> is the effective height above the surface, i.e., <span>$z - d$</span>.</p></div></div><h3 id="Example"><a class="docs-heading-anchor" href="#Example">Example</a><a id="Example-1"></a><a class="docs-heading-anchor-permalink" href="#Example" title="Permalink"></a></h3><p>The following figure demonstrates profile recovery using the universal functions (reproducing Figure 6.4 from Bonan (2019)). The profiles are computed with the <strong>Businger-Dyer parameterization</strong> for both stable and unstable conditions and with a displacement height of <span>$d = 19\,\mathrm{m}$</span>.</p><p><em>Profile recovery for wind speed (left) and potential temperature (right) under different stability conditions. The figure shows profiles for unstable conditions (LMO = -10, -50, -1000) and stable conditions (LMO = 30, 50, 1000), demonstrating how the universal functions capture the stability dependence of the boundary layer structure.</em></p><p><img src="../Bonan_Fig6-4.svg" alt="Bonan Figure 6.4"/></p><h2 id="References"><a class="docs-heading-anchor" href="#References">References</a><a id="References-1"></a><a class="docs-heading-anchor-permalink" href="#References" title="Permalink"></a></h2><ul><li>Bonan, G. (2019). <em>Climate Change and Terrestrial Ecosystem Modeling</em>. Cambridge University Press. ISBN: 978-1-107-04378-7</li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Home</a><a class="docs-footer-nextpage" href="../UniversalFunctions/">Universal Functions »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Friday 16 January 2026 18:27">Friday 16 January 2026</span>. Using Julia version 1.11.8.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
