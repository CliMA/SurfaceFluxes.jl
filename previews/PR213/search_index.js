var documenterSearchIndex = {"docs":
[{"location":"UniversalFunctions/#Universal-Functions-in-SurfaceFluxes.jl","page":"Universal Functions","title":"Universal Functions in SurfaceFluxes.jl","text":"","category":"section"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"UniversalFunctions.jl provides the stability functions (universal functions) required by Monin-Obukhov Similarity Theory (MOST) to calculate surface fluxes of momentum and heat/tracers. These functions describe the non-dimensional gradients of wind speed and potential temperature/tracers as a function of the stability parameter zeta = zL, where z is height and L is the Obukhov length.","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"The module supports three distinct parameterizations:","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Businger: The classic Businger-Dyer formulations (Businger et al. 1971, Dyer 1974).\nGryanik: Improved functions for the stable boundary layer (Gryanik et al. 2020).\nGrachev: Functions derived from the SHEBA experiment for stable conditions over sea ice (Grachev et al. 2007).","category":"page"},{"location":"UniversalFunctions/#Mathematical-Framework","page":"Universal Functions","title":"Mathematical Framework","text":"","category":"section"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"In MOST, the vertical gradients of mean wind speed (u) and potential temperature (theta) are scaled by the friction velocity (u_*) and temperature scale (theta_*) according to","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"beginequation\nfrackappa zu_* fracpartial upartial z = phi_m(zeta)\nendequation","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"and","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"beginequation\nfrackappa ztheta_* fracpartial thetapartial z = phi_h(zeta)\nendequation","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"where phi_m and phi_h are the universal stability functions for momentum and heat, respectively, and kappa approx 04 is the von Kármán constant.","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"We also define the integrated stability correction functions (psi) that define corrections to logarithmic profiles, including their volume-averaged forms (Psi) used with finite-volume schemes:","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"The function psi(zeta): The standard integral form used to correct point profiles (for finite-difference schemes):","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"beginequation\npsi(zeta) = int_0^zeta fracphi(0) - phi(x)x dx\nendequation","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"This function is used to obtain the wind profile:","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"beginequation\nlabeleqwindprofile\nu(z) = fracu_*kappa left lnleft(fraczz_0right) - psi_m(zeta) + psi_m(zeta_0) right\nendequation","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Similarly, the potential temperature profile is obtained using the heat stability correction function:","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"beginequation\nlabeleqthetaprofile\ntheta(z) = theta_0 + fractheta_*kappa left lnleft(fraczz_0hright) - psi_h(zeta) + psi_h(zeta_0) right\nendequation","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"where theta_0 is the surface potential temperature, theta_* is the temperature scale, and z_0h is the roughness length for heat.","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"The function Psi(zeta): The volume-averaged form required when model variables represent cell averages (in finite-volume schemes) rather than point values (Nishizawa & Kitamura, 2018):","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"beginequation\nPsi(zeta) = frac1zeta int_0^zeta psi(x) dx\nendequation","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"For finite-volume schemes, where fluxes are computed using cell-averaged values, this function is used in lieu of psi(zeta).","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"","category":"page"},{"location":"UniversalFunctions/#.-Businger-Dyer-Functions","page":"Universal Functions","title":"1. Businger-Dyer Functions","text":"","category":"section"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"The Businger parameterization is the standard formulation for the unstable and weakly stable boundary layer. Our implementation follows the forms detailed in Nishizawa & Kitamura (2018), which provides a unified treatment of both stable and unstable conditions.","category":"page"},{"location":"UniversalFunctions/#Parameter-Structure","page":"Universal Functions","title":"Parameter Structure","text":"","category":"section"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"The BusingerParams struct contains:","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"a_m, a_h: Linear coefficients for stable conditions (denoted as beta in some texts)\nb_m, b_h: Coefficients inside the unstable sqrt/cbrt terms (denoted as gamma in the unstable forms)\nPr_0: The neutral Prandtl number","category":"page"},{"location":"UniversalFunctions/#Unstable-Conditions-(\\zeta-0)","page":"Universal Functions","title":"Unstable Conditions (zeta  0)","text":"","category":"section"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"For unstable conditions, the functions follow the Dyer-Hicks form (Nishizawa & Kitamura 2018, Eqs. A1-A2 for L  0):","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"beginequation\nphi_m(zeta) = (1 - b_m zeta)^-14\nendequation","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"and","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"beginequation\nphi_h(zeta) = (1 - b_h zeta)^-12\nendequation","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"where, typically, b_m=15 and b_h=9.","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"The corresponding integrated functions (psi) involve logarithmic and arctangent terms (Nishizawa & Kitamura 2018, Eqs. A3-A4 for L  0):","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"beginequation\npsi_m(zeta) = lnleftfrac(1 + x)^2(1 + x^2)8right - 2tan^-1(x) + fracpi2\nendequation","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"where x = (1 - b_m zeta)^14, and","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"beginequation\npsi_h(zeta) = 2lnleft(frac1 + y2right)\nendequation","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"where y = (1 - b_h zeta)^12.","category":"page"},{"location":"UniversalFunctions/#Stable-Conditions-(\\zeta-\\ge-0)","page":"Universal Functions","title":"Stable Conditions (zeta ge 0)","text":"","category":"section"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"For stable conditions, the Businger-Dyer functions are linear (Nishizawa & Kitamura 2018, Eqs. A1-A2 for L ge 0):","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"beginequation\nphi_m(zeta) = 1 + a_m zeta\nendequation","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"and","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"beginequation\nphi_h(zeta) = 1 + fraca_h zetatextPr_0\nendequation","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"The integrated forms are (Nishizawa & Kitamura 2018, Eqs. A3-A4 for L ge 0):","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"beginequation\npsi_m(zeta) = -a_m zeta\nendequation","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"and","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"beginequation\npsi_h(zeta) = -fraca_h zetatextPr_0\nendequation","category":"page"},{"location":"UniversalFunctions/#Volume-Averaged-Forms","page":"Universal Functions","title":"Volume-Averaged Forms","text":"","category":"section"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"The volume-averaged functions Psi are implemented for both momentum and heat transport, following Nishizawa & Kitamura (2018, Eqs. A5-A6, A13-A14).","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Stable Conditions (zeta ge 0):","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"For stable conditions, the volume-averaged functions reduce to:","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"beginequation\nPsi_m(zeta) = -fraca_m zeta2\nendequation","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"and","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"beginequation\nPsi_h(zeta) = -fraca_h zeta2 textPr_0\nendequation","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Unstable Conditions (zeta  0):","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"For unstable conditions, the volume-averaged functions are more complex (Nishizawa & Kitamura 2018, Eqs. A5-A6 for L  0):","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"For momentum:","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"beginequation\nPsi_m(zeta) = lnleftfrac(1 + x)^2(1 + x^2)8right - 2tan^-1(x) + fracpi2 - 1 + frac1 - x^33b_m zeta4\nendequation","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"where x = (1 - b_m zeta)^14. For small zeta, this reduces to Psi_m(zeta) approx -b_m zeta8 (Nishizawa & Kitamura 2018, Eq. A13).","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"For heat:","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"beginequation\nPsi_h(zeta) = 2lnleft(frac1 + y2right) + frac2(1 - y)b_h zeta - 1\nendequation","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"where y = (1 - b_h zeta)^12. For small zeta, this reduces to Psi_h(zeta) approx -b_h zeta4 (Nishizawa & Kitamura 2018, Eq. A14).","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"","category":"page"},{"location":"UniversalFunctions/#.-Gryanik-Universal-Functions","page":"Universal Functions","title":"2. Gryanik Universal Functions","text":"","category":"section"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"The Gryanik et al. (2020) parameterization is designed to improve surface flux calculations in the stable boundary layer. It addresses issues where standard functions underestimate fluxes in very stable conditions.","category":"page"},{"location":"UniversalFunctions/#Parameter-Structure-2","page":"Universal Functions","title":"Parameter Structure","text":"","category":"section"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"The GryanikParams struct contains:","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"a_m, b_m: Coefficients for momentum stability function\na_h, b_h: Coefficients for heat stability function\nPr_0: Neutral Prandtl number (the paper recommends textPr_0 approx 098)\nb_m_unstable, b_h_unstable: Parameters for unstable branch (automatically set from Businger values)","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"note: Unstable Branch Parameters\nThe unstable branch parameters (b_m_unstable and b_h_unstable) are automatically set to the Businger parameter values to ensure consistency. This means the unstable branches of Gryanik functions use the same coefficients as the Businger formulation.","category":"page"},{"location":"UniversalFunctions/#Stable-Conditions-(\\zeta-0)","page":"Universal Functions","title":"Stable Conditions (zeta  0)","text":"","category":"section"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Gryanik proposes new forms that remain valid across the entire stability range.","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Momentum (phi_m):","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"beginequation\nphi_m(zeta) = 1 + fraca_m zeta(1 + b_m zeta)^23\nendequation","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Heat (phi_h):","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"beginequation\nphi_h(zeta) = textPr_0 left( 1 + fraca_h zeta1 + b_h zeta right)\nendequation","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Note that phi_h(0) = textPr_0 for Gryanik, unlike Businger where phi_h(0) = 1.","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Integrated Corrections (psi): The code implements the analytical integrals derived in the paper:","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"beginequation\npsi_m(zeta) = -3 fraca_mb_m left (1 + b_m zeta)^13 - 1 right\nendequation","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"and","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"beginequation\npsi_h(zeta) = -textPr_0 fraca_hb_h ln(1 + b_h zeta)\nendequation","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Volume-Averaged Forms (Psi): The volume-averaged functions are analytically derived from the psi functions:","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"beginequation\nPsi_m(zeta) = 3fraca_mb_m - frac9 a_m4 b_m^2 zeta left (1 + b_m zeta)^43 - 1 right\nendequation","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"and","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"beginequation\nPsi_h(zeta) = -fractextPr_0 a_hb_h zeta left left(frac1b_h + zetaright) ln(1 + b_h zeta) - zeta right\nendequation","category":"page"},{"location":"UniversalFunctions/#Unstable-Conditions-(\\zeta-0)-2","page":"Universal Functions","title":"Unstable Conditions (zeta  0)","text":"","category":"section"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"For the unstable regime, Gryanik et al. (2020) recommend reverting to the standard Businger-Dyer forms to ensure continuity at zeta=0. Our implementation uses the Businger unstable forms with coefficients b_m_unstable and b_h_unstable (which are set from Businger parameters). The unstable heat function is scaled by textPr_0 to ensure a continuous transition at the neutral limit (zeta=0):","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"beginequation\nphi_h(zeta) = textPr_0 cdot phi_htextBusinger(zeta b_h = b_htextunstable)\nendequation","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"","category":"page"},{"location":"UniversalFunctions/#.-Grachev-Universal-Functions","page":"Universal Functions","title":"3. Grachev Universal Functions","text":"","category":"section"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"The Grachev et al. (2007) functions were derived from measurements of the stable atmospheric boundary layer over sea ice from the SHEBA dataset. ","category":"page"},{"location":"UniversalFunctions/#Parameter-Structure-3","page":"Universal Functions","title":"Parameter Structure","text":"","category":"section"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"The GrachevParams struct contains:","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"a_m, b_m: Coefficients for momentum stability function\na_h, b_h, c_h: Coefficients for heat stability function (note: c_h is the coefficient for the linear zeta term in the denominator)\nb_m_unstable, b_h_unstable: Parameters for unstable branch (automatically set from Businger values)","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"note: Unstable Branch Parameters\nSimilar to Gryanik, the unstable branch parameters are automatically set from Businger values to ensure consistency.","category":"page"},{"location":"UniversalFunctions/#Stable-Conditions-(\\zeta-0)-2","page":"Universal Functions","title":"Stable Conditions (zeta  0)","text":"","category":"section"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Momentum (phi_m):","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"beginequation\nphi_m(zeta) = 1 + fraca_m zeta (1 + zeta)^131 + b_m zeta\nendequation","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Heat (phi_h):","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"beginequation\nphi_h(zeta) = 1 + fraca_h zeta + b_h zeta^21 + c_h zeta + zeta^2\nendequation","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Integrated Corrections (psi): The integrated forms are complex, involving multiple logarithmic and arctangent terms. See Grachev et al. (2007, Eqs. 12 and 13) for the full derivation.","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"For momentum (Grachev et al. 2007, Eq. 12):","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"beginequation\npsi_m(zeta) = -3fraca_mb_m(x - 1) + fraca_m B_m2 b_m left 2lnleft(fracx + B_m1 + B_mright) - lnleft(fracx^2 - x B_m + B_m^21 - B_m + B_m^2right) + 2sqrt3left(arctanleft(frac2x - B_msqrt3 B_mright) - arctanleft(frac2 - B_msqrt3 B_mright)right) right\nendequation","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"where x = (1 + zeta)^13 and B_m = ((1 - b_m)b_m)^13.","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"For heat (Grachev et al. 2007, Eq. 13):","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"beginequation\npsi_h(zeta) = -fracb_h2 ln(1 + c_h zeta + zeta^2) + left-fraca_hB_h + fracb_h c_h2 B_hright leftlnleft(frac2zeta + c_h - B_h2zeta + c_h + B_hright) - lnleft(fracc_h - B_hc_h + B_hright)right\nendequation","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"where B_h = sqrtc_h^2 - 4.","category":"page"},{"location":"UniversalFunctions/#Unstable-Conditions-(\\zeta-0)-3","page":"Universal Functions","title":"Unstable Conditions (zeta  0)","text":"","category":"section"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Similar to Gryanik, the Grachev parameterization falls back to the Businger-Dyer forms for unstable conditions, using the b_m_unstable and b_h_unstable parameters.","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"note: Volume-Averaged Grachev Function\nThe volume-averaged function Psi(zeta) is not implemented for Grachev due to the lack of closed-form analytical integrals for these complex functions.","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"","category":"page"},{"location":"UniversalFunctions/#Visualization-of-Universal-Functions","page":"Universal Functions","title":"Visualization of Universal Functions","text":"","category":"section"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"The following plots compare the behavior of these functions across different stability regimes and reproduce figures from the literature.","category":"page"},{"location":"UniversalFunctions/#Comparison-with-Gryanik-et-al.-(2020)","page":"Universal Functions","title":"Comparison with Gryanik et al. (2020)","text":"","category":"section"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"The following plots reproduce Figures 1 and 2 from Gryanik et al. (2020), showing the behavior of phi and psi in stable conditions.","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"include(\"plot_universal_functions.jl\")","category":"page"},{"location":"UniversalFunctions/#Figures-1-and-2:-Stable-Conditions-(Linear-Scale)","page":"Universal Functions","title":"Figures 1 & 2: Stable Conditions (Linear Scale)","text":"","category":"section"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Momentum stability function phi_m for stable conditions.","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"(Image: )","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Heat stability function phi_h for stable conditions. Note that Gryanik has phi_h(0) = textPr_0 approx 098.","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"(Image: )","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Momentum stability correction function psi_m for stable conditions.","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"(Image: )","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Heat stability correction function psi_h for stable conditions.","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"(Image: )","category":"page"},{"location":"UniversalFunctions/#Figure-3:-Extended-Stability-Range-(Log-Log-Scale)","page":"Universal Functions","title":"Figure 3: Extended Stability Range (Log-Log Scale)","text":"","category":"section"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Momentum stability function phi_m over extended stability range (log-log scale).","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"(Image: )","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Heat stability function phi_h over extended stability range (log-log scale).","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"(Image: )","category":"page"},{"location":"UniversalFunctions/#Comparison-with-Businger-(1971)","page":"Universal Functions","title":"Comparison with Businger (1971)","text":"","category":"section"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"The classic Businger et al. (1971) curves for phi_m and phi_h, along with the other parameterizations, across both stable and unstable conditions.","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Momentum stability functions phi_m for stable and unstable conditions, illustrating continuity across the regimes and convergence of all parameterizations to the Businger-Dyer forms in the unstable regime.","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"(Image: )","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Heat stability function phi_h for stable and unstable conditions, illustrating continuity across the regimes and convergence of all parameterizations to the Businger-Dyer forms in the unstable regime.","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"(Image: )","category":"page"},{"location":"UniversalFunctions/#Profile-Recovery-Example","page":"Universal Functions","title":"Profile Recovery Example","text":"","category":"section"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"The following figure demonstrates profile recovery using the universal functions, reproducing Figure 6.4 from Bonan (2019). The profiles are computed using the wind and potential temperature profile equations (equations \\eqref{eq:windprofile} and \\eqref{eq:thetaprofile}) with the Businger-Dyer parameterization for both stable and unstable conditions. This shows how the universal functions are used to reconstruct vertical profiles of wind speed and potential temperature from surface flux parameters.","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Profile recovery for wind speed (left) and potential temperature (right) under different stability conditions. The figure shows profiles for unstable conditions (LMO = -10, -50, -1000) and stable conditions (LMO = 30, 50, 1000), demonstrating how the universal functions capture the stability dependence of the boundary layer structure.","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"(Image: )","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"","category":"page"},{"location":"UniversalFunctions/#Test-Suite","page":"Universal Functions","title":"Test Suite","text":"","category":"section"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"The universal functions are thoroughly tested to ensure correctness, numerical stability, and mathematical consistency. The test suite (test/test_universal_functions.jl) verifies the following properties:","category":"page"},{"location":"UniversalFunctions/#Type-Stability","page":"Universal Functions","title":"Type Stability","text":"","category":"section"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Test: Type stability","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Verifies that all functions return values of the correct floating-point type (Float32 or Float64) matching the input parameter type. This is tested across:","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Fine grids covering a wide range of stability parameters (zeta from -2 to 200)\nValues very close to zero (near machine epsilon)\nAll parameterizations (Businger, Gryanik, Grachev)\nBoth momentum and heat transport","category":"page"},{"location":"UniversalFunctions/#Neutral-Limit-Behavior","page":"Universal Functions","title":"Neutral Limit Behavior","text":"","category":"section"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Test: Neutral logarithmic velocity profile","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Verifies that in the neutral limit (L to infty, i.e., zeta to 0), the velocity profile collapses to the logarithmic law of the wall:","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"beginequation\nu(z) = fracu_*kappa lnleft(fraczz_0right)\nendequation","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"This is tested by using a very large Obukhov length and verifying that the stability correction terms vanish, leaving only the logarithmic term.","category":"page"},{"location":"UniversalFunctions/#Asymptotic-Behavior","page":"Universal Functions","title":"Asymptotic Behavior","text":"","category":"section"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Test: Asymptotic behavior (|ζ| → ∞)","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"For very stable conditions (zeta gg 1), the functions should approach their asymptotic limits. This test verifies:","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Gryanik: phi_m(zeta) sim (a_mb_m^23) zeta^13 and phi_h(zeta) sim 1 + (textPr_0 a_h zeta)(1 + b_h zeta)\nGrachev: phi_m(zeta) sim (a_mb_m) zeta^13 and phi_h(zeta) sim 1 + b_h","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"These asymptotic forms are important for very stable boundary layers where standard functions may fail.","category":"page"},{"location":"UniversalFunctions/#Monotonicity","page":"Universal Functions","title":"Monotonicity","text":"","category":"section"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Test: Monotonicity of ϕ(ζ)","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Verifies that phi(zeta) is monotonically increasing with zeta across the entire stability range (both stable and unstable). This is a fundamental physical property: as stability increases (larger zeta), the gradient should increase. The test allows for small numerical noise near zero.","category":"page"},{"location":"UniversalFunctions/#Boundary-Conditions","page":"Universal Functions","title":"Boundary Conditions","text":"","category":"section"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Test: ψ(0) == 0","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Verifies that the integrated stability correction function psi satisfies the boundary condition psi(0) = 0, which is required by the definition:","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"beginequation\npsi(zeta) = int_0^zeta fracphi(0) - phi(x)x dx\nendequation","category":"page"},{"location":"UniversalFunctions/#Continuity-at-Neutral-Conditions","page":"Universal Functions","title":"Continuity at Neutral Conditions","text":"","category":"section"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Test: Neutral continuity (ζ → 0)","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Verifies that all functions are continuous at zeta = 0, meaning:","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"The limit lim_zeta to 0^+ phi(zeta) = lim_zeta to 0^- phi(zeta) = phi(0)\nThe limit lim_zeta to 0^+ psi(zeta) = lim_zeta to 0^- psi(zeta) = psi(0)\nThe limit lim_zeta to 0^+ Psi(zeta) = lim_zeta to 0^- Psi(zeta) = Psi(0) (where implemented)","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"This ensures continuous transitions between stable and unstable regimes.","category":"page"},{"location":"UniversalFunctions/#Derivative-Consistency","page":"Universal Functions","title":"Derivative Consistency","text":"","category":"section"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Test: Derivative consistency ϕ(ζ) ≈ ϕ(0) - ζ·ψ'(ζ)","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Verifies the mathematical relationship between phi and psi:","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"beginequation\nphi(zeta) = phi(0) - zeta cdot fracdpsidzeta\nendequation","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"This is tested using finite-difference approximations of psi(zeta) and comparing against the analytical phi(zeta). This relationship follows from the definition of psi and ensures internal consistency of the implementation.","category":"page"},{"location":"UniversalFunctions/#Integral-Consistency","page":"Universal Functions","title":"Integral Consistency","text":"","category":"section"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Test: Integral consistency ψ(ζ) = ∫(ϕ(0)-ϕ)/ζ′ dζ′","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Verifies that the analytical implementation of psi(zeta) matches the integral definition:","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"beginequation\npsi(zeta) = int_epsilon^zeta fracphi(0) - phi(x)x dx\nendequation","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"This is tested using numerical quadrature (Gauss-Kronrod) to compute the integral and comparing against the analytical psi function. This ensures that the analytical integrals derived in the papers are correctly implemented.","category":"page"},{"location":"UniversalFunctions/#Small-\\zeta-Linearization","page":"Universal Functions","title":"Small-zeta Linearization","text":"","category":"section"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Test: Small-ζ Linearization Consistency","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"For very small zeta, the volume-averaged function Psi should satisfy:","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"beginequation\nlim_zeta to 0 fracPsi(zeta)zeta = -fracphi(0)2\nendequation","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"This test verifies that the linear approximations used near zero in the Psi implementations are consistent with the theoretical slope derived from the phi parameters. This is important for numerical stability when zeta is very close to zero.","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"","category":"page"},{"location":"UniversalFunctions/#References","page":"Universal Functions","title":"References","text":"","category":"section"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Businger, J. A., Wyngaard, J. C., Izumi, Y., & Bradley, E. F. (1971). Flux-profile relationships in the atmospheric surface layer. Journal of the Atmospheric Sciences, 28, 181-189. https://doi.org/10.1175/1520-0469(1971)028<0181:FPRITA>2.0.CO;2\nDyer, A. J. (1974). A review of flux-profile relationships. Boundary-Layer Meteorology, 7, 363-372. https://doi.org/10.1007/BF00240838\nGryanik, V. M., Lüpkes, C., Grachev, A., and Sidorenko, D. (2020). New modified and extended stability functions for the stable boundary layer based on SHEBA and parametrizations of bulk transfer coefficients for climate models. Journal of the Atmospheric Sciences, 77, 2687–2716. https://doi.org/10.1175/JAS-D-19-0255.1\nGrachev, A. A., Andreas, E. L., Fairall, C. W., Guest, P. S., and Persson, P. O. G. (2007). SHEBA flux–profile relationships in the stable atmospheric boundary layer. Boundary-Layer Meteorology, 124, 315–333. https://doi.org/10.1007/s10546-007-9177-6\nNishizawa, S., & Kitamura, Y. (2018). A surface flux scheme based on the Monin-Obukhov similarity for finite volume models. Journal of Advances in Modeling Earth Systems, 10, 1-17. https://doi.org/10.1029/2018MS001534\nBonan, G. (2019). Climate Change and Terrestrial Ecosystem Modeling. Cambridge University Press. ISBN: 978-1-107-04378-7","category":"page"},{"location":"References/#References","page":"References","title":"References","text":"","category":"section"},{"location":"References/","page":"References","title":"References","text":"","category":"page"},{"location":"SurfaceFluxes/#Surface-Fluxes","page":"Equations","title":"Surface Fluxes","text":"","category":"section"},{"location":"SurfaceFluxes/#Monin-Obukhov-Similarity-Theory-(MOST)","page":"Equations","title":"Monin-Obukhov Similarity Theory (MOST)","text":"","category":"section"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"Surface fluxes of momentum, energy and moisture are computed using the Monin-Obukhov Similarity Theory (MOST), which follows from dimensional analysis and similarity laws in stratified boundary layers. The theory gives the fluxes in an unresolved surface layer based on the self-similarity of stratified boundary layers, and can be used to compute exchange coefficients for bulk-formulae for the fluxes at the bottom boundary in simulations of the atmosphere. The MOST similarity profiles depend on one length scale, given by the ratio of velocity and buoyancy scales and known as the Obukhov length:","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"beginequation\nlabeleqmonin_obukhov_length\nL_O =  fracu_star^2 kappa b_star\nendequation","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"Here, star subscripts indicate a characteristic physical scale of the variable in question in the surface layer. The buoyancy (b) is defined as","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"beginequation\nb = g fracmathrmDSE_vmathrmDSE_v\nendequation","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"with mathrmDSE_v as the perturbation from a reference virtual dry static energy value, mathrmDSE_v. These mean and perturbation quantities are implicit in the model and can be used to compute the relation between b_star and phi_star, where phi represents a thermoynamic scale variable. Following equations (8) and (9) in [1] we write the physical scale for such a variable phi as:","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"beginequation\nlabeleqthermodynamic_scale\nphi_star = frackappa  PrF_h(Delta zz_0phi L_O) Delta phi\nendequation","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"and a corresponding momentum scale is given by:","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"beginequation\nlabelequ_star\nu_star = frackappaF_m(Delta zz_0m L_O) Delta u\nendequation","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"Here kappa = 04 is the von-Karman constant, Pr is the Prandtl number and Delta corresponds to the difference in values between the two input heights (i.e. Delta u = u(z_in) - u(z_srf)). The formulation of F_m and F_h is subjective to the choice of discretization as shown in [1]. In the typical finite-difference form: ","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"beginequation\nF_h^(FD) = log left(fracDelta zz_0b right) - psi_h left(fracDelta zL_O right) + psi_h left(fracz_0bL_O right)\nendequation","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"and ","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"beginequation\nF_m^(FD) = log left(fracDelta zz_0m right) - psi_m left(fracDelta zL_O right) + psi_m left(fracz_0mL_O right)\nendequation","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"Subscripts h m are used to represent the equations corresponding to the exchange of heat and momentum respectively. The characteristics of tracer diffusion are assumed to be identical to those of the thermal diffusion in this system. The expressions for psi_m and psi_h are defined in appendix A in [1] for various universal functions. Our current approach uses the Businger universal functions by default. ","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"The correction for the finite volume form F_h F_m are given respectively as:","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"beginequation\nF_h^(FV) = log left(fracDelta zz_0b right) - Psi_h left(fracDelta zL_O right) + fracz_0bDelta z Psi_h left(fracz_0bL_O right) + R_z0hleftPsi_h left(fracz_0bL_O right) - 1right\nendequation","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"and ","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"beginequation\nF_m^(FV) = log left(fracDelta zz_0m right) - Psi_m left(fracDelta zL_O right) + fracz_0mDelta z Psi_m left(fracz_0mL_O right) + R_z0mleftPsi_m left(fracz_0mL_O right) - 1right\nendequation","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"with Psi_m and Psi_h as the FV corrected form. Their expressions are found in appendix A in [1] and here as well we use the Businger universal functions formulation as a default. ","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"Note that both F_h and F_m (for FV and FD) are functions of known parameters (z_0b z_0m Delta z) and L_O only. Furthermore we can compute b_star from the known thermodynamic states. This fact makes (1) a transcendental equation with L_O as the only unknown. A numerical solver that iterate over L_O can thus find the value for which the error in (1) is smaller than some desired tolerance. ","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"The most direct computation of b_star follows by writing (3) for virtual dry static energy and multiplying by a (gmathrmDSE_v) factor:","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"beginequation\nb_star = fracg mathrmDSE_v frackappa  PrF_h(zz_0b L_O) Delta mathrmDSE_v\nendequation","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"with Delta mathrmDSE_v computed from the thermodynamic states at the corresponding levels. This approach forces us to assume that the various scalars that take part in the virtual dry static energy has the same roughness length z_0b but provides a straightforward implementation where any tracer (humidity or other) which plays a role in the virtual dry static energy of air is accounted for in the computation of L_O. ","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"An alternative method common in atmospheric models, is to write b_star using the definition of virtual potential temperature as:","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"beginequation\nb_star = (1+(epsilon_dv-1) q_t ) theta_star +  (epsilon_dv-1) theta q_tstar\nendequation","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"with theta_star and q_tstar given by (3). Here separate roughness lengths can be assumed for heat and humidity but the implementation would have to change if any additional scalar is added to the air density. For these reasons we implement (10). ","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"The flux from the top of the boundary layer is given by:","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"beginequation\noverlinewu = - u_star^2\nendequation","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"beginequation\noverlinewphi = - u_star phi_star\nendequation","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"which could be viewed as alternatives to bulk formula expressions for the sensible and latent heat fluxes if the physical scales are known. Correspondingly, the ratios between the physical scale and its change in the surface layer provides and expression for the exchange coefficient:","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"beginequation\n    C_m = fracu_star^2Delta u^2\nendequation","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"beginequation\nlabeleqexchange_coeff_scalar\n    C_phi = fracu_star phi_starDelta u Deltaphi\nendequation","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"Equations (13) and (14) are singular if Delta u = 0, and typically a gustiness parameter w_star is added to represent the SGS convective velocity and avoid this singularity. A typical formulation for gustiness is ","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"beginequation\n    w_star = left(overlinewb h_fc right)^frac13\nendequation","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"here h_fc is the height of free convection, a non local estimation of the maximum height (above the surface layer) possible of convective motions based on the atmospheric profile. This formulation of gustiness requires a priori knowledge of the surface fluxes and thus can only be used in cases with prescribed fluxes. More generally gustiness is often taken to be a some assumed constant based on scaling arguments.","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"At the same time equation (14) is also singular if Deltaphi = 0. If phi corresponds to buoyancy (mathrmDSE_v) then the conditions are neutral, and the buoyancy flux is zero. L_O is set to infinity, and the momentum exchange coefficient and heat exchange coefficient are given by the law of the wall:","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"beginequation\nC_mN = left( frackappaln Delta zz_0m right)^2\nendequation","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"beginequation\nC_phiN = frackappa^2ln Delta zz_0b ln Delta zz_0m\nendequation","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"In neutral conditions  Once the surface conditions are known, the computation of the profile of any variable within the surface layer (for any z_sfc  z  z_in) is done by rewriting (3) and (4) as:","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"beginequation\nphi(z) = phi_starfracF_h(zz_0phi L_O)kappa  Pr  + phi_sfc\nendequation","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"beginequation\nu(z) = u_star fracF_m(zz_0m L_O)kappa + u_sfc\nendequation","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"with phi_star and u_star given by (3) and (4) respectively. Here, the same choice of discretization should be used for F_h and F_m as used to obtain the surface conditions.","category":"page"},{"location":"SurfaceFluxes/#Iteration-Procedure","page":"Equations","title":"Iteration Procedure","text":"","category":"section"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"We start with the definition of the bulk Richardson number in terms of the virtual dry static energy mathrmDSE____v, ","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"beginequation\n    mathrmRi_b = fracg z (mathrmDSE_vin - mathrmDSE_vsfc)mathrmDSE_vsfc u(z)^2\nendequation","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"We further note that mathrmRi_b can be expressed in terms of the stability correction functions as ","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"beginequation\n    mathrmRi_b = zeta F_c(zeta) F_m(zeta)^-2\nendequation","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"where","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"beginequation\n    F_c(zeta) = log (fraczz_0c) - psi_c(zeta) + psi_c(fraczetaz) \nendequation","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"and ","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"beginequation\n    F_m(zeta) = log (fraczz_0m) - psi_m(zeta) + psi_m(fraczetaz) \nendequation","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"with zeta denoting the Monin-Obukhov stability parameter, and subscripts c m denoting scalar and momentum variables respectively. ","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"With the following analytical expression for the derivative of mathrmRi_b with respect to the stability parameter zeta, ","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"beginequation\n    fracpartial mathrmRi_bpartial zeta = fracmathrmRi_bzeta Big(1 + (phi_c(zeta) - phi_c(zeta z_0c  z))F_c^-1(zeta) - 2(phi_m(zeta) - phi_m(zeta z_0m  z))F_m^-1(zeta) Big)\nendequation","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"we can use Newton's method to iteratively solve for the stability parameter zeta, and therefore the Monin-Obukhov lengthscale. ","category":"page"},{"location":"SurfaceFluxes/#Profile-recovery-using-MOST","page":"Equations","title":"Profile recovery using MOST","text":"","category":"section"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"The recover_profile method recovers profiles of variables (e.g., velocity, potential temperature) at specified heights within the surface layer using Monin-Obukhov Similarity Theory. The method signature is:","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"recover_profile(\n    param_set,\n    sc,\n    L_MO,\n    𝓁,\n    Z,\n    X_star,\n    X_sfc,\n    transport,\n    scheme\n)","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"Arguments:","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"param_set: Abstract Parameter Set containing physical and thermodynamic parameters\nsc: Container for surface conditions (AbstractSurfaceConditions) based on known combination of the state vector, and {fluxes, friction velocity, exchange coefficients} for a given experiment\nL_MO: Monin-Obukhov length\n𝓁: Roughness length for the variable (e.g., z_{0m} for momentum, z_{0b} for scalars)\nZ: Z coordinate(s) (within surface layer) for which variable values are required\nX_star: Scale parameter for variable X (e.g., u_{\\star} for velocity, \\theta_{\\star} for potential temperature)\nX_sfc: For variable X, values at surface nodes\ntransport: Transport type (e.g., MomentumTransport() or HeatTransport(), used to determine physical scale coefficients)\nscheme: Discretization scheme (PointValueScheme() for finite difference or LayerAverageScheme() for finite volume)","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"The method follows equations (21,22) from [1] and computes the profile using:","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"X(z) = fracX_starkappa left logleft(fraczellright) - psileft(fraczL_Oright) + psileft(fracellL_Oright) right + X_sfc","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"Here, we demonstrate the recovered velocity and potential temperature functions in a dry atmosphere example, verifying the plots shown in Fig 6.4 in [3]. ","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"include(\"plot_bonan_profiles.jl\")","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"(Image: )","category":"page"},{"location":"SurfaceFluxes/#Roughness-Sublayer-Models","page":"Equations","title":"Roughness Sublayer Models","text":"","category":"section"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"In the case of large obstacles, such as a forest canopy, larger turbulent motions modify the wind and scalar profiles in a roughness-sublayer (RSL), which stretches from the displacement height, d (just below the canopy height, usually d=075h_c) to up to 3 times the canopy height, h_c. Observations show that in the RSL the classical MOST overestimates the phi functions and underestimates u(z). There are several approaches suggested in the literature to parameterize the RSL effects combined with the underlying canopy:  ","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"\\subsubsection{1. MOST in RSL and exponential canopy profiles} Evidently, MOST could be used in the RSL with the origin of the profile at z=d (instead of z=0 as in MOST), as was suggested in [4]. However, this would give a zero wind at d, which is rarely the case in real canopies: ","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"beginequation\n    fracpartial u (z)partial z = (u_starkappa (z-d)) Phi_M(zeta) \nendequation","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"with similar form suggested for scalars, except with a much smaller roughness length, to account for the \"bluff body\" effect (canopy is much more efficient at absorbing momentum compared to its ability to emit/absorb heat). ","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"For the layer within the deep canopy, z  d, an exponential profile is suggested for the wind profile:","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"beginequation\nu(z) = u_h exp((zh_c - 1) alpha)\nendequation","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"where u_h = u(h_c), and alpha is the canopy flow index, dependent on the leaf morphology, density, element flexibility, geometry and (in some cases) the wind speed. Typically this is approximated by a constant, depending on the land use category. It is unclear how the authors avoid discontinuities at h_c. Note, the authors also suggest a linear interpolation-based solution around the forest edges, which is dependent on the wind direction. ","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"Note that CLM4.5 also uses MOST, and its canopy layer ignores the direct effects of turbulence, parameterizing u as u_*. This is suboptimal. See [3] for more details. (CLM4.5 uses a parameterisation that assumes that the wind speed within the canopy is equal to the friction velocity u_star.)","category":"page"},{"location":"SurfaceFluxes/#Modified-MOST-in-RSL","page":"Equations","title":"Modified MOST in RSL","text":"","category":"section"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"note: Note\nRoughness sublayer models are not currently implemented.","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"Following [5], we can provide extensions to the MOST to capture the flow behaviour within the roughness-sublayer whose maximum height is denoted by z_*. Equation (2) in [5] corresponds to (\\ref{eq:Fhfin-diff}) in this document, and gives the velocity profiles in the surface layer following the canonical MOST. For model levels z such that d leq z leq z_star (within the RSL),  [5] suggest the following modification to the velocity gradient profile. The profile would be:","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"beginequation\n    fracpartial u (z-d)partial z = (u_starkappa z) Phi_M(zeta)phi_M(z-dz_star-d) \nendequation","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"where Phi_M is the stability function applied in the canonical MOST theory, ","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"beginequation\n    phi_MBig(fracz-dz_star-dBig) = 05exp(ln(2)fracz-dz_star-d)\nendequation","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"and is estimated from flux-tower data over flat, tree-covered terrain with z_0 ranging from 04-09 mathrmm. The stability parameter is defined by zeta = (z-d)L following the zero-plane displacement correction.","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"Thus, for recovery profiles defined in \\ref{eq:velrefprofile}, the modified expression incorporating the RSL model results in ","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"beginequation\n    u(z-d) = fracu_starkappa Big(F_m + int_z_0^z  Phi_M(1-phi_M(z-dz_star-d))(z-d)^-1 dzBig) + u(z_0) \nendequation ","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"with non-zero u(z_0). This can also be expressed as ","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"beginequation\n    u(z-d) = fracu_starkappa Big(F_m + int_z^z_star  Phi_M(1-phi_M(z-dz_star-d))(z-d)^-1 dzBig) \nendequation for z leq z_star ","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"While [5] comment on the application of surface-layer functions defined by [6], we can generalise to the family of similarity functions provided provided in the SurfaceFluxes.jl package.","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"Note that K_m is also modified by phi_M if model levels reach the RSL.","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"The authors assume that the deep canopy layer (between z=0 and z=d) has no storage capacity and it gives off the same fluxes it receives from the soil. They further assume that the surface layer height h_s = 004 z_i, where z_i is the height of the planetary boundary layer (PBL).","category":"page"},{"location":"SurfaceFluxes/#Modified-MOST-in-RSL-and-exponential-canopy-profiles-coupled","page":"Equations","title":"Modified MOST in RSL and exponential canopy profiles coupled","text":"","category":"section"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"[ ] TODO: Code implementation","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"The works of [7] extend the above approach to the deep canopy layer, using momentum and mass balances. Using MOST in the surface layer above RSL, and the modified MOST within the RSL allows derivation of u_h. This allows coupling via u_h from the exponential profile in the canopy: ","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"u(z) = u(h_c) exp-eta(1-zh_c)","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"with the attenuation factor eta = h_c (c_d a  2 l_m^2)^13 is a function of the leaf aerodynamic drag c_d, leaf area density a, and a canopy characteristic mixing length l_m. eta is often estimated empirically, but it can be used in its functional form to derive a correction to the modified MOST above, so that :","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"beginequation\n    phi_MBig(fracz-d l_m betaBig) = 1-c_1exp(-c_2fracz-d l_m beta)\nendequation","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"with beta = u_*u(h_c) and c_2approx 05. For c_1 we need to use the modified similarity functions again. ","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"Although this extension was initially derived for dense canopies, [3] suggest a further modification to sparse canopies through the use of the plant area index ([3] Appendix 4 - equations A31-A34).","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"The advantage of this scheme is that there are no discontinuities in the profiles and that z^* is no longer a free parameter. The disadvantage is that it is quite complex and it is not obvious that it would perform better in a climate model that the original [5] version with the canopy layer being approximated a simpler exponential expression (e.g., assuming a constant eta) or some second-order interpolation between h_c and the surface. The [5] formulation  is much easier to implement in the current version of SurfaceFluxes.jl.","category":"page"},{"location":"SurfaceFluxes/#Evapotranspiration","page":"Equations","title":"Evapotranspiration","text":"","category":"section"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"note: Note\nThis feature has not yet been implemented in the code. ","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"Following Figure 7.3 in Bonan (2019a), we interpret the effect of canopies and other surface features on the sensible and latent heat fluxes as conductance networks. In the case of sensible heat fluxes H and diffusive evaporative fluxes E, this results in the following expressions (as in Bonan eq 7.5 and 7.6):","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"beginequation\nH = c_p (theta_s - theta_ref) g_ac\nendequation","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"beginequation\nE = fracq_sat(theta_s)-q_refg_c^-1 + g_ac^-1\nendequation","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"and","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"beginequation\ng_w^-1 = g_c^-1 + g_ac^-1\nendequation","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"where g_w is the total conductance for evapotranspiration, g_c represents the effect of canopies and surface wetness (with lower values for drier surfaces), and g_ac is the aerodynamic conductance for scalars.","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"An alternative interpretation through the use of bulk-formulae requires an adjustment of the soil wetness through a factor beta_w. In the conductance network approach, beta_w = fracg_wg_ac. We may then replace the beta_w factor in the approach using bulk-formulae with","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"beginequation\nbeta_w = fracg_cg_ac+g_c\nendequation","category":"page"},{"location":"SurfaceFluxes/","page":"Equations","title":"Equations","text":"with $ 0 (dry) \\leq \\beta \\leq 1 (wet)$.","category":"page"},{"location":"#SurfaceFluxes.jl","page":"Home","title":"SurfaceFluxes.jl","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"See the API Reference for complete API documentation.","category":"page"},{"location":"#Source-Code-Structure","page":"Home","title":"Source Code Structure","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"The src/ directory contains the following files organized by functionality:","category":"page"},{"location":"#Core-Module-Files","page":"Home","title":"Core Module Files","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"SurfaceFluxes.jl: Main module file containing the surface_conditions function and obukhov_similarity_solution solver\ntypes.jl: Type definitions including AbstractSurfaceConditions, SolverScheme, RoughnessModel, and related structs\nutilities.jl: Helper functions for state accessors, Richardson number computation, and thermodynamic differences\nParameters.jl: Parameter set definitions for physical constants\nUniversalFunctions.jl: Universal function implementations (Businger, Gryanik, Grachev)","category":"page"},{"location":"#Flux-and-Exchange-Coefficient-Methods","page":"Home","title":"Flux and Exchange Coefficient Methods","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"physical_scale_coefficient_methods.jl: Computation of physical scale coefficients for finite difference (Byun 1990) and finite volume (Nishizawa 2018) schemes\nmomentum_exchange_coefficient_methods.jl: Computation of momentum exchange coefficient (Cd) for neutral and stratified conditions\nheat_exchange_coefficient_methods.jl: Computation of heat exchange coefficient (Ch) for neutral and stratified conditions\nfriction_velocity_methods.jl: Friction velocity (u★) computation methods\nsensible_heat_methods.jl: Sensible heat flux computations\nlatent_heat_methods.jl: Latent heat flux computations\nbuoyancy_flux_methods.jl: Buoyancy flux computations\nevaporation_methods.jl: Evaporation rate computations","category":"page"},{"location":"#Surface-Condition-Input-Types","page":"Home","title":"Surface Condition Input Types","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"coefficient_inputs.jl: Methods for surface conditions specified via exchange coefficients (Cd, Ch)\nroughness_models.jl: Roughness length models (ScalarRoughness, CharnockRoughness)","category":"page"},{"location":"#Profile-Recovery","page":"Home","title":"Profile Recovery","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"profile_recovery.jl: Functions to recover vertical profiles within the surface layer using Monin-Obukhov similarity theory","category":"page"},{"location":"","page":"Home","title":"Home","text":"For detailed API documentation of all types and methods, see the API Reference.","category":"page"},{"location":"#Parameters","page":"Home","title":"Parameters","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"Convenience constructors are provided for the SurfaceFluxesParameters and the various UniversalFunctions parameter structs. To use them, you must first import ClimaParams:","category":"page"},{"location":"","page":"Home","title":"Home","text":"import ClimaParams as CP\nimport SurfaceFluxes.Parameters as SFP\nimport SurfaceFluxes.UniversalFunctions as UF\n\nFT = Float64\n\n# SurfaceFluxesParameters requires a float type and a UniversalFunctionsParameters type\nSFP.SurfaceFluxesParameters(FT, UF.BusingerParams)\n\n# Or a TOML dict instead of a float type\ntoml_dict = CP.create_toml_dict(Float64)\nSFP.SurfaceFluxesParameters(toml_dict, UF.GrachevParams)\n\n# UniversalFunctionsParameters only require a float type or a TOML dict.\nUF.BusingerParams(FT)\nUF.GryanikParams(FT)\nUF.GrachevParams(FT)","category":"page"},{"location":"#Documentation","page":"Home","title":"Documentation","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"API Reference\nUniversal Functions","category":"page"},{"location":"API/#API-Reference","page":"API Reference","title":"API Reference","text":"","category":"section"},{"location":"API/#Main-Module","page":"API Reference","title":"Main Module","text":"","category":"section"},{"location":"API/","page":"API Reference","title":"API Reference","text":"SurfaceFluxes","category":"page"},{"location":"API/#SurfaceFluxes","page":"API Reference","title":"SurfaceFluxes","text":"SurfaceFluxes\n\nInterface\n\nsurface_conditions computes\nMonin-Obukhov length\nPotential temperature flux (if not given) using Monin-Obukhov theory\ntransport fluxes using Monin-Obukhov theory\nfriction velocity/temperature scale/tracer scales\nexchange coefficients\n\nReferences\n\n[1]\n[2]\n\n\n\n\n\n","category":"module"},{"location":"API/#Core-Input-Types","page":"API Reference","title":"Core Input Types","text":"","category":"section"},{"location":"API/","page":"API Reference","title":"API Reference","text":"SurfaceFluxes.StateValues","category":"page"},{"location":"API/#SurfaceFluxes.StateValues","page":"API Reference","title":"SurfaceFluxes.StateValues","text":"StateValues\n\nInput container for state variables at either first / interior nodes.\n\nFields\n\nz::FT: Height [m]\nu::A: Wind velocity vector\nts::TS: Thermodynamic state\nargs::NT: Additional arguments (optional)\n\n\n\n\n\n","category":"type"},{"location":"API/#Dispatch-Types","page":"API Reference","title":"Dispatch Types","text":"","category":"section"},{"location":"API/","page":"API Reference","title":"API Reference","text":"SurfaceFluxes.Fluxes\nSurfaceFluxes.FluxesAndFrictionVelocity\nSurfaceFluxes.Coefficients\nSurfaceFluxes.ValuesOnly","category":"page"},{"location":"API/#SurfaceFluxes.Fluxes","page":"API Reference","title":"SurfaceFluxes.Fluxes","text":"Fluxes\n\nInput container for state variables, latent and sensible heat fluxes roughness lengths, initial obukhov length and gustiness.\n\nFields\n\nstate_in::SVA: State values at interior/input height\nstate_sfc::SVB: State values at surface\nshf::FT: Sensible heat flux [W/m²]\nlhf::FT: Latent heat flux [W/m²]\nz0m::FT: Momentum roughness length [m]\nz0b::FT: Scalar (heat/moisture) roughness length [m]\ngustiness::FT: Gustiness parameter [m/s]\nroughness_model::RM: Roughness model type\n\n\n\n\n\n","category":"type"},{"location":"API/#SurfaceFluxes.FluxesAndFrictionVelocity","page":"API Reference","title":"SurfaceFluxes.FluxesAndFrictionVelocity","text":"FluxesAndFrictionVelocity\n\nInput container, given surface state variables, latent and sensible heat fluxes, and the friction velocity, roughness lengths, initial obukhov length and gustiness.\n\nFields\n\nstate_in::SVA: State values at interior/input height\nstate_sfc::SVB: State values at surface\nshf::FT: Sensible heat flux [W/m²]\nlhf::FT: Latent heat flux [W/m²]\nustar::FT: Friction velocity [m/s]\nz0m::FT: Momentum roughness length [m]\nz0b::FT: Scalar (heat/moisture) roughness length [m]\ngustiness::FT: Gustiness parameter [m/s]\nroughness_model::RM: Roughness model type\n\n\n\n\n\n","category":"type"},{"location":"API/#SurfaceFluxes.Coefficients","page":"API Reference","title":"SurfaceFluxes.Coefficients","text":"Coefficients\n\nInput container, given surface state variables, and exchange coefficients,roughness lengths, initial obukhov length and gustiness.\n\nFields\n\nstate_in::SVA: State values at interior/input height\nstate_sfc::SVB: State values at surface\nCd::FT: Momentum exchange coefficient\nCh::FT: Heat exchange coefficient\ngustiness::FT: Gustiness parameter [m/s]\nbeta::FT: Evaporation efficiency factor\nroughness_model::RM: Roughness model type\n\n\n\n\n\n","category":"type"},{"location":"API/#SurfaceFluxes.ValuesOnly","page":"API Reference","title":"SurfaceFluxes.ValuesOnly","text":"ValuesOnly\n\nInput container, given only surface state variables, roughness lengths, initial obukhov length and gustiness.\n\nFields\n\nstate_in::SVA: State values at interior/input height\nstate_sfc::SVB: State values at surface\nz0m::FT: Momentum roughness length [m]\nz0b::FT: Scalar (heat/moisture) roughness length [m]\ngustiness::FT: Gustiness parameter [m/s]\nbeta::FT: Evaporation efficiency factor\nroughness_model::RM: Roughness model type\n\n\n\n\n\n","category":"type"},{"location":"API/#User-Facing-Methods","page":"API Reference","title":"User-Facing Methods","text":"","category":"section"},{"location":"API/","page":"API Reference","title":"API Reference","text":"SurfaceFluxes.surface_conditions\nSurfaceFluxes.recover_profile","category":"page"},{"location":"API/#SurfaceFluxes.surface_conditions","page":"API Reference","title":"SurfaceFluxes.surface_conditions","text":"surface_conditions(\n    param_set::AbstractSurfaceFluxesParameters,\n    sc::SurfaceFluxes.AbstractSurfaceConditions,\n    scheme::SurfaceFluxes.SolverScheme = PointValueScheme();\n    tol_neutral = SFP.cp_d(param_set) / 100,\n    tol = sqrt(eps(FT)),\n    maxiter::Int = 10,\n)\n\nThe main user-facing function of the module. Computes surface conditions based on Monin-Obukhov similarity theory.\n\nArguments\n\nparam_set: Parameter set containing physical and thermodynamic constants\nsc: Surface conditions container (Fluxes, ValuesOnly, Coefficients, or FluxesAndFrictionVelocity)\nscheme: Discretization scheme (PointValueScheme for finite difference or LayerAverageScheme for finite volume)\ntol_neutral: Tolerance for neutral stability detection based on ΔDSEᵥ (default: cp_d / 100)\ntol: Convergence tolerance for iterative solver (default: sqrt(eps(FT)))\nmaxiter: Maximum number of iterations (default: 10)\n\nReturns\n\nReturns a SurfaceFluxConditions struct containing:\n\nL_MO:   Monin-Obukhov lengthscale [m]\nshf:    Sensible heat flux [W/m²]\nlhf:    Latent heat flux [W/m²]\nρτxz:   Momentum flux, eastward component [kg/(m·s²)]\nρτyz:   Momentum flux, northward component [kg/(m·s²)]\nustar:  Friction velocity [m/s]\nCd:     Momentum exchange coefficient\nCh:     Heat exchange coefficient\nE:      Evaporation rate [kg/(m²·s)]\n\n\n\n\n\n","category":"function"},{"location":"API/#SurfaceFluxes.recover_profile","page":"API Reference","title":"SurfaceFluxes.recover_profile","text":"recover_profile(param_set, sc, L_MO, Z, X_in, X_sfc, transport, scheme)\n\nRecover profiles of variable X given values of Z coordinates. Follows Nishizawa equation (21,22)\n\nArguments\n\nparam_set: Abstract Parameter Set containing physical, thermodynamic parameters.\nsc: Container for surface conditions based on known combination     of the state vector, and {fluxes, friction velocity, exchange coefficients} for a given experiment\nL_MO: Monin-Obukhov length\nZ: Z coordinate(s) (within surface layer) for which variable values are required\nX_star: Scale parameter for variable X\nX_sfc: For variable X, values at surface nodes\ntransport: Transport type, (e.g. Momentum or Heat, used to determine physical scale coefficients)\nscheme: Discretization scheme (currently supports FD and FV)\n\n\n\n\n\n","category":"function"},{"location":"API/#Universal-Functions-Module","page":"API Reference","title":"Universal Functions Module","text":"","category":"section"},{"location":"API/","page":"API Reference","title":"API Reference","text":"SurfaceFluxes.UniversalFunctions","category":"page"},{"location":"API/#SurfaceFluxes.UniversalFunctions","page":"API Reference","title":"SurfaceFluxes.UniversalFunctions","text":"UniversalFunctions\n\nUniversal stability and stability correction functions for SurfaceFluxes module.  Supports the following universal functions:\n\nBusinger: Businger et al. (1971), Dyer (1974)\nGryanik: Gryanik et al. (2020)\nGrachev: Grachev et al. (2007)\n\n\n\n\n\n","category":"module"},{"location":"API/#Parameter-Types","page":"API Reference","title":"Parameter Types","text":"","category":"section"},{"location":"API/","page":"API Reference","title":"API Reference","text":"SurfaceFluxes.UniversalFunctions.BusingerParams\nSurfaceFluxes.UniversalFunctions.GryanikParams\nSurfaceFluxes.UniversalFunctions.GrachevParams","category":"page"},{"location":"API/#SurfaceFluxes.UniversalFunctions.BusingerParams","page":"API Reference","title":"SurfaceFluxes.UniversalFunctions.BusingerParams","text":"BusingerParams{FT}\n\nParameter bundle for the Businger (1971) similarity relations. Mappings to Nishizawa & Kitamura (2018) coefficients:\n\na_m, a_h: The linear coefficients for stable conditions (β in some texts).\nb_m, b_h: The coefficients γ inside the unstable sqrt/cbrt terms (e.g., (1 - γζ)).\nPr_0: The neutral Prandtl number.\n\nSee Businger et al. (1971) and Nishizawa & Kitamura (2018).\n\n\n\n\n\n","category":"type"},{"location":"API/#SurfaceFluxes.UniversalFunctions.GryanikParams","page":"API Reference","title":"SurfaceFluxes.UniversalFunctions.GryanikParams","text":"GryanikParams{FT}\n\nParameter bundle for the Gryanik et al. (2020) similarity relations. These functions are designed to be valid across the entire stability range, including very stable conditions.\n\na_m, b_m: Coefficients for momentum stability function (Eq. 32).\na_h, b_h: Coefficients for heat stability function (Eq. 33).\nPr_0: Neutral Prandtl number. (The paper recommends Pr_0 ≈ 0.98.)\n\nReference: Gryanik et al. (2020).\n\n\n\n\n\n","category":"type"},{"location":"API/#SurfaceFluxes.UniversalFunctions.GrachevParams","page":"API Reference","title":"SurfaceFluxes.UniversalFunctions.GrachevParams","text":"GrachevParams{FT}\n\nParameter bundle for the Grachev et al. (2007) similarity relations, based on SHEBA data.\n\na_m, b_m: Coefficients for momentum stability function (Eq. 9a).\na_h, b_h, c_h: Coefficients for heat stability function (Eq. 9b). Note: c_h is the coefficient for the linear ζ term in the denominator.\n\nReference: Grachev et al. (2007).\n\n\n\n\n\n","category":"type"},{"location":"API/#Transport-Types","page":"API Reference","title":"Transport Types","text":"","category":"section"},{"location":"API/","page":"API Reference","title":"API Reference","text":"SurfaceFluxes.UniversalFunctions.MomentumTransport\nSurfaceFluxes.UniversalFunctions.HeatTransport","category":"page"},{"location":"API/#SurfaceFluxes.UniversalFunctions.MomentumTransport","page":"API Reference","title":"SurfaceFluxes.UniversalFunctions.MomentumTransport","text":"MomentumTransport\n\nType selecting momentum-transfer stability functions (ϕₘ, ψₘ, Ψₘ).\n\n\n\n\n\n","category":"type"},{"location":"API/#SurfaceFluxes.UniversalFunctions.HeatTransport","page":"API Reference","title":"SurfaceFluxes.UniversalFunctions.HeatTransport","text":"HeatTransport\n\nType selecting heat-transfer stability functions (ϕₕ, ψₕ, Ψₕ).\n\n\n\n\n\n","category":"type"},{"location":"API/#Core-Functions","page":"API Reference","title":"Core Functions","text":"","category":"section"},{"location":"API/","page":"API Reference","title":"API Reference","text":"SurfaceFluxes.UniversalFunctions.phi\nSurfaceFluxes.UniversalFunctions.psi\nSurfaceFluxes.UniversalFunctions.Psi","category":"page"},{"location":"API/#SurfaceFluxes.UniversalFunctions.phi","page":"API Reference","title":"SurfaceFluxes.UniversalFunctions.phi","text":"phi\n\nUniversal stability function for wind shear (ϕ_m) and  temperature gradient (ϕ_h)\n\n\n\n\n\n","category":"function"},{"location":"API/#SurfaceFluxes.UniversalFunctions.psi","page":"API Reference","title":"SurfaceFluxes.UniversalFunctions.psi","text":"psi(p, ζ, transport_type)\n\nThe standard integrated stability correction function ψ(ζ). Defined as:     ψ(ζ) = ∫0 to ζ / x dx\n\nThis is the standard correction used in point-based Monin-Obukhov similarity theory. Note that while ϕ(0) is typically 1, it may differ  (e.g. ϕh(0) = Pr0 in Gryanik et al., 2020).\n\n\n\n\n\n","category":"function"},{"location":"API/#SurfaceFluxes.UniversalFunctions.Psi","page":"API Reference","title":"SurfaceFluxes.UniversalFunctions.Psi","text":"Psi(p, ζ, transport_type)\n\nThe volume-averaged stability correction function Ψ(ζ). Mathematically, this is defined as:     Ψ(ζ) = (1/ζ) ∫[0 to ζ] ψ(x) dx\n\nThis function is required for finite-volume models where fluxes are calculated using cell-averaged values rather than point values at the cell center.\n\nSee Nishizawa & Kitamura (2018), Eqs. 14 & 15.\n\n\n\n\n\n","category":"function"}]
}
