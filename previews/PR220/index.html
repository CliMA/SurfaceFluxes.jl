<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Home · SurfaceFluxes.jl</title><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href><img src="assets/logo.svg" alt="SurfaceFluxes.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href>SurfaceFluxes.jl</a></span></div><form class="docs-search" action="search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>Home</a><ul class="internal"><li><a class="tocitem" href="#Overview"><span>Overview</span></a></li><li><a class="tocitem" href="#Installation"><span>Installation</span></a></li><li><a class="tocitem" href="#Quick-Start"><span>Quick Start</span></a></li><li><a class="tocitem" href="#Automatic-Differentiation"><span>Automatic Differentiation</span></a></li><li><a class="tocitem" href="#Documentation-Structure"><span>Documentation Structure</span></a></li><li><a class="tocitem" href="#Related-Packages"><span>Related Packages</span></a></li></ul></li><li><a class="tocitem" href="SurfaceFluxes/">Surface Fluxes Theory</a></li><li><a class="tocitem" href="UniversalFunctions/">Universal Functions</a></li><li><a class="tocitem" href="PhysicalScales/">Physical Scales</a></li><li><a class="tocitem" href="ExchangeFluxes/">Exchange Fluxes</a></li><li><a class="tocitem" href="PrescribedConditions/">Prescribed Conditions</a></li><li><a class="tocitem" href="TestSuite/">Test Suite</a></li><li><a class="tocitem" href="API/">API Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Home</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Home</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/CliMA/SurfaceFluxes.jl/blob/main/docs/src/index.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="SurfaceFluxes.jl"><a class="docs-heading-anchor" href="#SurfaceFluxes.jl">SurfaceFluxes.jl</a><a id="SurfaceFluxes.jl-1"></a><a class="docs-heading-anchor-permalink" href="#SurfaceFluxes.jl" title="Permalink"></a></h1><p><em>A package for computing surface fluxes using Monin-Obukhov Similarity Theory (MOST)</em></p><h2 id="Overview"><a class="docs-heading-anchor" href="#Overview">Overview</a><a id="Overview-1"></a><a class="docs-heading-anchor-permalink" href="#Overview" title="Permalink"></a></h2><p>SurfaceFluxes.jl provides a robust and efficient set of tools for calculating turbulent surface fluxes of momentum, heat, and moisture between the surface and the atmosphere. It is designed for use in climate models, large-eddy simulations (LES), and offline analysis.</p><p>The package implements <strong>Monin-Obukhov Similarity Theory (MOST)</strong> to relate surface fluxes to gradients of mean variables (wind speed, temperature, humidity) in the surface layer. It solves the nonlinear equations iteratively to determine the Obukhov stability parameter <span>$\zeta$</span> and the corresponding fluxes.</p><h3 id="Key-Features"><a class="docs-heading-anchor" href="#Key-Features">Key Features</a><a id="Key-Features-1"></a><a class="docs-heading-anchor-permalink" href="#Key-Features" title="Permalink"></a></h3><ul><li><strong>Robust Iterative Solver</strong>: Efficiently solves for the Monin-Obukhov stability parameter <span>$\zeta$</span>, supporting various roughness length parameterizations and flexible computation of skin temperature and humidity.</li><li><strong>Universal Functions</strong>: Supports multiple parameterizations:<ul><li><strong>Businger</strong>: The classic Businger-Dyer formulations (<a href="https://doi.org/10.1175/1520-0469(1971)028&lt;0181:FPRITA&gt;2.0.CO;2">Businger et al. 1971</a>, <a href="https://doi.org/10.1007/BF00240838">Dyer 1974</a>).</li><li><strong>Gryanik</strong>: Improved functions for the stable boundary layer (<a href="https://doi.org/10.1175/JAS-D-19-0255.1">Gryanik et al. 2020</a>).</li><li><strong>Grachev</strong>: Functions derived from the SHEBA experiment for stable conditions over sea ice (<a href="https://doi.org/10.1007/s10546-007-9177-6">Grachev et al. 2007</a>).</li></ul></li><li><strong>Thermodynamic Consistency</strong>: Integrated with <a href="https://github.com/CliMA/Thermodynamics.jl">Thermodynamics.jl</a> for accurate and consistent handling of moist air properties.</li><li><strong>GPU Compatibility</strong>: Type stable and designed for high-performance computing with full GPU support via <a href="https://github.com/JuliaGPU/CUDA.jl">CUDA.jl</a>.</li><li><strong>Automatic Differentiation</strong>: Compatible with AD frameworks such as <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>.</li><li><strong>Flexible Discretization</strong>: Supports both <strong>finite-difference</strong> (point-wise) and <strong>finite-volume</strong> (layer-averaged) schemes.</li></ul><h2 id="Installation"><a class="docs-heading-anchor" href="#Installation">Installation</a><a id="Installation-1"></a><a class="docs-heading-anchor-permalink" href="#Installation" title="Permalink"></a></h2><p>SurfaceFluxes.jl is a registered Julia package. You can install it using the package manager:</p><pre><code class="language-julia hljs">using Pkg
Pkg.add(&quot;SurfaceFluxes&quot;)</code></pre><h2 id="Quick-Start"><a class="docs-heading-anchor" href="#Quick-Start">Quick Start</a><a id="Quick-Start-1"></a><a class="docs-heading-anchor-permalink" href="#Quick-Start" title="Permalink"></a></h2><p>Here is a simple example of how to compute surface fluxes given atmospheric state variables.</p><pre><code class="language-julia hljs">using SurfaceFluxes
import SurfaceFluxes.Parameters as SFP
import SurfaceFluxes.UniversalFunctions as UF
import ClimaParams
import Thermodynamics as TD

# 1. Define Parameters
FT = Float32
# Create parameter set using Businger universal functions
param_set = SFP.SurfaceFluxesParameters(FT, UF.BusingerParams)

# 2. Define State Variables
# Interior (air) state at height Δz
T_int = FT(298.0)      # Temperature [K]
q_tot = FT(0.017)      # Total specific humidity [kg/kg]
q_liq = FT(0.0)        # Liquid specific humidity [kg/kg]
q_ice = FT(0.0)        # Ice specific humidity [kg/kg]
ρ_int = FT(1.2)        # Air density [kg/m³]
u_int = (FT(5.0), FT(0.0)) # Wind vector [m/s]
Δz    = FT(25.0)       # Height above surface [m]

# Surface state
T_sfc = FT(300.0)      # Surface temperature [K]
q_sfc = FT(0.02)      # Surface specific humidity [kg/kg]
Φ_sfc = FT(0.0)        # Surface geopotential [m²/s²]
u_sfc = (FT(0.0), FT(0.0)) # Surface wind (usually 0)
d     = FT(5.0)        # Displacement height [m]

# 3. Compute Surface Fluxes
# This function iterates to find the stability parameter ζ
result = surface_fluxes(
    param_set,
    T_int, q_tot, q_liq, q_ice, ρ_int,
    T_sfc, q_sfc, Φ_sfc,
    Δz, d,
    u_int, u_sfc
)

# 4. Access Results
println(&quot;Sensible Heat Flux: &quot;, round(result.shf; digits=1), &quot; W/m²&quot;)
println(&quot;Latent Heat Flux:   &quot;, round(result.lhf; digits=1), &quot; W/m²&quot;)
println(&quot;Friction Velocity:  &quot;, round(result.ustar; digits=3), &quot; m/s&quot;)
println(&quot;Stability (ζ):      &quot;, round(result.ζ; digits=4))
println(&quot;Obukhov Length:     &quot;, round(result.L_MO; digits=1), &quot; m&quot;)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Sensible Heat Flux: 32.0 W/m²
Latent Heat Flux:   125.4 W/m²
Friction Velocity:  0.223 m/s
Stability (ζ):      -0.7618
Obukhov Length:     -26.3 m</code></pre><p>The output shows positive sensible and latent heat fluxes (surface warmer and moister than air above it → upward sensible and latent heat transport). The stability parameter <span>$\zeta &lt; 0$</span> indicates unstable conditions.</p><h2 id="Automatic-Differentiation"><a class="docs-heading-anchor" href="#Automatic-Differentiation">Automatic Differentiation</a><a id="Automatic-Differentiation-1"></a><a class="docs-heading-anchor-permalink" href="#Automatic-Differentiation" title="Permalink"></a></h2><p>SurfaceFluxes.jl is fully differentiable, making it suitable for use in optimization loops or implicit solvers where Jacobians are required. It is tested with <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>.</p><p>Here is an example of computing the derivative of the sensible heat flux (SHF) with respect to surface temperature (<span>$T_{\text{sfc}}$</span>).</p><pre><code class="language-julia hljs">using ForwardDiff

# Define a wrapper function that takes T_sfc as the variable
function compute_shf(T_sfc_val)
    # Re-use parameters and other state variables from the Quick Start above
    # Note: ForwardDiff passes a dual number, so T_sfc_val will be of type Dual
    result = surface_fluxes(
        param_set,
        T_int, q_tot, q_liq, q_ice, ρ_int,
        T_sfc_val, q_sfc, Φ_sfc,
        Δz, d,
        u_int, u_sfc
    )
    return result.shf
end

# Compute the value and derivative at T_sfc = 300.0 K
T_sfc_val = FT(300.0)
shf_val = compute_shf(T_sfc_val)
dSHF_dT = ForwardDiff.derivative(compute_shf, T_sfc_val)

println(&quot;SHF at 300K:        &quot;, round(shf_val; digits=2), &quot; W/m²&quot;)
println(&quot;d(SHF)/d(Ts):       &quot;, round(dSHF_dT; digits=2), &quot; W/m²/K&quot;)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">SHF at 300K:        31.99 W/m²
d(SHF)/d(Ts):       18.5 W/m²/K</code></pre><p>The derivative <span>$\partial \text{SHF}/\partial T_s &gt; 0$</span> indicates that increasing the surface temperature increases the upward sensible heat flux, as expected.</p><h2 id="Documentation-Structure"><a class="docs-heading-anchor" href="#Documentation-Structure">Documentation Structure</a><a id="Documentation-Structure-1"></a><a class="docs-heading-anchor-permalink" href="#Documentation-Structure" title="Permalink"></a></h2><table><tr><th style="text-align: right">Section</th><th style="text-align: right">Description</th></tr><tr><td style="text-align: right"><a href="SurfaceFluxes/">Surface Fluxes Theory</a></td><td style="text-align: right">Mathematical formulation of MOST</td></tr><tr><td style="text-align: right"><a href="UniversalFunctions/">Universal Functions</a></td><td style="text-align: right">Stability functions (ϕ, ψ, Ψ) and their parameterizations</td></tr><tr><td style="text-align: right"><a href="PhysicalScales/">Physical Scales</a></td><td style="text-align: right">Friction velocity <span>$u_*$</span>, temperature scale <span>$\theta_*$</span>, Obukhov length</td></tr><tr><td style="text-align: right"><a href="ExchangeFluxes/">Exchange Fluxes</a></td><td style="text-align: right">Sensible heat, latent heat, and momentum fluxes</td></tr><tr><td style="text-align: right"><a href="PrescribedConditions/">Prescribed Conditions</a></td><td style="text-align: right">Operating modes for prescribed fluxes, temperatures, or coefficients</td></tr><tr><td style="text-align: right"><a href="TestSuite/">Test Suite</a></td><td style="text-align: right">Comprehensive testing for correctness and numerical stability</td></tr><tr><td style="text-align: right"><a href="API/">API Reference</a></td><td style="text-align: right">Complete function documentation</td></tr></table><h2 id="Related-Packages"><a class="docs-heading-anchor" href="#Related-Packages">Related Packages</a><a id="Related-Packages-1"></a><a class="docs-heading-anchor-permalink" href="#Related-Packages" title="Permalink"></a></h2><p>SurfaceFluxes.jl is part of the <a href="https://github.com/CliMA">CliMA</a> ecosystem:</p><ul><li><a href="https://github.com/CliMA/Thermodynamics.jl">Thermodynamics.jl</a>: Moist thermodynamic calculations</li><li><a href="https://github.com/CliMA/RootSolvers.jl">RootSolvers.jl</a>: Iterative root-finding algorithms</li><li><a href="https://github.com/CliMA/ClimaParams.jl">ClimaParams.jl</a>: Centralized parameter management</li></ul></article><nav class="docs-footer"><a class="docs-footer-nextpage" href="SurfaceFluxes/">Surface Fluxes Theory »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Saturday 10 January 2026 05:14">Saturday 10 January 2026</span>. Using Julia version 1.11.8.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
