var documenterSearchIndex = {"docs":
[{"location":"UniversalFunctions/#Universal-Functions-in-SurfaceFluxes.jl","page":"Universal Functions","title":"Universal Functions in SurfaceFluxes.jl","text":"","category":"section"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"UniversalFunctions.jl provides the stability functions (universal functions) required by Monin-Obukhov Similarity Theory (MOST) to calculate surface fluxes of momentum and heat/tracers. These functions describe the non-dimensional gradients of wind speed and potential temperature/tracers as a function of the stability parameter","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"zeta = fracz - dL","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"where z is the height above surface, d is the displacement height, and L is the Obukhov length.","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"The module supports three distinct parameterizations:","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Businger: The classic Businger-Dyer formulations (Businger et al. 1971, Dyer 1974).\nGryanik: Improved functions for the stable boundary layer (Gryanik et al. 2020).\nGrachev: Functions derived from the SHEBA experiment for stable conditions over sea ice (Grachev et al. 2007).","category":"page"},{"location":"UniversalFunctions/#Mathematical-Framework","page":"Universal Functions","title":"Mathematical Framework","text":"","category":"section"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"In MOST, the vertical gradients of mean wind speed (u) and potential temperature (theta) are scaled by the friction velocity (u_*) and temperature scale (theta_*),","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"beginequation\nfrackappa (z-d)u_* fracpartial upartial z = phi_m(zeta)\nendequation","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"and","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"beginequation\nfrackappa (z-d)theta_* fracpartial thetapartial z = phi_h(zeta)\nendequation","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"where phi_m and phi_h are the universal stability functions for momentum and heat, respectively, and kappa approx 04 is the von Kármán constant.","category":"page"},{"location":"UniversalFunctions/#Neutral-Limits","page":"Universal Functions","title":"Neutral Limits","text":"","category":"section"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"A key consistency rule in SurfaceFluxes.jl is how the functions behave at neutral stability (zeta = 0):","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Momentum: phi_m(0) = 1.\nHeat/Scalars: phi_h(0) = textPr_0.\nFor Businger and Gryanik, textPr_0 is a configurable parameter (typically 0.74 or 0.98).\nFor Grachev, textPr_0 is physically 1.0 (matching the derivation in Grachev et al. 2007). In the code, Pr_0 is explicitly set to 1.0 by the constructor, but the variable is retained in the equations for structural consistency.","category":"page"},{"location":"UniversalFunctions/#Integrated-Stability-Correction-Functions","page":"Universal Functions","title":"Integrated Stability Correction Functions","text":"","category":"section"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"We also define the integrated stability correction functions (psi) that define corrections to logarithmic profiles, including their volume-averaged forms (Psi) used with finite-volume schemes:","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"The function psi(zeta): The standard integral form used to correct point profiles (for finite-difference schemes):","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"beginequation\npsi(zeta) = int_0^zeta fracphi(0) - phi(x)x dx\nendequation","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"This function is used to obtain the wind profile:","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"beginequation\nu(z) = fracu_*kappa left lnleft(fracz-dz_0right) - psi_m(zeta) + psi_m(zeta_0) right\nendequation","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"where zeta_0 = z_0mL is the stability parameter at the roughness height z_0m.","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Similarly, the potential temperature profile is obtained using the heat stability correction function:","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"beginequation\ntheta(z) = theta_0 + fractheta_*kappa  left phi_h(0) lnleft(fracz-dz_0hright) - psi_h(zeta) + psi_h(zeta_0) right\nendequation","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"where theta_0 is the surface potential temperature, zeta_0 = z_0hL is the stability parameter at the roughness height z_0h, and theta_* is the temperature scale.","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"note: Neutral Prandtl Number\nNote the inclusion of phi_h(0) in the logarithmic term for heat and scalars. This accounts for the neutral limit of the non-dimensional gradient, which depends on the parameterization (typically phi_h(0) = textPr_0, where textPr_0 = 10 for Grachev).","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"The function Psi(zeta): The volume-averaged form required when model variables represent cell averages (in finite-volume schemes) rather than point values (Nishizawa & Kitamura, 2018):","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"beginequation\nPsi(zeta) = frac1zeta int_0^zeta psi(x) dx\nendequation","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"For finite-volume schemes, where fluxes are computed using cell-averaged values, this function is used to obtain the vertical profiles. For example, the layer-averaged wind speed is calculated as:","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"beginequation\nbaru(z) = fracu_*kappa left lnleft(fracz-dz_0right) - Psi_m(zeta) + fracz_0Delta z Psi_m(zeta_0) + left(1 - fracz_0Delta zright)(psi_m(zeta_0) - 1) right\nendequation","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"where Delta z = z - d is the thickness of the first layer.","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"","category":"page"},{"location":"UniversalFunctions/#.-Businger-Dyer-Functions","page":"Universal Functions","title":"1. Businger-Dyer Functions","text":"","category":"section"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"The Businger parameterization is the standard formulation for the unstable and weakly stable boundary layer. Our implementation follows the forms detailed in Nishizawa & Kitamura (2018), which provides a unified treatment of both stable and unstable conditions.","category":"page"},{"location":"UniversalFunctions/#Parameter-Structure","page":"Universal Functions","title":"Parameter Structure","text":"","category":"section"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"The BusingerParams struct contains:","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Pr_0: The neutral Prandtl number\na_m, a_h: Linear coefficients for stable conditions (denoted as beta in some texts)\nb_m, b_h: Coefficients inside the unstable sqrt/cbrt terms (denoted as gamma in the unstable forms)","category":"page"},{"location":"UniversalFunctions/#Unstable-Conditions-(\\zeta-0)","page":"Universal Functions","title":"Unstable Conditions (zeta  0)","text":"","category":"section"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"For unstable conditions, the functions follow the Dyer-Hicks form (Nishizawa & Kitamura 2018, Eqs. A1-A2 for L  0), scaled by textPr_0 for heat to ensure continuity at zeta=0:","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"beginequation\nphi_m(zeta) = (1 - b_m zeta)^-14\nendequation","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"and","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"beginequation\nphi_h(zeta) = textPr_0 (1 - b_h zeta)^-12\nendequation","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"where, typically, b_m=15 and b_h=9.","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"The corresponding integrated functions (psi) involve logarithmic and arctangent terms (Nishizawa & Kitamura 2018, Eqs. A3-A4 for L  0):","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"beginequation\npsi_m(zeta) = lnleftfrac(1 + x)^2(1 + x^2)8right - 2tan^-1(x) + fracpi2\nendequation","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"where x = (1 - b_m zeta)^14. For heat, the function is scaled by textPr_0:","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"beginequation\npsi_h(zeta) = 2 textPr_0 lnleft(frac1 + y2right)\nendequation","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"where y = (1 - b_h zeta)^12.","category":"page"},{"location":"UniversalFunctions/#Stable-Conditions-(\\zeta-\\ge-0)","page":"Universal Functions","title":"Stable Conditions (zeta ge 0)","text":"","category":"section"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"For stable conditions, the Businger-Dyer functions are linear:","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"beginequation\nphi_m(zeta) = 1 + a_m zeta\nendequation","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"and","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"beginequation\nphi_h(zeta) = textPr_0 + a_h zeta\nendequation","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"note: Neutral Prandtl Number\nIn our implementation, we ensure that the heat functions satisfy the neutral limit phi_h(0) = textPr_0. This ensures consistency with other parameterizations, such as Gryanik et al. (2020), and proper behavior of the dimensionless profiles.","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"The integrated forms are (Nishizawa & Kitamura 2018, Eqs. A3-A4 for L ge 0):","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"beginequation\npsi_m(zeta) = -a_m zeta\nendequation","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"and","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"beginequation\npsi_h(zeta) = -a_h zeta\nendequation","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"where in the second equation we have applied the scaling by textPr_0 relative to the equations in Nishizawa & Kitamura (2018).","category":"page"},{"location":"UniversalFunctions/#Volume-Averaged-Forms","page":"Universal Functions","title":"Volume-Averaged Forms","text":"","category":"section"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"The volume-averaged functions Psi are implemented for both momentum and heat transport, following Nishizawa & Kitamura (2018, Eqs. A5-A6, A13-A14), with heat functions scaled by textPr_0.","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Stable Conditions (zeta ge 0):","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"For stable conditions, the volume-averaged functions reduce to:","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"beginequation\nPsi_m(zeta) = -fraca_m zeta2\nendequation","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"and","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"beginequation\nPsi_h(zeta) = -fraca_h zeta2\nendequation","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Unstable Conditions (zeta  0):","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"For unstable conditions, computations follow Nishizawa & Kitamura (2018, Eqs. A5-A6), with appropriate textPr_0 scaling for heat.","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"For momentum:","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"beginequation\nPsi_m(zeta) = lnleftfrac(1 + x)^2(1 + x^2)8right - 2tan^-1(x) + fracpi2 - 1 + frac1 - x^33b_m zeta4\nendequation","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"where x = (1 - b_m zeta)^14. For small zeta, this reduces to Psi_m(zeta) approx -b_m zeta8 (Nishizawa & Kitamura 2018, Eq. A13). We use the linearized form for small zeta to avoid numerical precision issues.","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"For heat:","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"beginequation\nPsi_h(zeta) = textPr_0 left 2lnleft(frac1 + y2right) + frac2(1 - y)b_h zeta - 1 right\nendequation","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"where y = (1 - b_h zeta)^12. For small zeta, this reduces to Psi_h(zeta) approx - textPr_0 b_h zeta4 (Nishizawa & Kitamura 2018, Eq. A14, with the scaling by textPr_0 applied).","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"","category":"page"},{"location":"UniversalFunctions/#.-Gryanik-Universal-Functions","page":"Universal Functions","title":"2. Gryanik Universal Functions","text":"","category":"section"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"The Gryanik et al. (2020) parameterization is designed to improve surface flux calculations in the stable boundary layer. It addresses issues where standard functions underestimate fluxes in very stable conditions.","category":"page"},{"location":"UniversalFunctions/#Parameter-Structure-2","page":"Universal Functions","title":"Parameter Structure","text":"","category":"section"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"The GryanikParams struct contains:","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Pr_0: Neutral Prandtl number (Grayanik et al. recommend textPr_0 approx 098)\na_m, b_m: Coefficients for momentum stability function\na_h, b_h: Coefficients for heat stability function\nb_m_unstable, b_h_unstable: Parameters for unstable branch (automatically set to Businger values)","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"note: Unstable Branch Parameters\nThe unstable branch parameters (b_m_unstable and b_h_unstable) are automatically set to the Businger parameter values to ensure consistency. This means the unstable branches of Gryanik functions use the same coefficients as the Businger formulation and continuously connect to the unstable branch of Businger functions.","category":"page"},{"location":"UniversalFunctions/#Stable-Conditions-(\\zeta-0)","page":"Universal Functions","title":"Stable Conditions (zeta  0)","text":"","category":"section"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Gryanik proposes new forms that remain valid across a wide stability range.","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Momentum (phi_m):","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"beginequation\nphi_m(zeta) = 1 + fraca_m zeta(1 + b_m zeta)^23\nendequation","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Heat (phi_h):","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"beginequation\nphi_h(zeta) = textPr_0 left( 1 + fraca_h zeta1 + b_h zeta right)\nendequation","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Note that phi_h(0) = textPr_0 for Gryanik, consistent with our Businger implementation.","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Integrated Corrections (psi): The code implements the analytical integrals derived in the paper:","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"beginequation\npsi_m(zeta) = -3 fraca_mb_m left (1 + b_m zeta)^13 - 1 right\nendequation","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"and","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"beginequation\npsi_h(zeta) = -textPr_0 fraca_hb_h ln(1 + b_h zeta)\nendequation","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Volume-Averaged Forms (Psi): The volume-averaged functions are analytically derived from the psi functions:","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"beginequation\nPsi_m(zeta) = 3fraca_mb_m - frac9 a_m4 b_m^2 zeta left (1 + b_m zeta)^43 - 1 right\nendequation","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"and","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"beginequation\nPsi_h(zeta) = -fractextPr_0 a_hb_h zeta left left(frac1b_h + zetaright) ln(1 + b_h zeta) - zeta right\nendequation","category":"page"},{"location":"UniversalFunctions/#Unstable-Conditions-(\\zeta-0)-2","page":"Universal Functions","title":"Unstable Conditions (zeta  0)","text":"","category":"section"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"For the unstable regime, Gryanik et al. (2020) recommend reverting to the standard Businger-Dyer forms to ensure continuity at zeta=0. Our implementation uses the Businger unstable forms with coefficients b_m_unstable and b_h_unstable (which are set to the Businger parameters). The unstable heat function is scaled by textPr_0 to ensure a continuous transition at the neutral limit (zeta=0):","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"beginequation\nphi_h(zeta) = textPr_0 (1 - b_htextunstable zeta)^-12\nendequation","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"","category":"page"},{"location":"UniversalFunctions/#.-Grachev-Universal-Functions","page":"Universal Functions","title":"3. Grachev Universal Functions","text":"","category":"section"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"The Grachev et al. (2007) functions were derived from measurements of the stable atmospheric boundary layer over sea ice from the SHEBA dataset.","category":"page"},{"location":"UniversalFunctions/#Parameter-Structure-3","page":"Universal Functions","title":"Parameter Structure","text":"","category":"section"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"The GrachevParams struct contains:","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Pr_0: Neutral Prandtl number (explicitly set to 1.0)\na_m, b_m: Coefficients for momentum stability function\na_h, b_h, c_h: Coefficients for heat stability function (note: c_h is the coefficient for the linear zeta term in the denominator)\nb_m_unstable, b_h_unstable: Parameters for unstable branch (automatically set to the Businger parameters)","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"note: Unstable Branch Parameters\nSimilar to Gryanik, the unstable branch parameters are automatically set to the Businger parameters to ensure consistency and continuity at zeta=0.","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"note: Neutral Prandtl Number\nFor Grachev, Pr_0 is explicitly set to 1.0 in the GrachevParams constructor. This matches the physical derivation in Grachev et al. (2007), which assumes phi_h(0) = 1. The code retains the Pr_0 variable in the functions for generality, but it will always be 1.0 for this parameterization.","category":"page"},{"location":"UniversalFunctions/#Stable-Conditions-(\\zeta-0)-2","page":"Universal Functions","title":"Stable Conditions (zeta  0)","text":"","category":"section"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Momentum (phi_m):","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"beginequation\nphi_m(zeta) = 1 + fraca_m zeta (1 + zeta)^131 + b_m zeta\nendequation","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Heat (phi_h):","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"beginequation\nphi_h(zeta) = textPr_0 left( 1 + fraca_h zeta + b_h zeta^21 + c_h zeta + zeta^2 right)\nendequation","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Integrated Corrections (psi): The integrated forms are complex, involving multiple logarithmic and arctangent terms. See Grachev et al. (2007, Eqs. 12 and 13) for the full derivation.","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"For momentum (Grachev et al. 2007, Eq. 12):","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"beginequation\npsi_m(zeta) = -3fraca_mb_m(x - 1) + fraca_m B_m2 b_m left 2lnleft(fracx + B_m1 + B_mright) - lnleft(fracx^2 - x B_m + B_m^21 - B_m + B_m^2right) + 2sqrt3left(arctanleft(frac2x - B_msqrt3 B_mright) - arctanleft(frac2 - B_msqrt3 B_mright)right) right\nendequation","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"where x = (1 + zeta)^13 and B_m = ((1 - b_m)b_m)^13.","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"For heat (Grachev et al. 2007, Eq. 13):","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"beginequation\npsi_h(zeta) = textPr_0 left( -fracb_h2 ln(1 + c_h zeta + zeta^2) + left-fraca_hB_h + fracb_h c_h2 B_hright leftlnleft(frac2zeta + c_h - B_h2zeta + c_h + B_hright) - lnleft(fracc_h - B_hc_h + B_hright)right right)\nendequation","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"where B_h = sqrtc_h^2 - 4. Note that scalar multiplication by textPr_0 is applied to the entire result (consistent with the code), though physically textPr_0 = 10 for this parameterization.","category":"page"},{"location":"UniversalFunctions/#Unstable-Conditions-(\\zeta-0)-3","page":"Universal Functions","title":"Unstable Conditions (zeta  0)","text":"","category":"section"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"As for the Gryanik parameterization, the Grachev parameterization falls back to the Businger-Dyer forms for unstable conditions, using the b_m_unstable and b_h_unstable parameters. The heat function is scaled by Pr_0 (which is 1.0) for consistency with the code structure.","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"note: Volume-Averaged Grachev Function\nThe volume-averaged function Psi(zeta) is not implemented for Grachev due to the lack of closed-form analytical integrals for these complex functions.","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"","category":"page"},{"location":"UniversalFunctions/#Visualization-of-Universal-Functions","page":"Universal Functions","title":"Visualization of Universal Functions","text":"","category":"section"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"The following plots compare the behavior of these functions across different stability regimes and reproduce figures from the literature.","category":"page"},{"location":"UniversalFunctions/#Comparison-with-Gryanik-et-al.-(2020)","page":"Universal Functions","title":"Comparison with Gryanik et al. (2020)","text":"","category":"section"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"The following plots reproduce Figures 1 and 2 from Gryanik et al. (2020), showing the behavior of phi and psi in stable conditions.","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"include(\"plot_universal_functions.jl\")","category":"page"},{"location":"UniversalFunctions/#Figures-1-and-2:-Stable-Conditions-(Linear-Scale)","page":"Universal Functions","title":"Figures 1 & 2: Stable Conditions (Linear Scale)","text":"","category":"section"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Momentum stability function phi_m for stable conditions.","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"(Image: )","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Heat stability function phi_h for stable conditions. Note that Gryanik has phi_h(0) = textPr_0 approx 098.","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"(Image: )","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Momentum stability correction function psi_m for stable conditions.","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"(Image: )","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Heat stability correction function psi_h for stable conditions.","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"(Image: )","category":"page"},{"location":"UniversalFunctions/#Figure-3:-Extended-Stability-Range-(Log-Log-Scale)","page":"Universal Functions","title":"Figure 3: Extended Stability Range (Log-Log Scale)","text":"","category":"section"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Momentum stability function phi_m over extended stability range (log-log scale).","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"(Image: )","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Heat stability function phi_h over extended stability range (log-log scale).","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"(Image: )","category":"page"},{"location":"UniversalFunctions/#Comparison-with-Businger-(1971)","page":"Universal Functions","title":"Comparison with Businger (1971)","text":"","category":"section"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"The classic Businger et al. (1971) curves for phi_m and phi_h, along with the other parameterizations, across both stable and unstable conditions.","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Momentum stability functions phi_m for stable and unstable conditions, illustrating continuity across the regimes and convergence of all parameterizations to the Businger-Dyer forms in the unstable regime.","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"(Image: )","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Heat stability function phi_h for stable and unstable conditions, illustrating continuity across the regimes and convergence of all parameterizations to the Businger-Dyer forms in the unstable regime.","category":"page"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"(Image: )","category":"page"},{"location":"UniversalFunctions/#References","page":"Universal Functions","title":"References","text":"","category":"section"},{"location":"UniversalFunctions/","page":"Universal Functions","title":"Universal Functions","text":"Businger, J. A., Wyngaard, J. C., Izumi, Y., & Bradley, E. F. (1971). Flux-profile relationships in the atmospheric surface layer. Journal of the Atmospheric Sciences, 28, 181-189. DOI: 10.1175/1520-0469(1971)028<0181:FPRITA>2.0.CO;2\nDyer, A. J. (1974). A review of flux-profile relationships. Boundary-Layer Meteorology, 7, 363-372. DOI: 10.1007/BF00240838\nGryanik, V. M., Lüpkes, C., Grachev, A., and Sidorenko, D. (2020). New modified and extended stability functions for the stable boundary layer based on SHEBA and parametrizations of bulk transfer coefficients for climate models. Journal of the Atmospheric Sciences, 77, 2687–2716. DOI: 10.1175/JAS-D-19-0255.1\nGrachev, A. A., Andreas, E. L., Fairall, C. W., Guest, P. S., and Persson, P. O. G. (2007). SHEBA flux–profile relationships in the stable atmospheric boundary layer. Boundary-Layer Meteorology, 124, 315–333. DOI: 10.1007/s10546-007-9177-6\nNishizawa, S., & Kitamura, Y. (2018). A surface flux scheme based on the Monin-Obukhov similarity for finite volume models. Journal of Advances in Modeling Earth Systems, 10, 1-17. DOI: 10.1029/2018MS001534","category":"page"},{"location":"#SurfaceFluxes.jl","page":"Home","title":"SurfaceFluxes.jl","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"A package for computing surface fluxes using Monin-Obukhov Similarity Theory (MOST)","category":"page"},{"location":"#Overview","page":"Home","title":"Overview","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"SurfaceFluxes.jl provides a robust and efficient set of tools for calculating turbulent surface fluxes of momentum, heat, and moisture between the surface and the atmosphere. It is designed for use in climate models, large-eddy simulations (LES), and offline analysis.","category":"page"},{"location":"","page":"Home","title":"Home","text":"The package implements Monin-Obukhov Similarity Theory (MOST) to relate surface fluxes to gradients of mean variables (wind speed, temperature, humidity) in the surface layer. It solves the nonlinear equations iteratively to determine the Obukhov stability parameter zeta and the corresponding fluxes.","category":"page"},{"location":"#Key-Features","page":"Home","title":"Key Features","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"Robust Iterative Solver: Efficiently solves for the Monin-Obukhov stability parameter zeta, supporting various roughness length parameterizations and flexible computation of skin temperature and humidity.\nUniversal Functions: Supports multiple parameterizations:\nBusinger: The classic Businger-Dyer formulations (Businger et al. 1971, Dyer 1974).\nGryanik: Improved functions for the stable boundary layer (Gryanik et al. 2020).\nGrachev: Functions derived from the SHEBA experiment for stable conditions over sea ice (Grachev et al. 2007).\nThermodynamic Consistency: Integrated with Thermodynamics.jl for accurate and consistent handling of moist air properties.\nGPU Compatibility: Type stable and designed for high-performance computing with full GPU support via CUDA.jl.\nAutomatic Differentiation: Compatible with AD frameworks such as ForwardDiff.jl.\nFlexible Discretization: Supports both finite-difference (point-wise) and finite-volume (layer-averaged) schemes.","category":"page"},{"location":"#Installation","page":"Home","title":"Installation","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"SurfaceFluxes.jl is a registered Julia package. You can install it using the package manager:","category":"page"},{"location":"","page":"Home","title":"Home","text":"using Pkg\nPkg.add(\"SurfaceFluxes\")","category":"page"},{"location":"#Quick-Start","page":"Home","title":"Quick Start","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"Here is a simple example of how to compute surface fluxes given atmospheric state variables.","category":"page"},{"location":"","page":"Home","title":"Home","text":"using SurfaceFluxes\nimport SurfaceFluxes.Parameters as SFP\nimport SurfaceFluxes.UniversalFunctions as UF\nimport ClimaParams\nimport Thermodynamics as TD\n\n# 1. Define Parameters\nFT = Float32\n# Create parameter set using Businger universal functions\nparam_set = SFP.SurfaceFluxesParameters(FT, UF.BusingerParams)\n\n# 2. Define State Variables\n# Interior (air) state at height Δz\nT_int = FT(298.0)      # Temperature [K]\nq_tot = FT(0.017)      # Total specific humidity [kg/kg]\nq_liq = FT(0.0)        # Liquid specific humidity [kg/kg]\nq_ice = FT(0.0)        # Ice specific humidity [kg/kg]\nρ_int = FT(1.2)        # Air density [kg/m³]\nu_int = (FT(5.0), FT(0.0)) # Wind vector [m/s]\nΔz    = FT(25.0)       # Height above surface [m]\n\n# Surface state\nT_sfc = FT(300.0)      # Surface temperature [K]\nq_sfc = FT(0.02)      # Surface specific humidity [kg/kg]\nΦ_sfc = FT(0.0)        # Surface geopotential [m²/s²]\nu_sfc = (FT(0.0), FT(0.0)) # Surface wind (usually 0)\nd     = FT(5.0)        # Displacement height [m]\n\n# 3. Compute Surface Fluxes\n# This function iterates to find the stability parameter ζ\nresult = surface_fluxes(\n    param_set,\n    T_int, q_tot, q_liq, q_ice, ρ_int,\n    T_sfc, q_sfc, Φ_sfc,\n    Δz, d,\n    u_int, u_sfc\n)\n\n# 4. Access Results\nprintln(\"Sensible Heat Flux: \", round(result.shf; digits=1), \" W/m²\")\nprintln(\"Latent Heat Flux:   \", round(result.lhf; digits=1), \" W/m²\")\nprintln(\"Friction Velocity:  \", round(result.ustar; digits=3), \" m/s\")\nprintln(\"Stability (ζ):      \", round(result.ζ; digits=4))\nprintln(\"Obukhov Length:     \", round(result.L_MO; digits=1), \" m\")","category":"page"},{"location":"","page":"Home","title":"Home","text":"The output shows positive sensible and latent heat fluxes (surface warmer and moister than air above it → upward sensible and latent heat transport). The stability parameter zeta  0 indicates unstable conditions.","category":"page"},{"location":"#Automatic-Differentiation","page":"Home","title":"Automatic Differentiation","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"SurfaceFluxes.jl is fully differentiable, making it suitable for use in optimization loops or implicit solvers where Jacobians are required. It is tested with ForwardDiff.jl.","category":"page"},{"location":"","page":"Home","title":"Home","text":"Here is an example of computing the derivative of the sensible heat flux (SHF) with respect to surface temperature (T_textsfc).","category":"page"},{"location":"","page":"Home","title":"Home","text":"using ForwardDiff\n\n# Define a wrapper function that takes T_sfc as the variable\nfunction compute_shf(T_sfc_val)\n    # Re-use parameters and other state variables from the Quick Start above\n    # Note: ForwardDiff passes a dual number, so T_sfc_val will be of type Dual\n    result = surface_fluxes(\n        param_set,\n        T_int, q_tot, q_liq, q_ice, ρ_int,\n        T_sfc_val, q_sfc, Φ_sfc,\n        Δz, d,\n        u_int, u_sfc\n    )\n    return result.shf\nend\n\n# Compute the value and derivative at T_sfc = 300.0 K\nT_sfc_val = FT(300.0)\nshf_val = compute_shf(T_sfc_val)\ndSHF_dT = ForwardDiff.derivative(compute_shf, T_sfc_val)\n\nprintln(\"SHF at 300K:        \", round(shf_val; digits=2), \" W/m²\")\nprintln(\"d(SHF)/d(Ts):       \", round(dSHF_dT; digits=2), \" W/m²/K\")","category":"page"},{"location":"","page":"Home","title":"Home","text":"The derivative partial textSHFpartial T_s  0 indicates that increasing the surface temperature increases the upward sensible heat flux, as expected.","category":"page"},{"location":"#Documentation-Structure","page":"Home","title":"Documentation Structure","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"Section Description\nSurface Fluxes Theory Mathematical formulation of MOST\nUniversal Functions Stability functions (ϕ, ψ, Ψ) and their parameterizations\nPhysical Scales Friction velocity u_*, temperature scale theta_*, Obukhov length\nExchange Fluxes Sensible heat, latent heat, and momentum fluxes\nPrescribed Conditions Operating modes for prescribed fluxes, temperatures, or coefficients\nTest Suite Comprehensive testing for correctness and numerical stability\nAPI Reference Complete function documentation","category":"page"},{"location":"#Related-Packages","page":"Home","title":"Related Packages","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"SurfaceFluxes.jl is part of the CliMA ecosystem:","category":"page"},{"location":"","page":"Home","title":"Home","text":"Thermodynamics.jl: Moist thermodynamic calculations\nRootSolvers.jl: Iterative root-finding algorithms\nClimaParams.jl: Centralized parameter management","category":"page"},{"location":"PrescribedConditions/#Prescribed-Conditions","page":"Prescribed Conditions","title":"Prescribed Conditions","text":"","category":"section"},{"location":"PrescribedConditions/","page":"Prescribed Conditions","title":"Prescribed Conditions","text":"SurfaceFluxes.jl supports flexible operating modes for specifying boundary conditions. While the default behavior is to solve for the surface fluxes iteratively using Monin-Obukhov Similarity Theory (MOST) given the temperature and humidity at the surface, users can also prescribe specific fluxes or exchange coefficients. It is also possible to compute the surface temperature and humidity interactively via callbacks. This is particularly useful for:","category":"page"},{"location":"PrescribedConditions/","page":"Prescribed Conditions","title":"Prescribed Conditions","text":"Driving models with observed fluxes.\nCoupling to components that compute their own exchange coefficients (e.g., wave models).\nDetermining skin temperature over land/ice and implementing moisture limitations on evaporation.\nIdealized experiments with fixed boundary conditions.","category":"page"},{"location":"PrescribedConditions/#Flux-Specification","page":"Prescribed Conditions","title":"Flux Specification","text":"","category":"section"},{"location":"PrescribedConditions/","page":"Prescribed Conditions","title":"Prescribed Conditions","text":"The operating mode is controlled by the optional flux_specs argument in surface_fluxes. This argument accepts a FluxSpecs struct, which acts as a container for prescribed quantities:","category":"page"},{"location":"PrescribedConditions/","page":"Prescribed Conditions","title":"Prescribed Conditions","text":"FluxSpecs(shf=..., lhf=..., ustar=..., Cd=..., Ch=...)","category":"page"},{"location":"PrescribedConditions/","page":"Prescribed Conditions","title":"Prescribed Conditions","text":"Field Symbol Description Units\nshf H Sensible Heat Flux mathrmWm^-2\nlhf LE Latent Heat Flux mathrmWm^-2\nustar u_* Friction Velocity mathrmms^-1\nCd C_d Momentum Exchange Coefficient -\nCh C_h Heat Exchange Coefficient -","category":"page"},{"location":"PrescribedConditions/","page":"Prescribed Conditions","title":"Prescribed Conditions","text":"The solver detects which combination of parameters is provided and dispatches to the appropriate routine.","category":"page"},{"location":"PrescribedConditions/#Operating-Modes","page":"Prescribed Conditions","title":"Operating Modes","text":"","category":"section"},{"location":"PrescribedConditions/#.-Iterative-Solver-(Standard-MOST)","page":"Prescribed Conditions","title":"1. Iterative Solver (Standard MOST)","text":"","category":"section"},{"location":"PrescribedConditions/","page":"Prescribed Conditions","title":"Prescribed Conditions","text":"Inputs: Surface state (T_s q_s mathbfu_s) and Atmospheric state (T_a q_a mathbfu_a z d).\nUnknowns: Fluxes (H LE boldsymboltau), Coefficients (C_d C_h), Stability (zeta).","category":"page"},{"location":"PrescribedConditions/","page":"Prescribed Conditions","title":"Prescribed Conditions","text":"This is the default mode when flux_specs is empty or nothing. The solver iterates to find the Monin-Obukhov stability parameter zeta that satisfies the similarity relations.","category":"page"},{"location":"PrescribedConditions/","page":"Prescribed Conditions","title":"Prescribed Conditions","text":"# Standard call (positional arguments)\nconditions = surface_fluxes(param_set, T_int, ..., u_sfc, ...)","category":"page"},{"location":"PrescribedConditions/","page":"Prescribed Conditions","title":"Prescribed Conditions","text":"note: Simplified Examples\nThe examples below use simplified syntax (e.g., flux_specs=...) for clarity. In the actual API, surface_fluxes uses positional arguments. Users must provide all preceding arguments or use nothing for optional inputs. See the API Reference for the exact signature.","category":"page"},{"location":"PrescribedConditions/#.-Prescribed-Coefficients","page":"Prescribed Conditions","title":"2. Prescribed Coefficients","text":"","category":"section"},{"location":"PrescribedConditions/","page":"Prescribed Conditions","title":"Prescribed Conditions","text":"Inputs: Coefficients (C_d C_h).\nUnknowns: Fluxes (H LE boldsymboltau).","category":"page"},{"location":"PrescribedConditions/","page":"Prescribed Conditions","title":"Prescribed Conditions","text":"When both Cd and Ch are prescribed, the fluxes are computed directly from the bulk aerodynamic formulas without iteration. This is typical when coefficients are diagnosed by an external parameterization (e.g., a wave model).","category":"page"},{"location":"PrescribedConditions/","page":"Prescribed Conditions","title":"Prescribed Conditions","text":"specs = FluxSpecs(Cd = 1.2e-3, Ch = 1.2e-3)\nconditions = surface_fluxes(param_set, ..., flux_specs=specs)","category":"page"},{"location":"PrescribedConditions/#.-Fully-Prescribed-Fluxes","page":"Prescribed Conditions","title":"3. Fully Prescribed Fluxes","text":"","category":"section"},{"location":"PrescribedConditions/","page":"Prescribed Conditions","title":"Prescribed Conditions","text":"Inputs: Fluxes (H LE) and Friction Velocity (u_*).\nUnknowns: Stability (zeta), Coefficients (C_d C_h).","category":"page"},{"location":"PrescribedConditions/","page":"Prescribed Conditions","title":"Prescribed Conditions","text":"When shf, lhf, and ustar are all provided, the solver bypasses the flux calculation. It uses the prescribed values to:","category":"page"},{"location":"PrescribedConditions/","page":"Prescribed Conditions","title":"Prescribed Conditions","text":"Compute the Monin-Obukhov length L.\nDiagnose the stability parameter zeta = zL.\nBack-calculate the exchange coefficients consistent with these fluxes.","category":"page"},{"location":"PrescribedConditions/","page":"Prescribed Conditions","title":"Prescribed Conditions","text":"specs = FluxSpecs(shf = 20.0, lhf = 100.0, ustar = 0.3)\nconditions = surface_fluxes(param_set, ..., flux_specs=specs)","category":"page"},{"location":"PrescribedConditions/#.-Prescribed-Heat-Fluxes-and-Drag-Coefficient","page":"Prescribed Conditions","title":"4. Prescribed Heat Fluxes and Drag Coefficient","text":"","category":"section"},{"location":"PrescribedConditions/","page":"Prescribed Conditions","title":"Prescribed Conditions","text":"Inputs: Fluxes (H LE) and Drag Coefficient (C_d).\nUnknowns: Friction Velocity (u_*), Stability (zeta).","category":"page"},{"location":"PrescribedConditions/","page":"Prescribed Conditions","title":"Prescribed Conditions","text":"When shf, lhf, and Cd are provided (but not ustar):","category":"page"},{"location":"PrescribedConditions/","page":"Prescribed Conditions","title":"Prescribed Conditions","text":"Friction velocity is derived from the drag law: u_* = sqrtC_d U_texteff.\nStability zeta is computed from the fluxes and the derived u_*.","category":"page"},{"location":"PrescribedConditions/","page":"Prescribed Conditions","title":"Prescribed Conditions","text":"specs = FluxSpecs(shf = 50.0, lhf = 150.0, Cd = 1.5e-3)\nconditions = surface_fluxes(param_set, ..., flux_specs=specs)","category":"page"},{"location":"PrescribedConditions/#State-Callbacks","page":"Prescribed Conditions","title":"State Callbacks","text":"","category":"section"},{"location":"PrescribedConditions/","page":"Prescribed Conditions","title":"Prescribed Conditions","text":"In coupled systems, the surface state (e.g., skin temperature T_s) may respond rapidly to the surface fluxes. To ensure consistency without external fixed-point iteration, surface_fluxes accepts callback functions that update the surface state within the MOST iteration loop.","category":"page"},{"location":"PrescribedConditions/","page":"Prescribed Conditions","title":"Prescribed Conditions","text":"# Update Ts based on current flux guess\nfunction update_Ts(T_sfc, local_geometry, surface_fluxes_conditions)\n    # ... physics to update skin temperature ...\n    return new_T_sfc\nend\n\nconditions = surface_fluxes(..., update_T_sfc=update_Ts)","category":"page"},{"location":"PrescribedConditions/","page":"Prescribed Conditions","title":"Prescribed Conditions","text":"Available callbacks:","category":"page"},{"location":"PrescribedConditions/","page":"Prescribed Conditions","title":"Prescribed Conditions","text":"update_T_sfc: Updates surface temperature.\nupdate_q_vap_sfc: Updates surface specific humidity.","category":"page"},{"location":"PrescribedConditions/","page":"Prescribed Conditions","title":"Prescribed Conditions","text":"This mechanism ensures that the final fluxes and surface state are in equilibrium with respect to the surface energy/moisture balance.","category":"page"},{"location":"PhysicalScales/#Physical-Scales","page":"Physical Scales","title":"Physical Scales","text":"","category":"section"},{"location":"PhysicalScales/","page":"Physical Scales","title":"Physical Scales","text":"In Monin-Obukhov Similarity Theory (MOST), turbulent fluxes are parameterized using characteristic physical scales. These scales represent the turbulent fluctuations of velocity and scalars in the surface layer.","category":"page"},{"location":"PhysicalScales/#Friction-Velocity-(u_*)","page":"Physical Scales","title":"Friction Velocity (u_*)","text":"","category":"section"},{"location":"PhysicalScales/","page":"Physical Scales","title":"Physical Scales","text":"The friction velocity u_* is the characteristic velocity scale of the turbulence, related to the surface kinematic momentum flux (stress) taurho:","category":"page"},{"location":"PhysicalScales/","page":"Physical Scales","title":"Physical Scales","text":"\tu_*^2 = fractaurho = left( (overlineuw)^2 + (overlinevw)^2 right)^12","category":"page"},{"location":"PhysicalScales/","page":"Physical Scales","title":"Physical Scales","text":"In SurfaceFluxes.jl, this is computed by compute_ustar. u_* is derived from the wind speed difference Delta U using the dimensionless momentum profile phi_m,","category":"page"},{"location":"PhysicalScales/","page":"Physical Scales","title":"Physical Scales","text":"\tu_* = frackappa Delta UF_m(zeta )","category":"page"},{"location":"PhysicalScales/","page":"Physical Scales","title":"Physical Scales","text":"where F_m is the integrated stability correction function for momentum.","category":"page"},{"location":"PhysicalScales/#Scalar-Scales-(\\theta_*,-q_*)","page":"Physical Scales","title":"Scalar Scales (theta_* q_*)","text":"","category":"section"},{"location":"PhysicalScales/","page":"Physical Scales","title":"Physical Scales","text":"Similar scales are defined for potential temperature (theta) and specific humidity (q).","category":"page"},{"location":"PhysicalScales/","page":"Physical Scales","title":"Physical Scales","text":"Temperature Scale (theta_*): Related to the kinematic potential temperature flux overlinewtheta:","category":"page"},{"location":"PhysicalScales/","page":"Physical Scales","title":"Physical Scales","text":"\tu_* theta_* = -overlinewtheta","category":"page"},{"location":"PhysicalScales/","page":"Physical Scales","title":"Physical Scales","text":"Computed as:","category":"page"},{"location":"PhysicalScales/","page":"Physical Scales","title":"Physical Scales","text":"\ttheta_* = frackappa Delta thetaF_h(zeta )","category":"page"},{"location":"PhysicalScales/","page":"Physical Scales","title":"Physical Scales","text":"In SurfaceFluxes.jl, this scale is computed by compute_theta_star.","category":"page"},{"location":"PhysicalScales/","page":"Physical Scales","title":"Physical Scales","text":"Humidity Scale (q_*): Related to the kinematic specific humidity flux overlinewq (evaporation):","category":"page"},{"location":"PhysicalScales/","page":"Physical Scales","title":"Physical Scales","text":"\tu_* q_* = -overlinewq","category":"page"},{"location":"PhysicalScales/","page":"Physical Scales","title":"Physical Scales","text":"Computed similarly to theta_* using the same heat stability function F_h. See compute_q_star.","category":"page"},{"location":"PhysicalScales/#Variances","page":"Physical Scales","title":"Variances","text":"","category":"section"},{"location":"PhysicalScales/","page":"Physical Scales","title":"Physical Scales","text":"SurfaceFluxes.jl also provides functions to estimate the variances of turbulent fluctuations, which are useful for higher-order closure models or statistical analysis.","category":"page"},{"location":"PhysicalScales/#Velocity-Variance-(\\sigma_u2)","page":"Physical Scales","title":"Velocity Variance (sigma_u^2)","text":"","category":"section"},{"location":"PhysicalScales/","page":"Physical Scales","title":"Physical Scales","text":"The variance of the horizontal wind speed components, computed by u_variance:","category":"page"},{"location":"PhysicalScales/","page":"Physical Scales","title":"Physical Scales","text":"u_variance(param_set, Δz_eff, ustar, ζ)","category":"page"},{"location":"PhysicalScales/","page":"Physical Scales","title":"Physical Scales","text":"The parameterization depends on stability:","category":"page"},{"location":"PhysicalScales/","page":"Physical Scales","title":"Physical Scales","text":"Neutral/Stable (zeta ge 0): Proportional to u_*^2.\nUnstable (zeta  0): Includes a contribution from the convective velocity scale w_*, which depends on the boundary layer height z_i (taken to be a fixed parameter) and the heat flux at the effective height Delta z_texteff.","category":"page"},{"location":"PhysicalScales/#Scalar-Variance-(\\sigma_\\phi2)","page":"Physical Scales","title":"Scalar Variance (sigma_phi^2)","text":"","category":"section"},{"location":"PhysicalScales/","page":"Physical Scales","title":"Physical Scales","text":"The variance of scalars (temperature, humidity), computed by scalar_variance:","category":"page"},{"location":"PhysicalScales/","page":"Physical Scales","title":"Physical Scales","text":"scalar_variance(param_set, scale, ζ)","category":"page"},{"location":"PhysicalScales/","page":"Physical Scales","title":"Physical Scales","text":"Stable: Proportional to phi_*^2.\nUnstable: Scaling depends on zeta following standard similarity functions (e.g., Wyngaard et al., 1971).","category":"page"},{"location":"ExchangeFluxes/#Exchange-Fluxes","page":"Exchange Fluxes","title":"Exchange Fluxes","text":"","category":"section"},{"location":"ExchangeFluxes/","page":"Exchange Fluxes","title":"Exchange Fluxes","text":"SurfaceFluxes.jl provides a robust interface for computing surface-atmosphere exchange. The fluxes are calculated using bulk aerodynamic formulas, parameterized by non-dimensional exchange coefficients derived from Monin-Obukhov Similarity Theory (MOST).","category":"page"},{"location":"ExchangeFluxes/#Bulk-Fluxes","page":"Exchange Fluxes","title":"Bulk Fluxes","text":"","category":"section"},{"location":"ExchangeFluxes/","page":"Exchange Fluxes","title":"Exchange Fluxes","text":"The SurfaceFluxes module exports functions to compute the surface fluxes directly. These are the primary physical quantities of interest for coupling.","category":"page"},{"location":"ExchangeFluxes/#.-Momentum-Fluxes-(\\tau)","page":"Exchange Fluxes","title":"1. Momentum Fluxes (tau)","text":"","category":"section"},{"location":"ExchangeFluxes/","page":"Exchange Fluxes","title":"Exchange Fluxes","text":"The surface stress vector [mathrmNm^-2], representing the transfer of momentum from the atmosphere to the surface.","category":"page"},{"location":"ExchangeFluxes/","page":"Exchange Fluxes","title":"Exchange Fluxes","text":"momentum_fluxes(Cd, inputs, ρ_sfc, gustiness)","category":"page"},{"location":"ExchangeFluxes/","page":"Exchange Fluxes","title":"Exchange Fluxes","text":"Formula:","category":"page"},{"location":"ExchangeFluxes/","page":"Exchange Fluxes","title":"Exchange Fluxes","text":"tau_xy = -rho_textsfc C_d U_texteff Delta u_xy","category":"page"},{"location":"ExchangeFluxes/","page":"Exchange Fluxes","title":"Exchange Fluxes","text":"where:","category":"page"},{"location":"ExchangeFluxes/","page":"Exchange Fluxes","title":"Exchange Fluxes","text":"The drag coefficient is denoted by C_d.\nThe effective wind speed U_texteff includes gustiness effects.\nThe wind speed component differences are Delta u_xy.\nThe surface density rho_textsfc is computed internally by hydrostatically extrapolating the interior pressure to the surface.","category":"page"},{"location":"ExchangeFluxes/#.-Evaporation-(E)","page":"Exchange Fluxes","title":"2. Evaporation (E)","text":"","category":"section"},{"location":"ExchangeFluxes/","page":"Exchange Fluxes","title":"Exchange Fluxes","text":"The mass flux of water vapor [mathrmkgm^2s], driven by the specific humidity gradient.","category":"page"},{"location":"ExchangeFluxes/","page":"Exchange Fluxes","title":"Exchange Fluxes","text":"evaporation(param_set, inputs, g_h, q_vap_int, q_vap_sfc, ρ_sfc, model)","category":"page"},{"location":"ExchangeFluxes/","page":"Exchange Fluxes","title":"Exchange Fluxes","text":"Formula:","category":"page"},{"location":"ExchangeFluxes/","page":"Exchange Fluxes","title":"Exchange Fluxes","text":"E = -rho_textsfc g_h (q_textvapint - q_textvapsfc)","category":"page"},{"location":"ExchangeFluxes/","page":"Exchange Fluxes","title":"Exchange Fluxes","text":"where:","category":"page"},{"location":"ExchangeFluxes/","page":"Exchange Fluxes","title":"Exchange Fluxes","text":"The surface air density is rho_textsfc.\nThe term g_h represents the conductance for heat/scalars [mathrmms^-1].\nThe term (q_textvapint - q_textvapsfc) is the specific humidity difference between the interior (atmosphere) and the surface.","category":"page"},{"location":"ExchangeFluxes/","page":"Exchange Fluxes","title":"Exchange Fluxes","text":"If a latent heat flux is prescribed in inputs, the evaporation is derived from it: E = textLHF  L_v0.","category":"page"},{"location":"ExchangeFluxes/#.-Latent-Heat-Flux-(LHF)","page":"Exchange Fluxes","title":"3. Latent Heat Flux (LHF)","text":"","category":"section"},{"location":"ExchangeFluxes/","page":"Exchange Fluxes","title":"Exchange Fluxes","text":"The energy flux associated with the phase change of water [mathrmWm^2].","category":"page"},{"location":"ExchangeFluxes/","page":"Exchange Fluxes","title":"Exchange Fluxes","text":"latent_heat_flux(param_set, inputs, E, model)","category":"page"},{"location":"ExchangeFluxes/","page":"Exchange Fluxes","title":"Exchange Fluxes","text":"Formula:","category":"page"},{"location":"ExchangeFluxes/","page":"Exchange Fluxes","title":"Exchange Fluxes","text":"textLHF = L_v0 E","category":"page"},{"location":"ExchangeFluxes/","page":"Exchange Fluxes","title":"Exchange Fluxes","text":"where L_v0 is the latent heat of vaporization at the reference temperature.","category":"page"},{"location":"ExchangeFluxes/#.-Sensible-Heat-Flux-(SHF)","page":"Exchange Fluxes","title":"4. Sensible Heat Flux (SHF)","text":"","category":"section"},{"location":"ExchangeFluxes/","page":"Exchange Fluxes","title":"Exchange Fluxes","text":"The energy flux driven by the temperature difference [mathrmWm^2].","category":"page"},{"location":"ExchangeFluxes/","page":"Exchange Fluxes","title":"Exchange Fluxes","text":"sensible_heat_flux(param_set, inputs, g_h, T_int, T_sfc, ρ_sfc, E)","category":"page"},{"location":"ExchangeFluxes/","page":"Exchange Fluxes","title":"Exchange Fluxes","text":"Formula:","category":"page"},{"location":"ExchangeFluxes/","page":"Exchange Fluxes","title":"Exchange Fluxes","text":"textSHF = -rho_textsfc g_h (textDSE_textint - textDSE_textsfc) + textVSE_textsfc times E","category":"page"},{"location":"ExchangeFluxes/","page":"Exchange Fluxes","title":"Exchange Fluxes","text":"This formulation accounts for the enthalpy transport due to sensible heat transfer:","category":"page"},{"location":"ExchangeFluxes/","page":"Exchange Fluxes","title":"Exchange Fluxes","text":"Dry Static Energy Term: -rho_textsfc g_h Delta textDSE. Driven by the dry static energy (potential temperature) gradient.\nMass Transfer Term: textVSE_textsfc times E. Represents the \"dry\" enthalpy carried by the evaporating water vapor leaving the surface (textVSE is Vapor Static Energy, or the dry static energy carried by water vapor).","category":"page"},{"location":"ExchangeFluxes/","page":"Exchange Fluxes","title":"Exchange Fluxes","text":"See Yatunin et al. (2026) for a derivation of these formulas and a detailed explanation of how they result in an energetically consistent formulation.","category":"page"},{"location":"ExchangeFluxes/#Exchange-Coefficients","page":"Exchange Fluxes","title":"Exchange Coefficients","text":"","category":"section"},{"location":"ExchangeFluxes/","page":"Exchange Fluxes","title":"Exchange Fluxes","text":"The non-dimensional exchange coefficients relate the fluxes to the bulk gradients. They are derived from the integrated similarity profiles (F_m F_h) computed by the UniversalFunctions module.","category":"page"},{"location":"ExchangeFluxes/#Drag-Coefficient-(C_d)","page":"Exchange Fluxes","title":"Drag Coefficient (C_d)","text":"","category":"section"},{"location":"ExchangeFluxes/","page":"Exchange Fluxes","title":"Exchange Fluxes","text":"For momentum exchange:","category":"page"},{"location":"ExchangeFluxes/","page":"Exchange Fluxes","title":"Exchange Fluxes","text":"C_d = left( frackappaF_m(Delta z_texteff zeta z_0m) right)^2","category":"page"},{"location":"ExchangeFluxes/","page":"Exchange Fluxes","title":"Exchange Fluxes","text":"Momentum flux: tau = rho_textsfc C_d U_texteff Delta U.","category":"page"},{"location":"ExchangeFluxes/#Heat-Exchange-Coefficient-(C_h)","page":"Exchange Fluxes","title":"Heat Exchange Coefficient (C_h)","text":"","category":"section"},{"location":"ExchangeFluxes/","page":"Exchange Fluxes","title":"Exchange Fluxes","text":"For heat and scalar exchange:","category":"page"},{"location":"ExchangeFluxes/","page":"Exchange Fluxes","title":"Exchange Fluxes","text":"C_h = frackappa^2F_m(Delta z_texteff zeta z_0m) F_h(Delta z_texteff zeta z_0h)","category":"page"},{"location":"ExchangeFluxes/#Conductance-(g_h)","page":"Exchange Fluxes","title":"Conductance (g_h)","text":"","category":"section"},{"location":"ExchangeFluxes/","page":"Exchange Fluxes","title":"Exchange Fluxes","text":"The bulk scalar fluxes are proportional to the conductance g_h, which is the product of the non-dimensional heat exchange coefficient C_h and the effective wind speed:","category":"page"},{"location":"ExchangeFluxes/","page":"Exchange Fluxes","title":"Exchange Fluxes","text":"g_h = C_h U_texteff","category":"page"},{"location":"ExchangeFluxes/#Roughness-Length-Models","page":"Exchange Fluxes","title":"Roughness Length Models","text":"","category":"section"},{"location":"ExchangeFluxes/","page":"Exchange Fluxes","title":"Exchange Fluxes","text":"The surface roughness lengths (z_0m z_0h) parameterize the effect of surface irregularities on the wind and scalar profiles. SurfaceFluxes.jl supports several models via SurfaceFluxFluxConfig.","category":"page"},{"location":"ExchangeFluxes/#Constant-Roughness","page":"Exchange Fluxes","title":"Constant Roughness","text":"","category":"section"},{"location":"ExchangeFluxes/","page":"Exchange Fluxes","title":"Exchange Fluxes","text":"ConstantRoughnessParams uses fixed values for z_0m and z_0h. This is typical for static land surfaces where roughness is prescribed.","category":"page"},{"location":"ExchangeFluxes/#COARE-3.0-(Ocean)","page":"Exchange Fluxes","title":"COARE 3.0 (Ocean)","text":"","category":"section"},{"location":"ExchangeFluxes/","page":"Exchange Fluxes","title":"Exchange Fluxes","text":"COARE3RoughnessParams implements the COARE 3.0 algorithm (Fairall et al., 2003) for open ocean surfaces.","category":"page"},{"location":"ExchangeFluxes/","page":"Exchange Fluxes","title":"Exchange Fluxes","text":"Momentum Roughness (z_0m): A sum of a smooth flow limit (viscous) and a rough flow limit (Charnock relationship, with a Charnock parameter alpha that varies with wind speed):","category":"page"},{"location":"ExchangeFluxes/","page":"Exchange Fluxes","title":"Exchange Fluxes","text":"z_0m = 011 fracnuu_* + alpha fracu_*^2g","category":"page"},{"location":"ExchangeFluxes/","page":"Exchange Fluxes","title":"Exchange Fluxes","text":"Scalar Roughness (z_0h): Based on Reynolds number scaling.","category":"page"},{"location":"ExchangeFluxes/#Raupach-(Land/Canopy)","page":"Exchange Fluxes","title":"Raupach (Land/Canopy)","text":"","category":"section"},{"location":"ExchangeFluxes/","page":"Exchange Fluxes","title":"Exchange Fluxes","text":"RaupachRoughnessParams implements the Raupach (1994) model for vegetation canopies.","category":"page"},{"location":"ExchangeFluxes/","page":"Exchange Fluxes","title":"Exchange Fluxes","text":"Calculates z_0m and displacement height d based on canopy height (h) and Leaf Area Index (LAI).\nUseful for dynamic vegetation models.","category":"page"},{"location":"ExchangeFluxes/#Gustiness","page":"Exchange Fluxes","title":"Gustiness","text":"","category":"section"},{"location":"ExchangeFluxes/","page":"Exchange Fluxes","title":"Exchange Fluxes","text":"In unstable conditions, especially when the mean wind speed approaches zero (free convection limit), convective eddies generated by surface heating maintain turbulent exchange. Standard bulk formulas using only the mean wind speed difference (Delta U) would erroneously predict zero fluxes.","category":"page"},{"location":"ExchangeFluxes/","page":"Exchange Fluxes","title":"Exchange Fluxes","text":"To account for this, SurfaceFluxes.jl uses an effective wind speed (U_texteff):","category":"page"},{"location":"ExchangeFluxes/","page":"Exchange Fluxes","title":"Exchange Fluxes","text":"U_texteff = maxleft( left(Delta u^2 + Delta v^2right)^12  U_textgust right)","category":"page"},{"location":"ExchangeFluxes/","page":"Exchange Fluxes","title":"Exchange Fluxes","text":"where U_textgust is a parameterized gustiness velocity scale representing the contribution of sub-grid eddies.","category":"page"},{"location":"ExchangeFluxes/#Parameterizations-and-Dispatch","page":"Exchange Fluxes","title":"Parameterizations and Dispatch","text":"","category":"section"},{"location":"ExchangeFluxes/","page":"Exchange Fluxes","title":"Exchange Fluxes","text":"The gustiness formulation is controlled by the GustinessSpec type in the SurfaceFluxInputs. This design allows for type-stable dispatch and straightforward broadcasting over heterogeneous surfaces. For example, a model coupled to both land and ocean can use an array of input structs where some elements use ConstantGustinessSpec (land) and others use DeardorffGustinessSpec (ocean). The solver simply calls surface_fluxes and correct method is dispatched automatically.","category":"page"},{"location":"ExchangeFluxes/#.-Constant-Gustiness","page":"Exchange Fluxes","title":"1. Constant Gustiness","text":"","category":"section"},{"location":"ExchangeFluxes/","page":"Exchange Fluxes","title":"Exchange Fluxes","text":"ConstantGustinessSpec(value)","category":"page"},{"location":"ExchangeFluxes/","page":"Exchange Fluxes","title":"Exchange Fluxes","text":"Uses a fixed tuning parameter, e.g., U_textgust = 10  mathrmms^-1. Often used over land surfaces.","category":"page"},{"location":"ExchangeFluxes/#.-Deardorff-Gustiness","page":"Exchange Fluxes","title":"2. Deardorff Gustiness","text":"","category":"section"},{"location":"ExchangeFluxes/","page":"Exchange Fluxes","title":"Exchange Fluxes","text":"DeardorffGustinessSpec()","category":"page"},{"location":"ExchangeFluxes/","page":"Exchange Fluxes","title":"Exchange Fluxes","text":"Scales U_textgust with the convective velocity scale w_*, following Deardorff (1970) and Beljaars (1995). This is physically robust for the unstable boundary layer over fluid surfaces (ocean/lakes).","category":"page"},{"location":"ExchangeFluxes/","page":"Exchange Fluxes","title":"Exchange Fluxes","text":"U_textgust = beta w_* = beta (B z_i)^13","category":"page"},{"location":"ExchangeFluxes/","page":"Exchange Fluxes","title":"Exchange Fluxes","text":"where:","category":"page"},{"location":"ExchangeFluxes/","page":"Exchange Fluxes","title":"Exchange Fluxes","text":"The surface buoyancy flux is denoted by B.\nThe boundary layer height is z_i.\nThe scaling coefficient is beta (typically approx 10).","category":"page"},{"location":"ExchangeFluxes/","page":"Exchange Fluxes","title":"Exchange Fluxes","text":"Since B depends on the fluxes, and the fluxes depend on U_texteff (and thus B), this introduces a nonlinear coupling that is resolved by an iterative solver.","category":"page"},{"location":"ExchangeFluxes/#Reference","page":"Exchange Fluxes","title":"Reference","text":"","category":"section"},{"location":"ExchangeFluxes/","page":"Exchange Fluxes","title":"Exchange Fluxes","text":"Beljaars, A. C. M. (1995). The parametrization of surface fluxes in large-scale models under free convection. Quarterly Journal of the Royal Meteorological Society, 121, 255-270. DOI: 10.1002/qj.49712152203\nDeardorff, J. W. (1970). Convective velocity and temperature scales for the unstable planetary boundary layer and for Rayleigh convection. Journal of the Atmospheric Sciences, 27, 1211-1213. DOI: 10.1175/1520-0469(1970)027<1211:CVATSF>2.0.CO;2\nFairall, C. W., Bradley, E. F., Hare, J. E., Grachev, A. A., & Edson, J. B. (2003). Bulk parameterization of air–sea fluxes: Updates and verification for the COARE algorithm. Journal of Climate, 16, 571-591. DOI: 10.1175/1520-0442(2003)016<0571:BPOASF>2.0.CO;2\nRaupach, M. R. (1994). Simplified expressions for vegetation roughness length and zero-plane displacement as functions of canopy height and area index. Boundary-Layer Meteorology, 71, 211-216. DOI: 10.1007/BF00709229\nYatunin, D., Byrne, S., Kawczynski, C., Kandala, S., Bozzola, G., Sridhar, A., Shen, Z., Jaruga, A., Sloan, J., He, J., Huang, D.Z., Barra, V., Knoth, O., Ullrich, P., Schneider, T., 2026: The CliMA atmosphere dynamical core: Concepts, numerics, and scaling. Journal of Advances in Modeling Earth Systems, in press. DOI:10.1029/2025MS005014","category":"page"},{"location":"SurfaceFluxes/#Surface-Fluxes-Theory","page":"Surface Fluxes Theory","title":"Surface Fluxes Theory","text":"","category":"section"},{"location":"SurfaceFluxes/","page":"Surface Fluxes Theory","title":"Surface Fluxes Theory","text":"SurfaceFluxes.jl calculates turbulent surface fluxes using Monin-Obukhov Similarity Theory (MOST). This theory allows us to estimate the fluxes of momentum, heat, and moisture from the mean vertical gradients of wind speed, potential temperature, and specific humidity in the surface layer.","category":"page"},{"location":"SurfaceFluxes/#Monin-Obukhov-Similarity-Theory","page":"Surface Fluxes Theory","title":"Monin-Obukhov Similarity Theory","text":"","category":"section"},{"location":"SurfaceFluxes/","page":"Surface Fluxes Theory","title":"Surface Fluxes Theory","text":"The central hypothesis of MOST is that in the surface layer, turbulent fluxes are approximately constant with height and characterized by a single length scale, the Obukhov length (L), defined as","category":"page"},{"location":"SurfaceFluxes/","page":"Surface Fluxes Theory","title":"Surface Fluxes Theory","text":" L = - fracu_*^3kappa B","category":"page"},{"location":"SurfaceFluxes/","page":"Surface Fluxes Theory","title":"Surface Fluxes Theory","text":"with","category":"page"},{"location":"SurfaceFluxes/","page":"Surface Fluxes Theory","title":"Surface Fluxes Theory","text":"the friction velocity (scaling velocity) u_*,\nthe von Kármán constant (kappa approx 04), and\nthe surface buoyancy flux B.","category":"page"},{"location":"SurfaceFluxes/","page":"Surface Fluxes Theory","title":"Surface Fluxes Theory","text":"The Obukhov length L is a dimensionless quantity that characterizes the stability of the surface layer:","category":"page"},{"location":"SurfaceFluxes/","page":"Surface Fluxes Theory","title":"Surface Fluxes Theory","text":"Neutral (L to infty): Shear production of turbulence dominates (B to 0).\nStable (L  0): Surface cooling, turbulence is suppressed by negative buoyancy (B  0).\nUnstable (L  0): Surface heating, turbulence is generated by positive buoyancy (B  0).","category":"page"},{"location":"SurfaceFluxes/","page":"Surface Fluxes Theory","title":"Surface Fluxes Theory","text":"The dimensionless stability parameter zeta is defined as","category":"page"},{"location":"SurfaceFluxes/","page":"Surface Fluxes Theory","title":"Surface Fluxes Theory","text":" zeta = fracz - dL","category":"page"},{"location":"SurfaceFluxes/","page":"Surface Fluxes Theory","title":"Surface Fluxes Theory","text":"where z is the height above the surface and d is the displacement height. In stable conditions, L  0 and zeta  0, while in unstable conditions, L  0 and zeta  0. The displacement height d is a parameter that accounts for the apparent upward \"displacement\" of the surface due to roughness elements (e.g., vegetation, buildings, etc.)","category":"page"},{"location":"SurfaceFluxes/#Similarity-Relations","page":"Surface Fluxes Theory","title":"Similarity Relations","text":"","category":"section"},{"location":"SurfaceFluxes/","page":"Surface Fluxes Theory","title":"Surface Fluxes Theory","text":"The vertical gradients of mean variables are related to their surface fluxes through universal stability functions (phi_m phi_h),","category":"page"},{"location":"SurfaceFluxes/","page":"Surface Fluxes Theory","title":"Surface Fluxes Theory","text":" frackappa (z-d)u_* fracpartial upartial z = phi_m(zeta)","category":"page"},{"location":"SurfaceFluxes/","page":"Surface Fluxes Theory","title":"Surface Fluxes Theory","text":"and","category":"page"},{"location":"SurfaceFluxes/","page":"Surface Fluxes Theory","title":"Surface Fluxes Theory","text":" frackappa (z-d)theta_* fracpartial thetapartial z = phi_h(zeta)","category":"page"},{"location":"SurfaceFluxes/","page":"Surface Fluxes Theory","title":"Surface Fluxes Theory","text":"where theta_* is the potential temperature scale. Similar relations hold for specific humidity (q) and other scalars.","category":"page"},{"location":"SurfaceFluxes/","page":"Surface Fluxes Theory","title":"Surface Fluxes Theory","text":"Integrating these relations yields the profiles for wind speed and potential temperature, which are used to relate surface values to interior values (at height Delta z).","category":"page"},{"location":"SurfaceFluxes/#The-Iterative-Solver","page":"Surface Fluxes Theory","title":"The Iterative Solver","text":"","category":"section"},{"location":"SurfaceFluxes/","page":"Surface Fluxes Theory","title":"Surface Fluxes Theory","text":"The core problem in SurfaceFluxes.jl is to find the stability parameter zeta that satisfies the MOST relations given the atmospheric state (wind speed difference Delta U between interior and surface, virtual potential temperature difference Delta theta_v, etc.).","category":"page"},{"location":"SurfaceFluxes/","page":"Surface Fluxes Theory","title":"Surface Fluxes Theory","text":"Since L depends on the fluxes (via u_* and B), and the fluxes depend on L (via the profiles), this requires an iterative solution.","category":"page"},{"location":"SurfaceFluxes/#Bulk-Richardson-Number","page":"Surface Fluxes Theory","title":"Bulk Richardson Number","text":"","category":"section"},{"location":"SurfaceFluxes/","page":"Surface Fluxes Theory","title":"Surface Fluxes Theory","text":"The solver uses the Bulk Richardson Number (Ri_b) as a constraint. In terms of state variables, Ri_b is defined as","category":"page"},{"location":"SurfaceFluxes/","page":"Surface Fluxes Theory","title":"Surface Fluxes Theory","text":" Ri_b(textstate) = fracg (z-d) Delta theta_vtheta_vtextref (Delta U)^2","category":"page"},{"location":"SurfaceFluxes/","page":"Surface Fluxes Theory","title":"Surface Fluxes Theory","text":"where theta_v is the virtual potential temperature. The bulk Richardson number Ri_b is a dimensionless quantity that characterizes the stability of the surface layer. In stable conditions, Ri_b  0, while in unstable conditions, Ri_b  0.","category":"page"},{"location":"SurfaceFluxes/","page":"Surface Fluxes Theory","title":"Surface Fluxes Theory","text":"Theoretical analysis shows that Ri_b is universally related to zeta:","category":"page"},{"location":"SurfaceFluxes/","page":"Surface Fluxes Theory","title":"Surface Fluxes Theory","text":" Ri_b(zeta) = zeta fracF_h(zeta)F_m(zeta)^2","category":"page"},{"location":"SurfaceFluxes/","page":"Surface Fluxes Theory","title":"Surface Fluxes Theory","text":"Here, F_m and F_h are the dimensionless vertical profiles for momentum and heat (derived from phi_m and phi_h). The bulk Richardson number Ri_b(zeta) is a monotonic function of zeta, enabling a robust and efficient root-finding algorithm.","category":"page"},{"location":"SurfaceFluxes/#Iterative-Solver-(Secant-Method)","page":"Surface Fluxes Theory","title":"Iterative Solver (Secant Method)","text":"","category":"section"},{"location":"SurfaceFluxes/","page":"Surface Fluxes Theory","title":"Surface Fluxes Theory","text":"The function surface_fluxes uses the Secant Method (via RootSolvers.jl) to find the root zeta of the equation","category":"page"},{"location":"SurfaceFluxes/","page":"Surface Fluxes Theory","title":"Surface Fluxes Theory","text":" Ri_b(textstate) - Ri_b(zeta) = 0","category":"page"},{"location":"SurfaceFluxes/","page":"Surface Fluxes Theory","title":"Surface Fluxes Theory","text":"The solver is initialized with guesses at zeta = -1 and zeta = 1, spanning neutral stability. By default, the solver runs for a fixed number of iterations (maxiter=7, forced_fixed_iters=true) to ensure predictable, branch-free execution on GPUs.","category":"page"},{"location":"SurfaceFluxes/","page":"Surface Fluxes Theory","title":"Surface Fluxes Theory","text":"For the Businger-Dyer similarity functions, a critical bulk Richardson number Ri_btextcrit approx 021 exists, above which no finite zeta satisfies the stability relations due to the asymptotic behavior of the integrated profile functions. In such supercritical stable conditions, the solver cannot converge to a finite root. To ensure bounded output, the solution is clamped to physical limits zeta in -100 100 after iteration. While the clamped solution does not satisfy the stability equations exactly, it provides physically reasonable fluxes that smoothly approach zero as stratification increases.","category":"page"},{"location":"SurfaceFluxes/","page":"Surface Fluxes Theory","title":"Surface Fluxes Theory","text":"Once zeta is found, the scaling parameters (u_* theta_* q_*) and thus the fluxes of sensible heat, latent heat, and momentum (SHF, LHF, tau) are computed directly.","category":"page"},{"location":"SurfaceFluxes/#Wind-Speed-and-Gustiness","page":"Surface Fluxes Theory","title":"Wind Speed and Gustiness","text":"","category":"section"},{"location":"SurfaceFluxes/","page":"Surface Fluxes Theory","title":"Surface Fluxes Theory","text":"In conditions of very low wind speed, the standard definition of the bulk Richardson number becomes singular as the mean wind speed approaches zero. To represent sub-grid scale variability and ensure numerical stability, SurfaceFluxes.jl uses an effective wind speed that includes a \"gustiness\" component.","category":"page"},{"location":"SurfaceFluxes/","page":"Surface Fluxes Theory","title":"Surface Fluxes Theory","text":"The effective wind speed difference Delta U used in the solver is:","category":"page"},{"location":"SurfaceFluxes/","page":"Surface Fluxes Theory","title":"Surface Fluxes Theory","text":"    Delta U = maxleft( left(Delta u^2 + Delta v^2right)^12  U_textgust right)","category":"page"},{"location":"SurfaceFluxes/","page":"Surface Fluxes Theory","title":"Surface Fluxes Theory","text":"where Delta u and Delta v are the horizontal wind components and U_textgust is a gustiness velocity scale. This prevents the wind speed from vanishing even when the mean horizontal wind is zero (e.g., in free convection).","category":"page"},{"location":"SurfaceFluxes/","page":"Surface Fluxes Theory","title":"Surface Fluxes Theory","text":"Supported parameterizations for U_textgust:","category":"page"},{"location":"SurfaceFluxes/","page":"Surface Fluxes Theory","title":"Surface Fluxes Theory","text":"Constant Gustiness: A fixed minimum wind speed value.\nDeardorff Gustiness: Proportional to the convective velocity scale w_*, capturing gustiness induced by boundary layer eddies.","category":"page"},{"location":"SurfaceFluxes/#Discretization-Schemes","page":"Surface Fluxes Theory","title":"Discretization Schemes","text":"","category":"section"},{"location":"SurfaceFluxes/","page":"Surface Fluxes Theory","title":"Surface Fluxes Theory","text":"SurfaceFluxes.jl supports two interpretations of the boundary layer profiles, handled by the UniversalFunctions module:","category":"page"},{"location":"SurfaceFluxes/","page":"Surface Fluxes Theory","title":"Surface Fluxes Theory","text":"Point Value Scheme (Finite Difference): Assumes that the inputs represent values at exact heights z.\nLayer Average Scheme (Finite Volume): Assumes that the inputs represent volume-averaged values over a grid cell. This requires modified universal functions (Psi) as derived by  (Nishizawa & Kitamura (2018)).","category":"page"},{"location":"SurfaceFluxes/","page":"Surface Fluxes Theory","title":"Surface Fluxes Theory","text":"See Universal Functions for details on the specific parameterizations.","category":"page"},{"location":"SurfaceFluxes/#Profile-Recovery","page":"Surface Fluxes Theory","title":"Profile Recovery","text":"","category":"section"},{"location":"SurfaceFluxes/","page":"Surface Fluxes Theory","title":"Surface Fluxes Theory","text":"While the primary goal of the iterative solver is to compute surface fluxes from state variables, strictly speaking, MOST defines the full vertical profiles of these variables. Once the fluxes and stability length L are known, the value of any variable at an arbitrary height within the surface layer can be recovered using compute_profile_value.","category":"page"},{"location":"SurfaceFluxes/","page":"Surface Fluxes Theory","title":"Surface Fluxes Theory","text":"This is particularly useful for diagnosing variables at specific heights (e.g., 2 m or 10m) or for coupling with other model components that require state variables at different levels.","category":"page"},{"location":"SurfaceFluxes/","page":"Surface Fluxes Theory","title":"Surface Fluxes Theory","text":"compute_profile_value(\n    param_set,\n    L_MO,\n    z0,\n    Δz_eff,\n    scale,\n    val_sfc,\n    transport,\n)","category":"page"},{"location":"SurfaceFluxes/","page":"Surface Fluxes Theory","title":"Surface Fluxes Theory","text":"This calculates the value of a variable at the effective aerodynamic height Δz_eff based on its surface value val_sfc, its roughness length z0, and its similarity scale scale (e.g., u_* or theta_*). For a complete list of functions and their arguments, please refer to the API Reference.","category":"page"},{"location":"SurfaceFluxes/","page":"Surface Fluxes Theory","title":"Surface Fluxes Theory","text":"note: Effective Height\nHere and throughout, the input argument Δz_eff is the effective height above the surface, i.e., z - d.","category":"page"},{"location":"SurfaceFluxes/#Example","page":"Surface Fluxes Theory","title":"Example","text":"","category":"section"},{"location":"SurfaceFluxes/","page":"Surface Fluxes Theory","title":"Surface Fluxes Theory","text":"The following figure demonstrates profile recovery using the universal functions (reproducing Figure 6.4 from Bonan (2019)). The profiles are computed with the Businger-Dyer parameterization for both stable and unstable conditions and with a displacement height of d = 19mathrmm.","category":"page"},{"location":"SurfaceFluxes/","page":"Surface Fluxes Theory","title":"Surface Fluxes Theory","text":"Profile recovery for wind speed (left) and potential temperature (right) under different stability conditions. The figure shows profiles for unstable conditions (LMO = -10, -50, -1000) and stable conditions (LMO = 30, 50, 1000), demonstrating how the universal functions capture the stability dependence of the boundary layer structure.","category":"page"},{"location":"SurfaceFluxes/","page":"Surface Fluxes Theory","title":"Surface Fluxes Theory","text":"(Image: Bonan Figure 6.4)","category":"page"},{"location":"SurfaceFluxes/#References","page":"Surface Fluxes Theory","title":"References","text":"","category":"section"},{"location":"SurfaceFluxes/","page":"Surface Fluxes Theory","title":"Surface Fluxes Theory","text":"Bonan, G. (2019). Climate Change and Terrestrial Ecosystem Modeling. Cambridge University Press. ISBN: 978-1-107-04378-7","category":"page"},{"location":"TestSuite/#Test-Suite","page":"Test Suite","title":"Test Suite","text":"","category":"section"},{"location":"TestSuite/","page":"Test Suite","title":"Test Suite","text":"Comprehensive testing for correctness and numerical stability","category":"page"},{"location":"TestSuite/#Overview","page":"Test Suite","title":"Overview","text":"","category":"section"},{"location":"TestSuite/","page":"Test Suite","title":"Test Suite","text":"SurfaceFluxes.jl employs a multi-tiered testing strategy to ensure physical correctness, numerical robustness, and software compatibility (GPU/AD). The suite covers:","category":"page"},{"location":"TestSuite/","page":"Test Suite","title":"Test Suite","text":"Regression Tests: Preventing breaking changes against known baselines.\nUniversal Functions Tests: Verifying mathematical properties of stability corrections.\nPhysical Consistency: Checking flux directions and energy balance.\nSoftware Compatibility: Ensuring compatibility with GPU execution (CUDA.jl) and Automatic Differentiation (ForwardDiff.jl).","category":"page"},{"location":"TestSuite/#Automatic-Differentiation-(AD)","page":"Test Suite","title":"Automatic Differentiation (AD)","text":"","category":"section"},{"location":"TestSuite/","page":"Test Suite","title":"Test Suite","text":"The package is designed to be fully differentiable. This is critical for coupled models where surface fluxes are part of a larger implicit solver or optimization loop.","category":"page"},{"location":"TestSuite/#AD-Test-Example","page":"Test Suite","title":"AD Test Example","text":"","category":"section"},{"location":"TestSuite/","page":"Test Suite","title":"Test Suite","text":"We verify AD compatibility by comparing the derivatives computed via ForwardDiff.jl against finite-difference approximations.","category":"page"},{"location":"TestSuite/","page":"Test Suite","title":"Test Suite","text":"using ForwardDiff\nusing SurfaceFluxes\n\n# Wrapper function for the flux calculation\nfunction compute_shf(T_sfc)\n    # create inputs with T_sfc as a Dual number...\n    result = surface_fluxes(param_set, ..., T_sfc, ...)\n    return result.shf\nend\n\n# Compute derivative d(SHF)/d(T_sfc)\ndSHF_dT = ForwardDiff.derivative(compute_shf, 300.0)","category":"page"},{"location":"TestSuite/","page":"Test Suite","title":"Test Suite","text":"Tests ensure that:","category":"page"},{"location":"TestSuite/","page":"Test Suite","title":"Test Suite","text":"Dual numbers propagate through the entire solver (no type conversion errors).\nDerivatives are accurate compared to finite differences across stable and unstable regimes.","category":"page"},{"location":"TestSuite/#Detailed-Test-Categories","page":"Test Suite","title":"Detailed Test Categories","text":"","category":"section"},{"location":"TestSuite/#Regression-Tests","page":"Test Suite","title":"Regression Tests","text":"","category":"section"},{"location":"TestSuite/","page":"Test Suite","title":"Test Suite","text":"Predefined test cases with known expected outputs, ensuring that code changes do not introduce regressions. Covers over 1600 cases across different stability regimes, floating-point types, and roughness parameterizations.","category":"page"},{"location":"TestSuite/","page":"Test Suite","title":"Test Suite","text":"These tests are also valuable for performance tuning of hyperparameters, such as determining the minimum maxiter required to achieve a target accuracy (e.g., < 10% error in fluxes).","category":"page"},{"location":"TestSuite/#Universal-Functions-Tests","page":"Test Suite","title":"Universal Functions Tests","text":"","category":"section"},{"location":"TestSuite/","page":"Test Suite","title":"Test Suite","text":"Rigorous verification of the stability correction functions:","category":"page"},{"location":"TestSuite/#Type-Stability","page":"Test Suite","title":"Type Stability","text":"","category":"section"},{"location":"TestSuite/","page":"Test Suite","title":"Test Suite","text":"Test: Type stability","category":"page"},{"location":"TestSuite/","page":"Test Suite","title":"Test Suite","text":"Verifies that all functions return values of the correct floating-point type (Float32 or Float64) matching the input parameter type.","category":"page"},{"location":"TestSuite/#Neutral-Limit-Behavior","page":"Test Suite","title":"Neutral Limit Behavior","text":"","category":"section"},{"location":"TestSuite/","page":"Test Suite","title":"Test Suite","text":"Test: Neutral logarithmic velocity profile","category":"page"},{"location":"TestSuite/","page":"Test Suite","title":"Test Suite","text":"Verifies that in the neutral limit (L to infty, i.e., zeta to 0), the velocity profile collapses to the logarithmic law of the wall:","category":"page"},{"location":"TestSuite/","page":"Test Suite","title":"Test Suite","text":"beginequation\nu(z) = fracu_*kappa lnleft(fracz-dz_0right)\nendequation","category":"page"},{"location":"TestSuite/#Asymptotic-Behavior","page":"Test Suite","title":"Asymptotic Behavior","text":"","category":"section"},{"location":"TestSuite/","page":"Test Suite","title":"Test Suite","text":"Test: Asymptotic behavior (|ζ| → ∞)","category":"page"},{"location":"TestSuite/","page":"Test Suite","title":"Test Suite","text":"For very stable conditions (zeta gg 1), the functions should approach their asymptotic limits:","category":"page"},{"location":"TestSuite/","page":"Test Suite","title":"Test Suite","text":"Gryanik: phi_m(zeta) sim zeta^13\nGrachev: phi_m(zeta) sim zeta^13","category":"page"},{"location":"TestSuite/#Mathematical-Consistency","page":"Test Suite","title":"Mathematical Consistency","text":"","category":"section"},{"location":"TestSuite/","page":"Test Suite","title":"Test Suite","text":"Several tests ensure the internal consistency of the definitions:","category":"page"},{"location":"TestSuite/","page":"Test Suite","title":"Test Suite","text":"Derivative Consistency: Checks phi(zeta) approx phi(0) - zeta cdot psi(zeta) using finite differences.\nIntegral Consistency: Checks psi(zeta) approx int (phi(0) - phi(x))x  dx using numerical quadrature.\nContinuity: Verifies continuous transitions in functions and their derivatives, especially at the neutral limit (zeta to 0).","category":"page"},{"location":"TestSuite/#Running-the-Tests","page":"Test Suite","title":"Running the Tests","text":"","category":"section"},{"location":"TestSuite/","page":"Test Suite","title":"Test Suite","text":"using Pkg\nPkg.test(\"SurfaceFluxes\")","category":"page"},{"location":"TestSuite/","page":"Test Suite","title":"Test Suite","text":"Or run specific test files:","category":"page"},{"location":"TestSuite/","page":"Test Suite","title":"Test Suite","text":"julia --project=test test/test_universal_functions.jl","category":"page"},{"location":"TestSuite/#Quality-Assurance","page":"Test Suite","title":"Quality Assurance","text":"","category":"section"},{"location":"TestSuite/","page":"Test Suite","title":"Test Suite","text":"The package uses Aqua.jl for automated quality checks including ambiguity detection and unbound type parameters.","category":"page"},{"location":"API/#API-Reference","page":"API Reference","title":"API Reference","text":"","category":"section"},{"location":"API/#Main-Solver-Interface","page":"API Reference","title":"Main Solver Interface","text":"","category":"section"},{"location":"API/","page":"API Reference","title":"API Reference","text":"SurfaceFluxes.surface_fluxes\nSurfaceFluxes.SurfaceFluxConditions\nSurfaceFluxes.SurfaceFluxConfig\nSurfaceFluxes.FluxSpecs\nSurfaceFluxes.SurfaceFluxInputs\nSurfaceFluxes.SolverOptions\nSurfaceFluxes.SolverScheme\nSurfaceFluxes.PointValueScheme\nSurfaceFluxes.LayerAverageScheme\nSurfaceFluxes.compute_profile_value","category":"page"},{"location":"API/#SurfaceFluxes.surface_fluxes","page":"API Reference","title":"SurfaceFluxes.surface_fluxes","text":"surface_fluxes(param_set, T_int, q_tot_int, q_liq_int, q_ice_int, ρ_int, T_sfc_guess, q_vap_sfc_guess, Φ_sfc, Δz, d, u_int, u_sfc, roughness_inputs=nothing, config=default, scheme=PointValueScheme, solver_opts=nothing, flux_specs=nothing)\n\nCore entry point for calculating surface fluxes using Monin-Obukhov Similarity Theory (MOST).\n\nFunctionality\n\nCalculates sensible heat flux, latent heat flux, momentum flux (stress), and friction velocity.\n\nCan operate in four modes depending on inputs:\n\nPrescribed Coefficients: If Cd and Ch are provided in flux_specs, fluxes are computed directly.\nFully Prescribed Fluxes: If shf, lhf, and ustar are provided, they are validated and the fluxes are returned.\nPrescribed Heat and Drag: If shf, lhf, and Cd are provided, ustar is derived from Cd and wind speed.\nIterative Solver: Otherwise, iterates to find the Obukhov stability parameter ζ. Optional functions can be provided to calculate the skin temperature and skin humidity during the iteration.\n\nArguments\n\nparam_set: SurfaceFluxes parameters (containing thermodynamics and universal function params).\nT_int: Interior (air) temperature [K] at height z.\nq_tot_int: Interior total specific humidity [kg/kg].\nq_liq_int, q_ice_int: Interior liquid/ice specific humidity [kg/kg].\nρ_int: Interior air density [kg/m^3].\nT_sfc_guess: Initial guess for surface temperature [K], updated via callback if provided.\nq_vap_sfc_guess: Initial guess for surface vapor specific humidity [kg/kg], updated via callback if provided.\nΦ_sfc: Surface geopotential [m^2/s^2].\nΔz: Geometric height difference between the surface and the interior level [m], used for geopotential.\nd: Displacement height [m]. Aerodynamic calculations (MOST) use effective height Δz - d.\nu_int: Tuple of interior wind components (u, v) [m/s].\nu_sfc: Tuple of surface wind components (u, v) [m/s]. (Usually (0, 0)).\nroughness_inputs: Optional container of parameters (e.g., LAI, canopy height) that are passed directly to the specific roughness model (e.g., RaupachRoughnessParams).\nconfig: SurfaceFluxConfig struct containing:\nroughness: Model for roughness lengths (e.g., ConstantRoughnessParams, COARE3RoughnessSpec). Note: This package currently assumes the roughness length for heat (z0h) is equal to the  roughness length for scalars (z0s).\ngustiness: Model for gustiness (e.g., ConstantGustinessSpec).\nmoisture_model: DryModel or WetModel.\nscheme: Discretization scheme (PointValueScheme or LayerAverageScheme).\nsolver_opts: Options for the root solver (maxiter, tol, rtol, forced_fixed_iters).\nflux_specs: Optional FluxSpecs to prescribe specific constraints (e.g., ustar, shf, Cd).\nupdate_T_sfc: Optional callback f(T_sfc) to update surface temperature during iteration.\nupdate_q_vap_sfc: Optional callback f(q_vap) to update surface humidity during iteration.\n\nReturns\n\nA SurfaceFluxConditions struct containing:\n\nshf: Sensible Heat Flux [W/m^2].\nlhf: Latent Heat Flux [W/m^2].\nevaporation: Evaporation rate [kg/m^2/s].\nustar: Friction velocity [m/s].\nρτxz, ρτyz: Momentum flux components (stress) [N/m^2].\nζ: Stability parameter ((z-d)/L).\nCd, Ch: Drag and heat exchange coefficients.\nT_sfc, q_vap_sfc: Surface temperature [K] and vapor specific humidity kg/kg.\nL_MO: Monin-Obukhov length [m].\nconverged: Convergence status.\n\n\n\n\n\nsurface_fluxes(param_set, inputs, scheme=PointValueScheme(), solver_opts=nothing)\n\nDispatch to the appropriate solver mode based on the availability of inputs (coefficients, fluxes, or state).\n\n\n\n\n\n","category":"function"},{"location":"API/#SurfaceFluxes.SurfaceFluxConditions","page":"API Reference","title":"SurfaceFluxes.SurfaceFluxConditions","text":"SurfaceFluxConditions\n\nSurface flux conditions, returned from surface_fluxes.\n\nshf::FT: Sensible heat flux [W/m²]\nlhf::FT: Latent heat flux [W/m²]\nevaporation::FT: Evaporation rate [kg/(m²·s)]\nρτxz::FT: Momentum flux, eastward component [kg/(m·s²)]\nρτyz::FT: Momentum flux, northward component [kg/(m·s²)]\nustar::FT: Friction velocity [m/s]\nζ::FT: Monin-Obukhov stability parameter (z/L)\nCd::FT: Momentum exchange coefficient\nCh::FT: Heat exchange coefficient\nT_sfc::FT: Surface temperature [K]\nq_vap_sfc::FT: Surface air vapor specific humidity [kg/kg]\nL_MO::FT: Monin-Obukhov lengthscale [m]\nconverged::Bool: Solver convergence status\n\n\n\n\n\n","category":"type"},{"location":"API/#SurfaceFluxes.SurfaceFluxConfig","page":"API Reference","title":"SurfaceFluxes.SurfaceFluxConfig","text":"SurfaceFluxConfig\n\nConfiguration for surface flux calculation components.\n\nFields\n\nroughness: The roughness length parameterization to use (e.g., ConstantRoughnessParams).\ngustiness: The gustiness parameterization to use (e.g., ConstantGustinessSpec).\nmoisture_model: The moisture model (e.g., MoistModel or DryModel).\n\n\n\n\n\n","category":"type"},{"location":"API/#SurfaceFluxes.FluxSpecs","page":"API Reference","title":"SurfaceFluxes.FluxSpecs","text":"FluxSpecs{FT}\n\nContainer for prescribed surface flux boundary conditions.\n\nFields\n\nshf: Sensible Heat Flux [W/m^2].\nlhf: Latent Heat Flux [W/m^2].\nustar: Friction velocity [m/s].\nCd: Momentum exchange coefficient.\nCh: Heat exchange coefficient.\n\n\n\n\n\n","category":"type"},{"location":"API/#SurfaceFluxes.SurfaceFluxInputs","page":"API Reference","title":"SurfaceFluxes.SurfaceFluxInputs","text":"SurfaceFluxInputs\n\nImmutable container describing the atmospheric and surface state using primitive quantities plus module-defined parameterizations. Instances of this type are passed to the functional surface flux solver.\n\nFields\n\nT_int, q_tot_int, ρ_int: Interior air temperature [K], specific humidity [kg/kg], and density [kg/m^3].\nq_liq_int, q_ice_int: Interior liquid and ice specific humidity [kg/kg].\nT_sfc_guess, q_vap_sfc_guess: Initial guesses for surface temperature [K] and vapor specific humidity [kg/kg]. Optional, can be nothing for default fallback.\nΦ_sfc: Surface geopotential [m^2/s^2].\nΔz: Height difference between interior and surface reference levels [m].\nd: Displacement height [m].\nu_int, u_sfc: Horizontal wind components (u, v) at interior and surface levels [m/s].\nroughness_model: Roughness parameterization (e.g., ConstantRoughnessParams).\ngustiness_model: Gustiness parameterization (e.g., ConstantGustinessSpec).\nmoisture_model: Moisture model (e.g., MoistModel or DryModel).\nroughness_inputs: Optional inputs for roughness models.\nupdate_T_sfc, update_q_vap_sfc: Optional callbacks to update surface state during iteration.\nshf, lhf, ustar, Cd, Ch: Optional prescribed flux/scale quantities supplied via FluxSpecs.\n\n\n\n\n\n","category":"type"},{"location":"API/#SurfaceFluxes.SolverOptions","page":"API Reference","title":"SurfaceFluxes.SolverOptions","text":"SolverOptions{FT}\n\nOptions for the Monin-Obukhov similarity theory solver.\n\nFields\n\ntol: Absolute tolerance on the change in the stability parameter for determining convergence.\nrtol: Relative tolerance on the change in the stability parameter for determining convergence.\nmaxiter: Maximum number of iterations.\nforced_fixed_iters: If true, disables the tolerance check and forces the solver to run for exactly maxiter iterations (or until machine precision is reached/bypassed). Default is true.\n\n\n\n\n\n","category":"type"},{"location":"API/#SurfaceFluxes.SolverScheme","page":"API Reference","title":"SurfaceFluxes.SolverScheme","text":"SolverScheme\n\nAbstract type for surface flux solver schemes.\n\n\n\n\n\n","category":"type"},{"location":"API/#SurfaceFluxes.PointValueScheme","page":"API Reference","title":"SurfaceFluxes.PointValueScheme","text":"PointValueScheme <: SolverScheme\n\nStandard finite difference scheme using point values.\n\n\n\n\n\n","category":"type"},{"location":"API/#SurfaceFluxes.LayerAverageScheme","page":"API Reference","title":"SurfaceFluxes.LayerAverageScheme","text":"LayerAverageScheme <: SolverScheme\n\nFinite volume approximation scheme following Nishizawa & Kitamura (2018).\n\n\n\n\n\n","category":"type"},{"location":"API/#SurfaceFluxes.compute_profile_value","page":"API Reference","title":"SurfaceFluxes.compute_profile_value","text":"compute_profile_value(param_set, L_MO, z0, Δz_eff, scale, val_sfc, transport, scheme)\n\nCompute the (nondimensional) value of a variable (momentum or scalar)  at effective aerodynamic height Δz_eff (height above surface minus displacement height).\n\nArguments\n\nparam_set: Parameter set.\nL_MO: Monin-Obukhov length [m].\nz0: Roughness length [m].\nΔz_eff: Effective aerodynamic height z - d [m].\nscale: Similarity scale (ustar, thetastar, etc.).\nval_sfc: Surface value of the variable.\ntransport: Transport type (MomentumTransport or HeatTransport).\nscheme: Discretization scheme (default: PointValueScheme()).\n\nFormula:\n\nX(Δz_eff) = (scale / κ) * F_z + val_sfc\n\nwhere F_z is the dimensionless profile at height Δz_eff.\n\n\n\n\n\n","category":"function"},{"location":"API/#Flux-Calculations","page":"API Reference","title":"Flux Calculations","text":"","category":"section"},{"location":"API/","page":"API Reference","title":"API Reference","text":"Functions for computing specific fluxes.","category":"page"},{"location":"API/","page":"API Reference","title":"API Reference","text":"SurfaceFluxes.sensible_heat_flux\nSurfaceFluxes.latent_heat_flux\nSurfaceFluxes.buoyancy_flux\nSurfaceFluxes.evaporation\nSurfaceFluxes.momentum_fluxes\nSurfaceFluxes.state_bulk_richardson_number","category":"page"},{"location":"API/#SurfaceFluxes.sensible_heat_flux","page":"API Reference","title":"SurfaceFluxes.sensible_heat_flux","text":"shf = sensible_heat_flux(param_set, inputs, g_h, T_int, T_sfc, ρ_sfc, E)\n\nComputes the sensible heat flux at the surface.\n\nThe sensible heat flux is given by\n\nSHF = -ρ_sfc * g_h * ΔDSE + VSE_sfc * E\n\nwhere ΔDSE = DSE_int - DSE_sfc is the difference in dry static energy between the interior and surface, g_h is the heat/moisture conductance, VSE_sfc is the dry  static energy of water vapor at the surface temperature, and E is the evaporation rate. The  second term, VSE_sfc * E, accounts for the vapor static energy  VSE_sfc = cp_v * (T_sfc - T_0) + Φ_sfc (i.e., dry enthalpy cp_v * (T_sfc - T_0),  or sensible heat, plus potential energy Φ_sfc) carried by evaporating water.\n\nIf inputs.shf is provided (not nothing), the function returns that value directly, allowing for prescribed sensible heat flux conditions. See SurfaceFluxInputs.\n\nArguments\n\nparam_set: Parameter set.\ninputs: SurfaceFluxInputs container.\ng_h: Heat/moisture conductance [m/s].\nT_int: Interior temperature [K].\nT_sfc: Surface temperature [K].\nρ_sfc: Surface air density [kg/m^3].\nE: Evaporation rate [kg/m^2/s]. Optional, default 0.\n\n\n\n\n\nsensible_heat_flux(param_set, ζ, ustar, inputs, z0m, z0h, T_sfc, q_vap_sfc, ρ_sfc, scheme)\n\nComputes the sensible heat flux given the Monin-Obukhov stability parameter ζ, friction velocity ustar, roughness lengths, and surface state. Useful for computing fluxes from variables available inside the solver loop.\n\nArguments\n\nparam_set: Parameter set.\nζ: Monin-Obukhov stability parameter.\nustar: Friction velocity [m/s].\ninputs: SurfaceFluxInputs container.\nz0m: Momentum roughness length [m].\nz0h: Thermal roughness length [m].\nT_sfc: Surface temperature [K].\nq_vap_sfc: Surface vapor specific humidity [kg/kg].\nρ_sfc: Surface air density [kg/m^3].\nscheme: Discretization scheme.\n\n\n\n\n\n","category":"function"},{"location":"API/#SurfaceFluxes.latent_heat_flux","page":"API Reference","title":"SurfaceFluxes.latent_heat_flux","text":"latent_heat_flux(param_set, inputs, E, model)\n\nComputes the latent heat flux at the surface.\n\nThe latent heat flux is given by\n\nLHF = LH_v0 * E\n\nwhere LH_v0 is the latent heat of vaporization at the reference temperature and E is the evaporation rate.\n\nIf inputs.lhf is provided (not nothing), the function returns that value directly, allowing for prescribed latent heat flux conditions.\n\nArguments:\n\nparam_set: Parameter set.\ninputs: SurfaceFluxInputs struct.\nE: Evaporation rate [kg/m^2/s].\nmodel: Moisture model (MoistModel or DryModel).\n\n\n\n\n\nlatent_heat_flux(param_set, ζ, ustar, inputs, z0m, z0h, q_vap_sfc, ρ_sfc, scheme)\n\nComputes the latent heat flux given the Monin-Obukhov stability parameter ζ, friction velocity ustar, roughness lengths, and surface state. Calculates conductance and evaporation internally.\n\nArguments\n\nparam_set: Parameter set.\nζ: Monin-Obukhov stability parameter.\nustar: Friction velocity [m/s].\ninputs: SurfaceFluxInputs container.\nz0m: Momentum roughness length [m].\nz0h: Thermal roughness length [m].\nq_vap_sfc: Surface vapor specific humidity [kg/kg].\nρ_sfc: Surface air density [kg/m^3].\nscheme: Discretization scheme.\n\n\n\n\n\n","category":"function"},{"location":"API/#SurfaceFluxes.buoyancy_flux","page":"API Reference","title":"SurfaceFluxes.buoyancy_flux","text":"buoyancy_flux(param_set, shf, lhf, T_sfc, ρ_sfc, q_vap_sfc, q_liq_sfc, q_ice_sfc, model)\n\nComputes the buoyancy flux at the surface, accounting for the presence of liquid and ice condensate.\n\nThe buoyancy flux B is defined as the vertical flux of virtual potential temperature θ_v. It is approximated by linearizing the density perturbations with respect to temperature and total water content:\n\nB ≈ (g / ρ_sfc) * ( SHF / (cp_m * T_sfc) + (ε_vd - 1) * LHF / LH_v0 )\n\nWhere:\n\ncp_m is the specific heat of moist air, calculated using q_tot_sfc, q_liq_sfc, and q_ice_sfc.\nε_vd is the ratio of gas constants for water vapor and dry air.\nThe term (ε_vd - 1) (approximately 0.61) represents the density effect of water vapor relative to dry air   (the virtual temperature correction factor), ensuring the buoyancy flux accounts for the fact that moist   air is lighter than dry air.\n\nArguments:\n\nρ_sfc: Surface air density [kg/m³].\nq_vap_sfc: Specific humidity of water vapor at the surface (default: 0).\nq_liq_sfc: Specific humidity of liquid water at the surface (default: 0).\nq_ice_sfc: Specific humidity of ice at the surface (default: 0).\nmodel: Moisture model (MoistModel or DryModel).\n\n\n\n\n\nbuoyancy_flux(param_set, ζ, ustar, inputs)\n\nComputes the buoyancy flux given the Monin-Obukhov stability parameter ζ, friction velocity ustar, and geometric inputs via SurfaceFluxInputs.\n\nThe relationship is derived from the definition of the Obukhov length:\n\nL = -u_*^3 / (κ * B)\nζ = Δz / L\n=> B = -(u_*^3 * ζ) / (κ * Δz)\n\nArguments\n\nparam_set: Parameter set.\nζ: Monin-Obukhov stability parameter.\nustar: Friction velocity [m/s].\ninputs: SurfaceFluxInputs container.\n\n\n\n\n\n","category":"function"},{"location":"API/#SurfaceFluxes.evaporation","page":"API Reference","title":"SurfaceFluxes.evaporation","text":"E = evaporation(param_set, inputs, g_h, q_vap_int, q_vap_sfc, ρ_sfc, model)\n\nComputes the evaporation rate at the surface.\n\nThe evaporation rate is given by\n\nE = -ρ_sfc * g_h * Δq_vap\n\nwhere Δq_vap = q_vap_int - q_vap_sfc is the difference in vapor specific humidity between the interior and surface, g_h is the heat/moisture conductance (heat and moisture  conductances must be equal for energetic consistency), and ρ_sfc is the surface air density. Here q_vap_int and q_vap_sfc are the vapor specific humidities (not total specific humidity) at the interior and surface, respectively.\n\nIf inputs.lhf is provided (not nothing), the function returns the evaporation rate computed from the prescribed latent heat flux: E = LHF / LH_v0, where LH_v0 is the latent heat of vaporization at the reference temperature.\n\nArguments:\n\nparam_set: Parameter set.\ninputs: SurfaceFluxInputs struct.\ng_h: Heat conductance [m/s].\nq_vap_int: Interior vapor specific humidity [kg/kg].\nq_vap_sfc: Surface vapor specific humidity [kg/kg].\nρ_sfc: Surface density [kg/m^3].\nmodel: Moisture model (MoistModel or DryModel).\n\n\n\n\n\nevaporation(param_set, ζ, ustar, inputs, z0m, z0h, q_vap_sfc, ρ_sfc, scheme)\n\nComputes the evaporation rate given the Monin-Obukhov stability parameter ζ, friction velocity ustar, roughness lengths, and surface state.\n\nArguments\n\nparam_set: Parameter set.\nζ: Monin-Obukhov stability parameter.\nustar: Friction velocity [m/s].\ninputs: SurfaceFluxInputs container.\nz0m: Momentum roughness length [m].\nz0h: Thermal roughness length [m].\nq_vap_sfc: Surface vapor specific humidity [kg/kg].\nρ_sfc: Surface air density [kg/m^3].\nscheme: Discretization scheme.\n\n\n\n\n\n","category":"function"},{"location":"API/#SurfaceFluxes.momentum_fluxes","page":"API Reference","title":"SurfaceFluxes.momentum_fluxes","text":"momentum_fluxes(Cd, inputs, ρ_sfc, gustiness)\n\nComputes the momentum fluxes at the surface.\n\nThe momentum fluxes are calculated using the bulk aerodynamic formula:\n\nρτxz = -ρ_sfc * Cd * ΔU * Δu_x\nρτyz = -ρ_sfc * Cd * ΔU * Δu_y\n\nwhere:\n\nCd: Momentum exchange coefficient (drag coefficient)\nΔU: Magnitude of the wind speed difference (including gustiness)\nΔu_x, Δu_y: Components of the wind speed difference\nρ_sfc: Surface air density\n\nReturns a tuple (ρτxz, ρτyz).\n\nSee SurfaceFluxInputs.\n\nArguments\n\nCd: Drag coefficient.\ninputs: SurfaceFluxInputs container.\nρ_sfc: Surface air density [kg/m^3].\ngustiness: Gustiness velocity scale [m/s].\n\n\n\n\n\n","category":"function"},{"location":"API/#SurfaceFluxes.state_bulk_richardson_number","page":"API Reference","title":"SurfaceFluxes.state_bulk_richardson_number","text":"state_bulk_richardson_number(param_set, inputs, T_sfc, ρ_sfc, ΔU, q_vap_sfc)\n\nComputes the bulk Richardson number from the given state.\n\nArguments\n\nparam_set: Parameter set.\ninputs: SurfaceFluxInputs struct.\nT_sfc: Surface temperature [K].\nρ_sfc: Surface air density [kg/m³].\nΔU: Wind speed difference [m/s].\nq_vap_sfc: Surface vapor specific humidity [kg/kg]. Default: 0.\n\nReturns the bulk Richardson number.\n\n\n\n\n\n","category":"function"},{"location":"API/#Exchange-Coefficients","page":"API Reference","title":"Exchange Coefficients","text":"","category":"section"},{"location":"API/","page":"API Reference","title":"API Reference","text":"Non-dimensional exchange coefficients and conductances.","category":"page"},{"location":"API/","page":"API Reference","title":"API Reference","text":"SurfaceFluxes.drag_coefficient\nSurfaceFluxes.heat_exchange_coefficient\nSurfaceFluxes.heat_conductance","category":"page"},{"location":"API/#SurfaceFluxes.drag_coefficient","page":"API Reference","title":"SurfaceFluxes.drag_coefficient","text":"drag_coefficient(param_set, ζ, z0m, Δz_eff, scheme)\n\nCompute the drag coefficient Cd for momentum exchange.\n\nArguments\n\nparam_set: Parameter set\nζ: Stability parameter ζ = Δz_eff / L_MO\nz0m: Roughness length for momentum [m]\nΔz_eff: Effective aerodynamic height Δz - d [m] \nscheme: Surface flux solver scheme (default: PointValueScheme())\n\nFormula:\n\nCd = (κ / F_m)^2\n\nwhere F_m is the dimensionless velocity profile.\n\n\n\n\n\ndrag_coefficient(inputs::SurfaceFluxInputs, speed)\n\nCompute the drag coefficient Cd from friction velocity (presumed to be in inputs.ustar)  and effective wind speed (including any gustiness factors).\n\nSee SurfaceFluxInputs.\n\nArguments\n\ninputs: SurfaceFluxInputs container.\nspeed: Effective wind speed [m/s].\n\n\n\n\n\n","category":"function"},{"location":"API/#SurfaceFluxes.heat_exchange_coefficient","page":"API Reference","title":"SurfaceFluxes.heat_exchange_coefficient","text":"heat_exchange_coefficient(param_set, ζ, z0m, z0h, Δz_eff, scheme)\n\nCompute the heat exchange coefficient Ch for scalar exchange.\n\nFormula:\n\nCh = κ^2 / (F_m * F_h),\n\nwhere F_m and F_h are the dimensionless profiles for momentum and scalars.  For the finite-volume case, this corresponds to the formulation in  Nishizawa & Kitamura (2018), Eqs. 21 & 22 (with Pr0 absorbed into Fh).\n\nArguments\n\nparam_set: Parameter set\nζ: Stability parameter ζ = Δz_eff / L_MO\nz0m: Roughness length for momentum [m]\nz0h: Roughness length for scalars (heat/moisture) [m]\nΔz_eff: Effective aerodynamic height Δz - d [m] \nscheme: Surface flux solver scheme (default: PointValueScheme())\n\n\n\n\n\n","category":"function"},{"location":"API/#SurfaceFluxes.heat_conductance","page":"API Reference","title":"SurfaceFluxes.heat_conductance","text":"heat_conductance(param_set, ζ, ustar, inputs, z0m, z0h, scheme)\n\nCompute the heat conductance g_h (speed * Ch), including any gustiness factor in the wind speed. Calculates windspeed and exchange coefficient internally from Monin-Obukhov variables.\n\nSee SurfaceFluxInputs.\n\nArguments\n\nparam_set: Parameter set.\nζ: Monin-Obukhov stability parameter.\nustar: Friction velocity [m/s].\ninputs: SurfaceFluxInputs container.\nz0m: Momentum roughness length [m].\nz0h: Thermal roughness length [m].\nscheme: Discretization scheme.\n\n\n\n\n\n","category":"function"},{"location":"API/#Physical-Scales-and-Variances","page":"API Reference","title":"Physical Scales & Variances","text":"","category":"section"},{"location":"API/","page":"API Reference","title":"API Reference","text":"Functions for computing Monin-Obukhov similarity scales and variances.","category":"page"},{"location":"API/","page":"API Reference","title":"API Reference","text":"SurfaceFluxes.compute_physical_scale_coeff\nSurfaceFluxes.compute_ustar\nSurfaceFluxes.compute_theta_star\nSurfaceFluxes.compute_q_star\nSurfaceFluxes.u_variance\nSurfaceFluxes.scalar_variance\nSurfaceFluxes.theta_variance\nSurfaceFluxes.obukhov_length\nSurfaceFluxes.obukhov_stability_parameter","category":"page"},{"location":"API/#SurfaceFluxes.compute_physical_scale_coeff","page":"API Reference","title":"SurfaceFluxes.compute_physical_scale_coeff","text":"compute_physical_scale_coeff(\n    param_set::APS,\n    Δz_eff,\n    ζ,\n    z0,\n    transport,\n    scheme::SolverScheme,\n)\n\nComputes the coefficient for the physical scale of a variable. Returns ϕ such that scale = Δvalue * ϕ. For example, u★ = ΔU * ϕ_m.\n\nArguments\n\nΔz_eff: Effective aerodynamic height Δz - d [m]\n\nThis is computed as:\n\nϕ = fracκF(Δz_eff ζ z_0)\n\nwhere F is the dimensionless profile function from UniversalFunctions.\n\n\n\n\n\n","category":"function"},{"location":"API/#SurfaceFluxes.compute_ustar","page":"API Reference","title":"SurfaceFluxes.compute_ustar","text":"compute_ustar(param_set, ζ, z0, inputs, scheme, gustiness)\n\nReturn the friction velocity implied by the Monin-Obukhov solution.\n\nIf a friction velocity is prescribed via inputs.ustar (in SurfaceFluxInputs), it is returned directly; otherwise it is recomputed from the similarity coefficients.\n\nArguments\n\nparam_set: Parameter set.\nζ: Monin-Obukhov stability parameter.\nz0: Momentum roughness length [m].\ninputs: SurfaceFluxInputs container.\nscheme: Discretization scheme.\ngustiness: Gustiness velocity scale [m/s].\n\n\n\n\n\n","category":"function"},{"location":"API/#SurfaceFluxes.compute_theta_star","page":"API Reference","title":"SurfaceFluxes.compute_theta_star","text":"compute_theta_star(param_set, ζ, z0h, inputs, scheme, T_sfc)\n\nReturn the potential temperature scale implied by the Monin-Obukhov solution,  where z0h is the roughness length for heat.\n\nSee SurfaceFluxInputs.\n\nArguments\n\nparam_set: Parameter set.\nζ: Monin-Obukhov stability parameter.\nz0h: Thermal roughness length [m].\ninputs: SurfaceFluxInputs container.\nscheme: Discretization scheme.\nT_sfc: Surface temperature [K]. Optional, defaults to inputs.T_sfc_guess.\n\n\n\n\n\n","category":"function"},{"location":"API/#SurfaceFluxes.compute_q_star","page":"API Reference","title":"SurfaceFluxes.compute_q_star","text":"compute_q_star(param_set, ζ, z0h, inputs, scheme, q_vap_sfc)\n\nReturn the specific humidity scale implied by the current Monin-Obukhov solution,  where z0h is the roughness length for scalars (assumed equal to heat).\n\nSee SurfaceFluxInputs.\n\nArguments\n\nparam_set: Parameter set.\nζ: Monin-Obukhov stability parameter.\nz0h: Thermal/scalar roughness length [m].\ninputs: SurfaceFluxInputs container.\nscheme: Discretization scheme.\nq_vap_sfc: Surface vapor specific humidity [kg/kg]. Optional, defaults to inputs.q_vap_sfc_guess.\n\n\n\n\n\n","category":"function"},{"location":"API/#SurfaceFluxes.u_variance","page":"API Reference","title":"SurfaceFluxes.u_variance","text":"u_variance(param_set, Δz_eff, ustar, ζ)\n\nCompute the velocity variance σ_u^2 = (u_star * ϕ_σu)^2.\n\nFor unstable conditions, the convective (Deardorff) velocity scale w_*  is calculated using the mixed-layer height zi from parameters, and  passed to the universal function. Δz_eff is the effective aerodynamic height.\n\nArguments\n\nparam_set: Parameter set.\nΔz_eff: Effective aerodynamic height [m].\nustar: Friction velocity [m/s].\nζ: Monin-Obukhov stability parameter.\n\n\n\n\n\n","category":"function"},{"location":"API/#SurfaceFluxes.scalar_variance","page":"API Reference","title":"SurfaceFluxes.scalar_variance","text":"scalar_variance(param_set, scale, ζ)\n\nCompute the scalar variance σ_s^2 = (c_s * ϕ_σs)^2.\n\nArguments\n\nparam_set: Parameter set.\nscale: Similarity scale of the scalar (e.g., theta_star, q_star).\nζ: Monin-Obukhov stability parameter.\n\n\n\n\n\n","category":"function"},{"location":"API/#SurfaceFluxes.theta_variance","page":"API Reference","title":"SurfaceFluxes.theta_variance","text":"theta_variance(param_set, inputs, shf, ustar, ζ, rho_sfc)\n\nComputes potential temperature variance from sensible heat flux shf. Calculates θ_* = -shf / (ρ * c_p * u_*) and calls scalar_variance.\n\nArguments\n\nparam_set: Parameter set.\ninputs: SurfaceFluxInputs container.\nshf: Sensible heat flux [W/m^2].\nustar: Friction velocity [m/s].\nζ: Monin-Obukhov stability parameter.\nrho_sfc: Surface density [kg/m^3].\n\n\n\n\n\n","category":"function"},{"location":"API/#SurfaceFluxes.obukhov_length","page":"API Reference","title":"SurfaceFluxes.obukhov_length","text":"obukhov_length(param_set, ustar, buoy_flux)\n\nComputes the Monin-Obukhov length [m].\n\nReturns zero if ustar is zero.\n\nArguments\n\nparam_set: Parameter set.\nustar: Friction velocity [m/s].\nbuoy_flux: Surace buoyancy flux [m^2/s^3].\n\n\n\n\n\n","category":"function"},{"location":"API/#SurfaceFluxes.obukhov_stability_parameter","page":"API Reference","title":"SurfaceFluxes.obukhov_stability_parameter","text":"obukhov_stability_parameter(param_set, Δz_eff, ustar, buoy_flux)\n\nComputes the Monin-Obukhov stability parameter ζ = Δz_eff / L_MO, where Δz_eff is the effective aerodynamic height (z-d).\n\nReturns zero if ustar and hence L_MO are zero.\n\nArguments\n\nparam_set: Parameter set.\nΔz_eff: Effective aerodynamic height [m].\nustar: Friction velocity [m/s].\nbuoy_flux: Surace buoyancy flux [m^2/s^3].\n\n\n\n\n\n","category":"function"},{"location":"API/#Roughness-and-Gustiness","page":"API Reference","title":"Roughness & Gustiness","text":"","category":"section"},{"location":"API/","page":"API Reference","title":"API Reference","text":"SurfaceFluxes.ConstantRoughnessParams\nSurfaceFluxes.COARE3RoughnessParams\nSurfaceFluxes.RaupachRoughnessParams\nSurfaceFluxes.ConstantGustinessSpec\nSurfaceFluxes.DeardorffGustinessSpec\nSurfaceFluxes.MoistModel\nSurfaceFluxes.DryModel","category":"page"},{"location":"API/#SurfaceFluxes.ConstantRoughnessParams","page":"API Reference","title":"SurfaceFluxes.ConstantRoughnessParams","text":"ConstantRoughnessParams{FT} <: AbstractRoughnessParams\n\nRoughness lengths fixed to constant values.\n\nFields\n\nz0m: Momentum roughness length [m]\nz0s: Scalar roughness length [m]. Used for both heat (z0h) and humidity (z0q).\n\nThe default values specified here are used when constructing the struct manually. When loading via ClimaParams, these values are overwritten by the parameters in the ClimaParams TOML file.\n\n\n\n\n\n","category":"type"},{"location":"API/#SurfaceFluxes.COARE3RoughnessParams","page":"API Reference","title":"SurfaceFluxes.COARE3RoughnessParams","text":"COARE3RoughnessParams{FT} <: AbstractRoughnessParams\n\nCOARE 3.0 roughness parameterization (Fairall et al. 2003).\n\nReferences\n\nFairall, C. W., Bradley, E. F., Hare, J. E., Grachev, A. A., & Edson, J. B. (2003).    Bulk parameterization of air–sea fluxes: Updates and verification for the COARE algorithm.   Journal of Climate, 16, 571–591.   DOI: 10.1175/1520-0442(2003)016<0571:BPOASF>2.0.CO;2\n\nThe default values specified here are used when constructing the struct manually. When loading via ClimaParams, these values are overwritten by the parameters in the TOML file.\n\n\n\n\n\n","category":"type"},{"location":"API/#SurfaceFluxes.RaupachRoughnessParams","page":"API Reference","title":"SurfaceFluxes.RaupachRoughnessParams","text":"RaupachRoughnessParams <: AbstractRoughnessParams\n\nRaupach (1994) canopy roughness model.\n\nReferences\n\nRaupach, M. R. (1994). Simplified expressions for vegetation roughness length and zero-plane displacement    as functions of canopy height and area index.   Boundary-Layer Meteorology, 71, 211–216.   DOI: 10.1007/BF00709229\n\nThe default values specified here are used when constructing the struct manually. When loading via ClimaParams, stanton_number is overwritten by the parameter in the TOML file, while other parameters (C_R, C_S, c_d1) retain their default values.\n\n\n\n\n\n","category":"type"},{"location":"API/#SurfaceFluxes.ConstantGustinessSpec","page":"API Reference","title":"SurfaceFluxes.ConstantGustinessSpec","text":"ConstantGustinessSpec{TG <: Real}\n\nA gustiness model where the gustiness velocity is a constant value.\n\nFields\n\nvalue: The constant gustiness velocity [m/s].\n\n\n\n\n\n","category":"type"},{"location":"API/#SurfaceFluxes.DeardorffGustinessSpec","page":"API Reference","title":"SurfaceFluxes.DeardorffGustinessSpec","text":"DeardorffGustinessSpec\n\nA gustiness model based on Deardorff (1970) scaling with convective velocity scale w_*. The gustiness velocity is computed as: U_gust = beta w_*^13\n\n\n\n\n\n","category":"type"},{"location":"API/#SurfaceFluxes.MoistModel","page":"API Reference","title":"SurfaceFluxes.MoistModel","text":"MoistModel\n\nIndicates that moisture effects (latent heat, virtual temperature) should be included in the flux calculations.\n\n\n\n\n\n","category":"type"},{"location":"API/#SurfaceFluxes.DryModel","page":"API Reference","title":"SurfaceFluxes.DryModel","text":"DryModel\n\nIndicates that moisture effects should be ignored (sensible heat and momentum only).\n\n\n\n\n\n","category":"type"},{"location":"API/#Universal-Functions","page":"API Reference","title":"Universal Functions","text":"","category":"section"},{"location":"API/","page":"API Reference","title":"API Reference","text":"The UniversalFunctions sub-module defines the stability functions phi(zeta) and psi(zeta).","category":"page"},{"location":"API/","page":"API Reference","title":"API Reference","text":"SurfaceFluxes.UniversalFunctions\nSurfaceFluxes.UniversalFunctions.phi\nSurfaceFluxes.UniversalFunctions.psi\nSurfaceFluxes.UniversalFunctions.Psi","category":"page"},{"location":"API/#SurfaceFluxes.UniversalFunctions","page":"API Reference","title":"SurfaceFluxes.UniversalFunctions","text":"UniversalFunctions\n\nUniversal stability and stability correction functions for SurfaceFluxes module.  Supports the following universal functions:\n\nBusinger: Businger et al. (1971), Dyer (1974)\nGryanik: Gryanik et al. (2020)\nGrachev: Grachev et al. (2007)\n\nIt supports standard finite-difference (point-value) and finite-volume  (layer-averaged) schemes. The finite-volume scheme is based on the Nishizawa & Kitamura (2018) formulation.\n\nReferences:\n\nBusinger et al. (1971): https://doi.org/10.1175/1520-0469(1971)028<0181:FPRITA>2.0.CO;2\nDyer (1974): https://doi.org/10.1007/BF00240838\nGryanik et al. (2020): https://doi.org/10.1175/JAS-D-19-0255.1\nGrachev et al. (2007): https://doi.org/10.1007/s10546-007-9177-6\nNishizawa & Kitamura (2018): https://doi.org/10.1029/2018MS001534\nPanofsky et al. (1977): https://doi.org/10.1007/BF02186086\nWyngaard et al. (1971): https://doi.org/10.1175/1520-0469(1971)028<1171:LFCSAT>2.0.CO;2\n\n\n\n\n\n","category":"module"},{"location":"API/#SurfaceFluxes.UniversalFunctions.phi","page":"API Reference","title":"SurfaceFluxes.UniversalFunctions.phi","text":"phi\n\nUniversal stability function for wind shear (ϕ_m) and  temperature gradient (ϕ_h)\n\n\n\n\n\n","category":"function"},{"location":"API/#SurfaceFluxes.UniversalFunctions.psi","page":"API Reference","title":"SurfaceFluxes.UniversalFunctions.psi","text":"psi(p, ζ, transport_type)\n\nThe standard integrated stability correction function ψ(ζ). Defined as:     ψ(ζ) = ∫[0 to ζ] (ϕ(0) - ϕ(x)) / x dx\n\nThis is the standard correction used in point-based Monin-Obukhov similarity theory. \n\n\n\n\n\n","category":"function"},{"location":"API/#SurfaceFluxes.UniversalFunctions.Psi","page":"API Reference","title":"SurfaceFluxes.UniversalFunctions.Psi","text":"Psi(p, ζ, transport_type)\n\nThe volume-averaged stability correction function Ψ(ζ). Mathematically, this is defined as:     Ψ(ζ) = (1/ζ) ∫[0 to ζ] ψ(x) dx\n\nThis function is required for finite-volume models where fluxes are calculated using cell-averaged values rather than point values at the cell center.\n\nSee Nishizawa & Kitamura (2018), Eqs. 14 & 15.\n\n\n\n\n\n","category":"function"},{"location":"API/#Parameter-Types","page":"API Reference","title":"Parameter Types","text":"","category":"section"},{"location":"API/","page":"API Reference","title":"API Reference","text":"SurfaceFluxes.UniversalFunctions.BusingerParams\nSurfaceFluxes.UniversalFunctions.GryanikParams\nSurfaceFluxes.UniversalFunctions.GrachevParams","category":"page"},{"location":"API/#SurfaceFluxes.UniversalFunctions.BusingerParams","page":"API Reference","title":"SurfaceFluxes.UniversalFunctions.BusingerParams","text":"BusingerParams{FT}\n\nParameter bundle for the Businger (1971) similarity relations. Mappings to Nishizawa & Kitamura (2018) coefficients:\n\na_m, a_h: The linear coefficients for stable conditions (β in some texts).\nb_m, b_h: The coefficients γ inside the unstable sqrt/cbrt terms (e.g., (1 - γζ)).\nPr_0: The neutral Prandtl number.\n\nSee Businger et al. (1971) and Nishizawa & Kitamura (2018).\n\n\n\n\n\n","category":"type"},{"location":"API/#SurfaceFluxes.UniversalFunctions.GryanikParams","page":"API Reference","title":"SurfaceFluxes.UniversalFunctions.GryanikParams","text":"GryanikParams{FT}\n\nParameter bundle for the Gryanik et al. (2020) similarity relations. These functions are designed to be valid across the entire stability range, including very stable conditions.\n\na_m, b_m: Coefficients for momentum stability function (Eq. 32).\na_h, b_h: Coefficients for heat stability function (Eq. 33).\nPr_0: Neutral Prandtl number. (The paper recommends Pr_0 ≈ 0.98.)\n\nReference: Gryanik et al. (2020).\n\n\n\n\n\n","category":"type"},{"location":"API/#SurfaceFluxes.UniversalFunctions.GrachevParams","page":"API Reference","title":"SurfaceFluxes.UniversalFunctions.GrachevParams","text":"GrachevParams{FT}\n\nParameter bundle for the Grachev et al. (2007) similarity relations, based on SHEBA data.\n\na_h, b_h, c_h: Coefficients for heat/scalar stability function (Eq. 9b). Note: c_h is the coefficient for the linear ζ term in the denominator.\nPr_0: Neutral Prandtl number. In the original Grachev et al. (2007) derivation,   this is 1.0. It is included here for structural consistency with other   parameterizations.\n\nReference: Grachev et al. (2007).\n\n\n\n\n\n","category":"type"},{"location":"API/#Transport-Types","page":"API Reference","title":"Transport Types","text":"","category":"section"},{"location":"API/","page":"API Reference","title":"API Reference","text":"SurfaceFluxes.UniversalFunctions.MomentumTransport\nSurfaceFluxes.UniversalFunctions.HeatTransport","category":"page"},{"location":"API/#SurfaceFluxes.UniversalFunctions.MomentumTransport","page":"API Reference","title":"SurfaceFluxes.UniversalFunctions.MomentumTransport","text":"MomentumTransport\n\nType selecting momentum-transfer stability functions (ϕₘ, ψₘ, Ψₘ).\n\n\n\n\n\n","category":"type"},{"location":"API/#SurfaceFluxes.UniversalFunctions.HeatTransport","page":"API Reference","title":"SurfaceFluxes.UniversalFunctions.HeatTransport","text":"HeatTransport\n\nType selecting heat/scalar-transfer stability functions (ϕₕ, ψₕ, Ψₕ).\n\n\n\n\n\n","category":"type"}]
}
