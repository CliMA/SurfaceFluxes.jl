<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>API Reference · SurfaceFluxes.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="SurfaceFluxes.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">SurfaceFluxes.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../SurfaceFluxes/">Surface Fluxes Theory</a></li><li><a class="tocitem" href="../UniversalFunctions/">Universal Functions</a></li><li><a class="tocitem" href="../PhysicalScales/">Physical Scales</a></li><li><a class="tocitem" href="../ExchangeFluxes/">Exchange Fluxes</a></li><li><a class="tocitem" href="../PrescribedConditions/">Prescribed Conditions</a></li><li><a class="tocitem" href="../TestSuite/">Test Suite</a></li><li class="is-active"><a class="tocitem" href>API Reference</a><ul class="internal"><li><a class="tocitem" href="#Main-Solver-Interface"><span>Main Solver Interface</span></a></li><li><a class="tocitem" href="#Flux-Calculations"><span>Flux Calculations</span></a></li><li><a class="tocitem" href="#Exchange-Coefficients"><span>Exchange Coefficients</span></a></li><li><a class="tocitem" href="#Physical-Scales-and-Variances"><span>Physical Scales &amp; Variances</span></a></li><li><a class="tocitem" href="#Roughness-and-Gustiness"><span>Roughness &amp; Gustiness</span></a></li><li><a class="tocitem" href="#Universal-Functions"><span>Universal Functions</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>API Reference</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>API Reference</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/CliMA/SurfaceFluxes.jl/blob/main/docs/src/API.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="API-Reference"><a class="docs-heading-anchor" href="#API-Reference">API Reference</a><a id="API-Reference-1"></a><a class="docs-heading-anchor-permalink" href="#API-Reference" title="Permalink"></a></h1><h2 id="Main-Solver-Interface"><a class="docs-heading-anchor" href="#Main-Solver-Interface">Main Solver Interface</a><a id="Main-Solver-Interface-1"></a><a class="docs-heading-anchor-permalink" href="#Main-Solver-Interface" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="SurfaceFluxes.surface_fluxes" href="#SurfaceFluxes.surface_fluxes"><code>SurfaceFluxes.surface_fluxes</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">surface_fluxes(param_set, T_int, q_tot_int, q_liq_int, q_ice_int, ρ_int, T_sfc_guess, q_vap_sfc_guess, Φ_sfc, Δz, d, u_int, u_sfc, roughness_inputs=nothing, config=default, scheme=PointValueScheme, solver_opts=nothing, flux_specs=nothing)</code></pre><p>Core entry point for calculating surface fluxes using Monin-Obukhov Similarity Theory (MOST).</p><p><strong>Functionality</strong></p><p>Calculates sensible heat flux, latent heat flux, momentum flux (stress), and friction velocity.</p><p>Can operate in four modes depending on inputs:</p><ol><li><strong>Prescribed Coefficients</strong>: If <code>Cd</code> and <code>Ch</code> are provided in <code>flux_specs</code>, fluxes are computed directly.</li><li><strong>Fully Prescribed Fluxes</strong>: If <code>shf</code>, <code>lhf</code>, and <code>ustar</code> are provided, they are validated and the fluxes are returned.</li><li><strong>Prescribed Heat and Drag</strong>: If <code>shf</code>, <code>lhf</code>, and <code>Cd</code> are provided, <code>ustar</code> is derived from <code>Cd</code> and wind speed.</li><li><strong>Iterative Solver</strong>: Otherwise, iterates to find the Obukhov stability parameter <code>ζ</code>. Optional functions can be provided to calculate the skin temperature and skin humidity during the iteration.</li></ol><p><strong>Arguments</strong></p><ul><li><code>param_set</code>: SurfaceFluxes parameters (containing thermodynamics and universal function params).</li><li><code>T_int</code>: Interior (air) temperature [K] at height <code>z</code>.</li><li><code>q_tot_int</code>: Interior total specific humidity [kg/kg].</li><li><code>q_liq_int</code>, <code>q_ice_int</code>: Interior liquid/ice specific humidity [kg/kg].</li><li><code>ρ_int</code>: Interior air density [kg/m^3].</li><li><code>T_sfc_guess</code>: Initial guess for surface temperature [K], updated via callback if provided.</li><li><code>q_vap_sfc_guess</code>: Initial guess for surface vapor specific humidity [kg/kg], updated via callback if provided.</li><li><code>Φ_sfc</code>: Surface geopotential [m^2/s^2].</li><li><code>Δz</code>: Geometric height difference between the surface and the interior level [m], used for geopotential.</li><li><code>d</code>: Displacement height [m]. Aerodynamic calculations (MOST) use effective height <code>Δz - d</code>.</li><li><code>u_int</code>: Tuple of interior wind components <code>(u, v)</code> [m/s].</li><li><code>u_sfc</code>: Tuple of surface wind components <code>(u, v)</code> [m/s]. (Usually <code>(0, 0)</code>).</li><li><code>roughness_inputs</code>: Optional container of parameters (e.g., LAI, canopy height) that are passed directly to the specific roughness model (e.g., <code>RaupachRoughnessParams</code>).</li><li><code>config</code>: <a href="#SurfaceFluxes.SurfaceFluxConfig"><code>SurfaceFluxConfig</code></a> struct containing:<ul><li><code>roughness</code>: Model for roughness lengths (e.g., <code>ConstantRoughnessParams</code>, <code>COARE3RoughnessSpec</code>). Note: This package currently assumes the roughness length for heat (<code>z0h</code>) is equal to the  roughness length for scalars (<code>z0s</code>).</li><li><code>gustiness</code>: Model for gustiness (e.g., <code>ConstantGustinessSpec</code>).</li><li><code>moisture_model</code>: <code>DryModel</code> or <code>WetModel</code>.</li></ul></li><li><code>scheme</code>: Discretization scheme (<code>PointValueScheme</code> or <code>LayerAverageScheme</code>).</li><li><code>solver_opts</code>: Options for the root solver (<code>maxiter</code>, <code>tol</code>, <code>rtol</code>, <code>forced_fixed_iters</code>).</li><li><code>flux_specs</code>: Optional <code>FluxSpecs</code> to prescribe specific constraints (e.g., <code>ustar</code>, <code>shf</code>, <code>Cd</code>).</li><li><code>update_T_sfc</code>: Optional callback <code>f(T_sfc)</code> to update surface temperature during iteration.</li><li><code>update_q_vap_sfc</code>: Optional callback <code>f(q_vap)</code> to update surface humidity during iteration.</li></ul><p><strong>Returns</strong></p><p>A <a href="#SurfaceFluxes.SurfaceFluxConditions"><code>SurfaceFluxConditions</code></a> struct containing:</p><ul><li><code>shf</code>: Sensible Heat Flux [W/m^2].</li><li><code>lhf</code>: Latent Heat Flux [W/m^2].</li><li><code>evaporation</code>: Evaporation rate [kg/m^2/s].</li><li><code>ustar</code>: Friction velocity [m/s].</li><li><code>ρτxz</code>, <code>ρτyz</code>: Momentum flux components (stress) [N/m^2].</li><li><code>ζ</code>: Stability parameter (<code>(z-d)/L</code>).</li><li><code>Cd</code>: Drag coefficient</li><li><code>g_h</code>: Heat conductance [m/s]</li><li><code>T_sfc</code>, <code>q_vap_sfc</code>: Surface temperature [K] and vapor specific humidity <a href="final iterated values">kg/kg</a>.</li><li><code>L_MO</code>: Monin-Obukhov length [m].</li><li><code>converged</code>: Convergence status.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/SurfaceFluxes.jl/blob/b15e2bfe4c2851534beb8063e89c2313ebb0b527/src/SurfaceFluxes.jl#L118-L172">source</a></section><section><div><pre><code class="nohighlight hljs">surface_fluxes(param_set, inputs, scheme=PointValueScheme(), solver_opts=nothing)</code></pre><p>Dispatch to the appropriate solver mode based on the availability of inputs (coefficients, fluxes, or state).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/SurfaceFluxes.jl/blob/b15e2bfe4c2851534beb8063e89c2313ebb0b527/src/SurfaceFluxes.jl#L224-L228">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SurfaceFluxes.SurfaceFluxConditions" href="#SurfaceFluxes.SurfaceFluxConditions"><code>SurfaceFluxes.SurfaceFluxConditions</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">SurfaceFluxConditions</code></pre><p>Surface flux conditions, returned from <code>surface_fluxes</code>.</p><ul><li><code>shf::FT</code>: Sensible heat flux [W/m²]</li><li><code>lhf::FT</code>: Latent heat flux [W/m²]</li><li><code>evaporation::FT</code>: Evaporation rate [kg/(m²·s)]</li><li><code>ρτxz::FT</code>: Momentum flux, eastward component [kg/(m·s²)]</li><li><code>ρτyz::FT</code>: Momentum flux, northward component [kg/(m·s²)]</li><li><code>ustar::FT</code>: Friction velocity [m/s]</li><li><code>ζ::FT</code>: Monin-Obukhov stability parameter (z/L)</li><li><code>Cd::FT</code>: Momentum exchange coefficient</li><li><code>g_h::FT</code>: Heat conductance [m/s]</li><li><code>T_sfc::FT</code>: Surface temperature [K]</li><li><code>q_vap_sfc::FT</code>: Surface air vapor specific humidity [kg/kg]</li><li><code>L_MO::FT</code>: Monin-Obukhov lengthscale [m]</li><li><code>converged::Bool</code>: Solver convergence status</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/SurfaceFluxes.jl/blob/b15e2bfe4c2851534beb8063e89c2313ebb0b527/src/types.jl#L136-L154">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SurfaceFluxes.SurfaceFluxConfig" href="#SurfaceFluxes.SurfaceFluxConfig"><code>SurfaceFluxes.SurfaceFluxConfig</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">SurfaceFluxConfig</code></pre><p>Configuration for surface flux calculation components.</p><p><strong>Fields</strong></p><ul><li><code>roughness</code>: The roughness length parameterization to use (e.g., <a href="#SurfaceFluxes.ConstantRoughnessParams"><code>ConstantRoughnessParams</code></a>).</li><li><code>gustiness</code>: The gustiness parameterization to use (e.g., <a href="#SurfaceFluxes.ConstantGustinessSpec"><code>ConstantGustinessSpec</code></a>).</li><li><code>moisture_model</code>: The moisture model (e.g., <a href="#SurfaceFluxes.MoistModel"><code>MoistModel</code></a> or <a href="#SurfaceFluxes.DryModel"><code>DryModel</code></a>).</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/SurfaceFluxes.jl/blob/b15e2bfe4c2851534beb8063e89c2313ebb0b527/src/types.jl#L52-L61">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SurfaceFluxes.FluxSpecs" href="#SurfaceFluxes.FluxSpecs"><code>SurfaceFluxes.FluxSpecs</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">FluxSpecs{FT}</code></pre><p>Container for prescribed surface flux boundary conditions.</p><p><strong>Fields</strong></p><ul><li><code>shf</code>: Sensible Heat Flux [W/m^2].</li><li><code>lhf</code>: Latent Heat Flux [W/m^2].</li><li><code>ustar</code>: Friction velocity [m/s].</li><li><code>Cd</code>: Momentum exchange coefficient.</li><li><code>Ch</code>: Heat exchange coefficient.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/SurfaceFluxes.jl/blob/b15e2bfe4c2851534beb8063e89c2313ebb0b527/src/types.jl#L80-L91">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SurfaceFluxes.SolverOptions" href="#SurfaceFluxes.SolverOptions"><code>SurfaceFluxes.SolverOptions</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">SolverOptions{FT}</code></pre><p>Options for the Monin-Obukhov similarity theory solver.</p><p><strong>Fields</strong></p><ul><li><code>tol</code>: Absolute tolerance on the change in the stability parameter for determining convergence.</li><li><code>rtol</code>: Relative tolerance on the change in the stability parameter for determining convergence.</li><li><code>maxiter</code>: Maximum number of iterations.</li><li><code>forced_fixed_iters</code>: If true, disables the tolerance check and forces the solver to run for exactly <code>maxiter</code> iterations (or until machine precision is reached/bypassed). Default is <code>true</code>.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/SurfaceFluxes.jl/blob/b15e2bfe4c2851534beb8063e89c2313ebb0b527/src/types.jl#L117-L127">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SurfaceFluxes.SolverScheme" href="#SurfaceFluxes.SolverScheme"><code>SurfaceFluxes.SolverScheme</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">SolverScheme</code></pre><p>Abstract type for surface flux solver schemes.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/SurfaceFluxes.jl/blob/b15e2bfe4c2851534beb8063e89c2313ebb0b527/src/UniversalFunctions.jl#L31-L35">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SurfaceFluxes.PointValueScheme" href="#SurfaceFluxes.PointValueScheme"><code>SurfaceFluxes.PointValueScheme</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">PointValueScheme &lt;: SolverScheme</code></pre><p>Standard finite difference scheme using point values.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/SurfaceFluxes.jl/blob/b15e2bfe4c2851534beb8063e89c2313ebb0b527/src/UniversalFunctions.jl#L45-L49">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SurfaceFluxes.LayerAverageScheme" href="#SurfaceFluxes.LayerAverageScheme"><code>SurfaceFluxes.LayerAverageScheme</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">LayerAverageScheme &lt;: SolverScheme</code></pre><p>Finite volume approximation scheme following Nishizawa &amp; Kitamura (2018).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/SurfaceFluxes.jl/blob/b15e2bfe4c2851534beb8063e89c2313ebb0b527/src/UniversalFunctions.jl#L38-L42">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SurfaceFluxes.compute_profile_value" href="#SurfaceFluxes.compute_profile_value"><code>SurfaceFluxes.compute_profile_value</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">compute_profile_value(param_set, L_MO, z0, Δz_eff, scale, val_sfc, transport, scheme)</code></pre><p>Compute the (nondimensional) value of a variable (momentum or scalar)  at effective aerodynamic height <code>Δz_eff</code> (height above surface minus displacement height).</p><p><strong>Arguments</strong></p><ul><li><code>param_set</code>: Parameter set.</li><li><code>L_MO</code>: Monin-Obukhov length [m].</li><li><code>z0</code>: Roughness length [m].</li><li><code>Δz_eff</code>: Effective aerodynamic height <code>z - d</code> [m].</li><li><code>scale</code>: Similarity scale (u<em>star, theta</em>star, etc.).</li><li><code>val_sfc</code>: Surface value of the variable.</li><li><code>transport</code>: Transport type (<code>MomentumTransport</code> or <code>HeatTransport</code>).</li><li><code>scheme</code>: Discretization scheme (default: <code>PointValueScheme()</code>).</li></ul><p><strong>Formula:</strong></p><pre><code class="nohighlight hljs">X(Δz_eff) = (scale / κ) * F_z + val_sfc</code></pre><p>where <code>F_z</code> is the dimensionless profile at height <code>Δz_eff</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/SurfaceFluxes.jl/blob/b15e2bfe4c2851534beb8063e89c2313ebb0b527/src/profile_recovery.jl#L1-L22">source</a></section></article><h2 id="Flux-Calculations"><a class="docs-heading-anchor" href="#Flux-Calculations">Flux Calculations</a><a id="Flux-Calculations-1"></a><a class="docs-heading-anchor-permalink" href="#Flux-Calculations" title="Permalink"></a></h2><p>Functions for computing specific fluxes.</p><article class="docstring"><header><a class="docstring-binding" id="SurfaceFluxes.sensible_heat_flux" href="#SurfaceFluxes.sensible_heat_flux"><code>SurfaceFluxes.sensible_heat_flux</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">shf = sensible_heat_flux(param_set, inputs, g_h, T_int, T_sfc, ρ_sfc, E)</code></pre><p>Computes the sensible heat flux at the surface.</p><p>The sensible heat flux is given by</p><pre><code class="nohighlight hljs">SHF = -ρ_sfc * g_h * ΔDSE + VSE_sfc * E</code></pre><p>where <code>ΔDSE = DSE_int - DSE_sfc</code> is the difference in dry static energy between the interior and surface, <code>g_h</code> is the heat/moisture conductance, <code>VSE_sfc</code> is the dry  static energy of water vapor at the surface temperature, and <code>E</code> is the evaporation rate. The  second term, <code>VSE_sfc * E</code>, accounts for the vapor static energy  <code>VSE_sfc = cp_v * (T_sfc - T_0) + Φ_sfc</code> (i.e., dry enthalpy <code>cp_v * (T_sfc - T_0)</code>,  or sensible heat, plus potential energy Φ_sfc) carried by evaporating water.</p><p>If <code>inputs.shf</code> is provided (not <code>nothing</code>), the function returns that value directly, allowing for prescribed sensible heat flux conditions. See the inputs container.</p><p><strong>Arguments</strong></p><ul><li><code>param_set</code>: Parameter set.</li><li><code>inputs</code>: The inputs container. See <a href="@ref"><code>build_surface_flux_inputs</code></a>.</li><li><code>g_h</code>: Heat/moisture conductance [m/s].</li><li><code>T_int</code>: Interior temperature [K].</li><li><code>T_sfc</code>: Surface temperature [K].</li><li><code>ρ_sfc</code>: Surface air density [kg/m^3].</li><li><code>E</code>: Evaporation rate [kg/m^2/s]. Optional, default 0.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/SurfaceFluxes.jl/blob/b15e2bfe4c2851534beb8063e89c2313ebb0b527/src/bulk_fluxes.jl#L1-L28">source</a></section><section><div><pre><code class="nohighlight hljs">sensible_heat_flux(param_set, ζ, ustar, inputs, z0m, z0h, T_sfc, q_vap_sfc, ρ_sfc, scheme)</code></pre><p>Computes the sensible heat flux given the Monin-Obukhov stability parameter <code>ζ</code>, friction velocity <code>ustar</code>, roughness lengths, and surface state. Useful for computing fluxes from variables available inside the solver loop.</p><p><strong>Arguments</strong></p><ul><li><code>param_set</code>: Parameter set.</li><li><code>ζ</code>: Monin-Obukhov stability parameter.</li><li><code>ustar</code>: Friction velocity [m/s].</li><li><code>inputs</code>: The inputs container. See <a href="@ref"><code>build_surface_flux_inputs</code></a>.</li><li><code>z0m</code>: Momentum roughness length [m].</li><li><code>z0h</code>: Thermal roughness length [m].</li><li><code>T_sfc</code>: Surface temperature [K].</li><li><code>q_vap_sfc</code>: Surface vapor specific humidity [kg/kg].</li><li><code>ρ_sfc</code>: Surface air density [kg/m^3].</li><li><code>scheme</code>: Discretization scheme.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/SurfaceFluxes.jl/blob/b15e2bfe4c2851534beb8063e89c2313ebb0b527/src/bulk_fluxes.jl#L52-L70">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SurfaceFluxes.latent_heat_flux" href="#SurfaceFluxes.latent_heat_flux"><code>SurfaceFluxes.latent_heat_flux</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">latent_heat_flux(param_set, inputs, E, model)</code></pre><p>Computes the latent heat flux at the surface.</p><p>The latent heat flux is given by</p><pre><code class="nohighlight hljs">LHF = LH_v0 * E</code></pre><p>where <code>LH_v0</code> is the latent heat of vaporization at the reference temperature and <code>E</code> is the evaporation rate.</p><p>If <code>inputs.lhf</code> is provided (not <code>nothing</code>), the function returns that value directly, allowing for prescribed latent heat flux conditions.</p><p>Arguments:</p><ul><li><code>param_set</code>: Parameter set.</li><li><code>inputs</code>: The inputs container. See <a href="@ref"><code>build_surface_flux_inputs</code></a>.</li><li><code>E</code>: Evaporation rate [kg/m^2/s].</li><li><code>model</code>: Moisture model (<a href="#SurfaceFluxes.MoistModel"><code>MoistModel</code></a> or <a href="#SurfaceFluxes.DryModel"><code>DryModel</code></a>).</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/SurfaceFluxes.jl/blob/b15e2bfe4c2851534beb8063e89c2313ebb0b527/src/bulk_fluxes.jl#L214-L234">source</a></section><section><div><pre><code class="nohighlight hljs">latent_heat_flux(param_set, ζ, ustar, inputs, z0m, z0h, q_vap_sfc, ρ_sfc, scheme)</code></pre><p>Computes the latent heat flux given the Monin-Obukhov stability parameter <code>ζ</code>, friction velocity <code>ustar</code>, roughness lengths, and surface state. Calculates conductance and evaporation internally.</p><p><strong>Arguments</strong></p><ul><li><code>param_set</code>: Parameter set.</li><li><code>ζ</code>: Monin-Obukhov stability parameter.</li><li><code>ustar</code>: Friction velocity [m/s].</li><li><code>inputs</code>: The inputs container. See <a href="@ref"><code>build_surface_flux_inputs</code></a>.</li><li><code>z0m</code>: Momentum roughness length [m].</li><li><code>z0h</code>: Thermal roughness length [m].</li><li><code>q_vap_sfc</code>: Surface vapor specific humidity [kg/kg].</li><li><code>ρ_sfc</code>: Surface air density [kg/m^3].</li><li><code>scheme</code>: Discretization scheme.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/SurfaceFluxes.jl/blob/b15e2bfe4c2851534beb8063e89c2313ebb0b527/src/bulk_fluxes.jl#L260-L278">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SurfaceFluxes.buoyancy_flux" href="#SurfaceFluxes.buoyancy_flux"><code>SurfaceFluxes.buoyancy_flux</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">buoyancy_flux(param_set, shf, lhf, T_sfc, ρ_sfc, q_vap_sfc, q_liq_sfc, q_ice_sfc, model)</code></pre><p>Computes the buoyancy flux at the surface, accounting for the presence of liquid and ice condensate.</p><p>The buoyancy flux <code>B</code> is defined as the vertical flux of virtual potential temperature <code>θ_v</code>. It is approximated by linearizing the density perturbations with respect to temperature and total water content:</p><pre><code class="nohighlight hljs">B ≈ (g / ρ_sfc) * ( SHF / (cp_m * T_sfc) + (ε_vd - 1) * LHF / LH_v0 )</code></pre><p>Where:</p><ul><li><code>cp_m</code> is the specific heat of moist air, calculated using <code>q_tot_sfc</code>, <code>q_liq_sfc</code>, and <code>q_ice_sfc</code>.</li><li><code>ε_vd</code> is the ratio of gas constants for water vapor and dry air.</li><li>The term <code>(ε_vd - 1)</code> (approximately 0.61) represents the density effect of water vapor relative to dry air   (the virtual temperature correction factor), ensuring the buoyancy flux accounts for the fact that moist   air is lighter than dry air.</li></ul><p>Arguments:</p><ul><li><code>ρ_sfc</code>: Surface air density [kg/m³].</li><li><code>q_vap_sfc</code>: Specific humidity of water vapor at the surface (default: 0).</li><li><code>q_liq_sfc</code>: Specific humidity of liquid water at the surface (default: 0).</li><li><code>q_ice_sfc</code>: Specific humidity of ice at the surface (default: 0).</li><li><code>model</code>: Moisture model (<a href="#SurfaceFluxes.MoistModel"><code>MoistModel</code></a> or <a href="#SurfaceFluxes.DryModel"><code>DryModel</code></a>).</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/SurfaceFluxes.jl/blob/b15e2bfe4c2851534beb8063e89c2313ebb0b527/src/bulk_fluxes.jl#L305-L328">source</a></section><section><div><pre><code class="nohighlight hljs">buoyancy_flux(param_set, ζ, ustar, inputs)</code></pre><p>Computes the buoyancy flux given the Monin-Obukhov stability parameter <code>ζ</code>, friction velocity <code>ustar</code>, and geometric inputs via the inputs container.</p><p>The relationship is derived from the definition of the Obukhov length:</p><pre><code class="nohighlight hljs">L = -u_*^3 / (κ * B)
ζ = Δz / L
=&gt; B = -(u_*^3 * ζ) / (κ * Δz)</code></pre><p><strong>Arguments</strong></p><ul><li><code>param_set</code>: Parameter set.</li><li><code>ζ</code>: Monin-Obukhov stability parameter.</li><li><code>ustar</code>: Friction velocity [m/s].</li><li><code>inputs</code>: The inputs container. See <a href="@ref"><code>build_surface_flux_inputs</code></a>.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/SurfaceFluxes.jl/blob/b15e2bfe4c2851534beb8063e89c2313ebb0b527/src/bulk_fluxes.jl#L385-L402">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SurfaceFluxes.evaporation" href="#SurfaceFluxes.evaporation"><code>SurfaceFluxes.evaporation</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">E = evaporation(param_set, inputs, g_h, q_vap_int, q_vap_sfc, ρ_sfc, model)</code></pre><p>Computes the evaporation rate at the surface.</p><p>The evaporation rate is given by</p><pre><code class="nohighlight hljs">E = -ρ_sfc * g_h * Δq_vap</code></pre><p>where <code>Δq_vap = q_vap_int - q_vap_sfc</code> is the difference in vapor specific humidity between the interior and surface, <code>g_h</code> is the heat/moisture conductance (heat and moisture  conductances must be equal for energetic consistency), and <code>ρ_sfc</code> is the surface air density. Here <code>q_vap_int</code> and <code>q_vap_sfc</code> are the vapor specific humidities (not total specific humidity) at the interior and surface, respectively.</p><p>If <code>inputs.lhf</code> is provided (not <code>nothing</code>), the function returns the evaporation rate computed from the prescribed latent heat flux: <code>E = LHF / LH_v0</code>, where <code>LH_v0</code> is the latent heat of vaporization at the reference temperature.</p><p>Arguments:</p><ul><li><code>param_set</code>: Parameter set.</li><li><code>inputs</code>: The inputs container. See <a href="@ref"><code>build_surface_flux_inputs</code></a>.</li><li><code>g_h</code>: Heat conductance [m/s].</li><li><code>q_vap_int</code>: Interior vapor specific humidity [kg/kg].</li><li><code>q_vap_sfc</code>: Surface vapor specific humidity [kg/kg].</li><li><code>ρ_sfc</code>: Surface density [kg/m^3].</li><li><code>model</code>: Moisture model (<a href="#SurfaceFluxes.MoistModel"><code>MoistModel</code></a> or <a href="#SurfaceFluxes.DryModel"><code>DryModel</code></a>).</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/SurfaceFluxes.jl/blob/b15e2bfe4c2851534beb8063e89c2313ebb0b527/src/bulk_fluxes.jl#L110-L137">source</a></section><section><div><pre><code class="nohighlight hljs">evaporation(param_set, ζ, ustar, inputs, z0m, z0h, q_vap_sfc, ρ_sfc, scheme)</code></pre><p>Computes the evaporation rate given the Monin-Obukhov stability parameter <code>ζ</code>, friction velocity <code>ustar</code>, roughness lengths, and surface state.</p><p><strong>Arguments</strong></p><ul><li><code>param_set</code>: Parameter set.</li><li><code>ζ</code>: Monin-Obukhov stability parameter.</li><li><code>ustar</code>: Friction velocity [m/s].</li><li><code>inputs</code>: The inputs container. See <a href="@ref"><code>build_surface_flux_inputs</code></a>.</li><li><code>z0m</code>: Momentum roughness length [m].</li><li><code>z0h</code>: Thermal roughness length [m].</li><li><code>q_vap_sfc</code>: Surface vapor specific humidity [kg/kg].</li><li><code>ρ_sfc</code>: Surface air density [kg/m^3].</li><li><code>scheme</code>: Discretization scheme.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/SurfaceFluxes.jl/blob/b15e2bfe4c2851534beb8063e89c2313ebb0b527/src/bulk_fluxes.jl#L170-L187">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SurfaceFluxes.momentum_fluxes" href="#SurfaceFluxes.momentum_fluxes"><code>SurfaceFluxes.momentum_fluxes</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">momentum_fluxes(Cd, inputs, ρ_sfc, gustiness)</code></pre><p>Computes the momentum fluxes at the surface.</p><p>The momentum fluxes are calculated using the bulk aerodynamic formula:</p><pre><code class="nohighlight hljs">ρτxz = -ρ_sfc * Cd * ΔU * Δu_x
ρτyz = -ρ_sfc * Cd * ΔU * Δu_y</code></pre><p>where:</p><ul><li><code>Cd</code>: Momentum exchange coefficient (drag coefficient)</li><li><code>ΔU</code>: Magnitude of the wind speed difference (including gustiness)</li><li><code>Δu_x</code>, <code>Δu_y</code>: Components of the wind speed difference</li><li><code>ρ_sfc</code>: Surface air density</li></ul><p>Returns a tuple <code>(ρτxz, ρτyz)</code>.</p><p>See the inputs container.</p><p><strong>Arguments</strong></p><ul><li><code>Cd</code>: Drag coefficient.</li><li><code>inputs</code>: The inputs container. See <a href="@ref"><code>build_surface_flux_inputs</code></a>.</li><li><code>ρ_sfc</code>: Surface air density [kg/m^3].</li><li><code>gustiness</code>: Gustiness velocity scale [m/s].</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/SurfaceFluxes.jl/blob/b15e2bfe4c2851534beb8063e89c2313ebb0b527/src/bulk_fluxes.jl#L414-L439">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SurfaceFluxes.state_bulk_richardson_number" href="#SurfaceFluxes.state_bulk_richardson_number"><code>SurfaceFluxes.state_bulk_richardson_number</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">state_bulk_richardson_number(param_set, inputs, T_sfc, ρ_sfc, ΔU, q_vap_sfc)</code></pre><p>Computes the bulk Richardson number from the given state.</p><p><strong>Arguments</strong></p><ul><li><code>param_set</code>: Parameter set.</li><li><code>inputs</code>: The inputs container. See <a href="@ref"><code>build_surface_flux_inputs</code></a>.</li><li><code>T_sfc</code>: Surface temperature [K].</li><li><code>ρ_sfc</code>: Surface air density [kg/m³].</li><li><code>ΔU</code>: Wind speed difference [m/s].</li><li><code>q_vap_sfc</code>: Surface vapor specific humidity [kg/kg]. Default: 0.</li></ul><p>Returns the bulk Richardson number.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/SurfaceFluxes.jl/blob/b15e2bfe4c2851534beb8063e89c2313ebb0b527/src/bulk_fluxes.jl#L453-L467">source</a></section></article><h2 id="Exchange-Coefficients"><a class="docs-heading-anchor" href="#Exchange-Coefficients">Exchange Coefficients</a><a id="Exchange-Coefficients-1"></a><a class="docs-heading-anchor-permalink" href="#Exchange-Coefficients" title="Permalink"></a></h2><p>Non-dimensional exchange coefficients and conductances.</p><article class="docstring"><header><a class="docstring-binding" id="SurfaceFluxes.drag_coefficient" href="#SurfaceFluxes.drag_coefficient"><code>SurfaceFluxes.drag_coefficient</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">drag_coefficient(param_set, ζ, z0m, Δz_eff, scheme)</code></pre><p>Compute the drag coefficient <code>Cd</code> for momentum exchange.</p><p><strong>Arguments</strong></p><ul><li><code>param_set</code>: Parameter set</li><li><code>ζ</code>: Stability parameter <code>ζ = Δz_eff / L_MO</code></li><li><code>z0m</code>: Roughness length for momentum [m]</li><li><code>Δz_eff</code>: Effective aerodynamic height <code>Δz - d</code> [m] </li><li><code>scheme</code>: Surface flux solver scheme (default: <code>PointValueScheme()</code>)</li></ul><p><strong>Formula:</strong></p><pre><code class="nohighlight hljs">Cd = (κ / F_m)^2</code></pre><p>where <code>F_m</code> is the dimensionless velocity profile.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/SurfaceFluxes.jl/blob/b15e2bfe4c2851534beb8063e89c2313ebb0b527/src/exchange_coefficients.jl#L1-L19">source</a></section><section><div><pre><code class="nohighlight hljs">drag_coefficient(inputs, speed)</code></pre><p>Compute the drag coefficient <code>Cd</code> from friction velocity (presumed to be in <code>inputs.ustar</code>)  and effective wind speed (including any gustiness factors).</p><p>See the inputs container.</p><p><strong>Arguments</strong></p><ul><li><code>inputs</code>: The inputs container. See <a href="@ref"><code>build_surface_flux_inputs</code></a>.</li><li><code>speed</code>: Effective wind speed [m/s].</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/SurfaceFluxes.jl/blob/b15e2bfe4c2851534beb8063e89c2313ebb0b527/src/exchange_coefficients.jl#L36-L47">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SurfaceFluxes.heat_exchange_coefficient" href="#SurfaceFluxes.heat_exchange_coefficient"><code>SurfaceFluxes.heat_exchange_coefficient</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">heat_exchange_coefficient(param_set, ζ, z0m, z0h, Δz_eff, scheme)</code></pre><p>Compute the heat exchange coefficient <code>Ch</code> for scalar exchange.</p><p><strong>Formula:</strong></p><pre><code class="nohighlight hljs">Ch = κ^2 / (F_m * F_h),</code></pre><p>where <code>F_m</code> and <code>F_h</code> are the dimensionless profiles for momentum and scalars.  For the finite-volume case, this corresponds to the formulation in  Nishizawa &amp; Kitamura (2018), Eqs. 21 &amp; 22 (with Pr<em>0 absorbed into F</em>h).</p><p><strong>Arguments</strong></p><ul><li><code>param_set</code>: Parameter set</li><li><code>ζ</code>: Stability parameter <code>ζ = Δz_eff / L_MO</code></li><li><code>z0m</code>: Roughness length for momentum [m]</li><li><code>z0h</code>: Roughness length for scalars (heat/moisture) [m]</li><li><code>Δz_eff</code>: Effective aerodynamic height <code>Δz - d</code> [m] </li><li><code>scheme</code>: Surface flux solver scheme (default: <code>PointValueScheme()</code>)</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/SurfaceFluxes.jl/blob/b15e2bfe4c2851534beb8063e89c2313ebb0b527/src/exchange_coefficients.jl#L53-L74">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SurfaceFluxes.heat_conductance" href="#SurfaceFluxes.heat_conductance"><code>SurfaceFluxes.heat_conductance</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">heat_conductance(param_set, ζ, ustar, inputs, z0m, z0h, scheme)</code></pre><p>Compute the heat conductance <code>g_h</code> (speed * Ch), including any gustiness factor in the wind speed. Calculates windspeed and exchange coefficient internally from Monin-Obukhov variables.</p><p><strong>Arguments</strong></p><ul><li><code>param_set</code>: Parameter set.</li><li><code>ζ</code>: Monin-Obukhov stability parameter.</li><li><code>ustar</code>: Friction velocity [m/s].</li><li><code>inputs</code>: The inputs container. See <a href="@ref"><code>build_surface_flux_inputs</code></a>.</li><li><code>z0m</code>: Momentum roughness length [m].</li><li><code>z0h</code>: Thermal roughness length [m].</li><li><code>scheme</code>: Discretization scheme.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/SurfaceFluxes.jl/blob/b15e2bfe4c2851534beb8063e89c2313ebb0b527/src/exchange_coefficients.jl#L94-L109">source</a></section></article><h2 id="Physical-Scales-and-Variances"><a class="docs-heading-anchor" href="#Physical-Scales-and-Variances">Physical Scales &amp; Variances</a><a id="Physical-Scales-and-Variances-1"></a><a class="docs-heading-anchor-permalink" href="#Physical-Scales-and-Variances" title="Permalink"></a></h2><p>Functions for computing Monin-Obukhov similarity scales and variances.</p><article class="docstring"><header><a class="docstring-binding" id="SurfaceFluxes.compute_physical_scale_coeff" href="#SurfaceFluxes.compute_physical_scale_coeff"><code>SurfaceFluxes.compute_physical_scale_coeff</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">compute_physical_scale_coeff(
    param_set::APS,
    Δz_eff,
    ζ,
    z0,
    transport,
    scheme::SolverScheme,
)</code></pre><p>Computes the coefficient for the physical scale of a variable. Returns <code>ϕ</code> such that <code>scale = Δvalue * ϕ</code>. For example, <code>u★ = ΔU * ϕ_m</code>.</p><p><strong>Arguments</strong></p><ul><li><code>Δz_eff</code>: Effective aerodynamic height <code>Δz - d</code> [m]</li></ul><p>This is computed as:</p><p class="math-container">\[ϕ = \frac{κ}{F(Δz_eff, ζ, z_0)}\]</p><p>where <code>F</code> is the dimensionless profile function from <code>UniversalFunctions</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/SurfaceFluxes.jl/blob/b15e2bfe4c2851534beb8063e89c2313ebb0b527/src/physical_scales.jl#L1-L21">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SurfaceFluxes.compute_ustar" href="#SurfaceFluxes.compute_ustar"><code>SurfaceFluxes.compute_ustar</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">compute_ustar(param_set, ζ, z0, inputs, scheme, gustiness)</code></pre><p>Return the friction velocity implied by the Monin-Obukhov solution.</p><p>If a friction velocity is prescribed via <code>inputs.ustar</code> (in the inputs container), it is returned directly; otherwise it is recomputed from the similarity coefficients.</p><p><strong>Arguments</strong></p><ul><li><code>param_set</code>: Parameter set.</li><li><code>ζ</code>: Monin-Obukhov stability parameter.</li><li><code>z0</code>: Momentum roughness length [m].</li><li><code>inputs</code>: The inputs container. See <a href="@ref"><code>build_surface_flux_inputs</code></a>.</li><li><code>scheme</code>: Discretization scheme.</li><li><code>gustiness</code>: Gustiness velocity scale [m/s].</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/SurfaceFluxes.jl/blob/b15e2bfe4c2851534beb8063e89c2313ebb0b527/src/physical_scales.jl#L44-L59">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SurfaceFluxes.compute_theta_star" href="#SurfaceFluxes.compute_theta_star"><code>SurfaceFluxes.compute_theta_star</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">compute_theta_star(param_set, ζ, z0h, inputs, scheme, T_sfc)</code></pre><p>Return the potential temperature scale implied by the Monin-Obukhov solution,  where <code>z0h</code> is the roughness length for heat.</p><p><strong>Arguments</strong></p><ul><li><code>param_set</code>: Parameter set.</li><li><code>ζ</code>: Monin-Obukhov stability parameter.</li><li><code>z0h</code>: Thermal roughness length [m].</li><li><code>inputs</code>: The inputs container. See <a href="@ref"><code>build_surface_flux_inputs</code></a>.</li><li><code>scheme</code>: Discretization scheme.</li><li><code>T_sfc</code>: Surface temperature [K]. Optional, defaults to <code>inputs.T_sfc_guess</code>.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/SurfaceFluxes.jl/blob/b15e2bfe4c2851534beb8063e89c2313ebb0b527/src/physical_scales.jl#L86-L100">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SurfaceFluxes.compute_q_star" href="#SurfaceFluxes.compute_q_star"><code>SurfaceFluxes.compute_q_star</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">compute_q_star(param_set, ζ, z0h, inputs, scheme, q_vap_sfc)</code></pre><p>Return the specific humidity scale implied by the current Monin-Obukhov solution,  where <code>z0h</code> is the roughness length for scalars (assumed equal to heat).</p><p><strong>Arguments</strong></p><ul><li><code>param_set</code>: Parameter set.</li><li><code>ζ</code>: Monin-Obukhov stability parameter.</li><li><code>z0h</code>: Thermal/scalar roughness length [m].</li><li><code>inputs</code>: The inputs container. See <a href="@ref"><code>build_surface_flux_inputs</code></a>.</li><li><code>scheme</code>: Discretization scheme.</li><li><code>q_vap_sfc</code>: Surface vapor specific humidity [kg/kg]. Optional, defaults to <code>inputs.q_vap_sfc_guess</code>.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/SurfaceFluxes.jl/blob/b15e2bfe4c2851534beb8063e89c2313ebb0b527/src/physical_scales.jl#L132-L146">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SurfaceFluxes.u_variance" href="#SurfaceFluxes.u_variance"><code>SurfaceFluxes.u_variance</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">u_variance(param_set, Δz_eff, ustar, ζ)</code></pre><p>Compute the velocity variance <code>σ_u^2 = (u_star * ϕ_σu)^2</code>.</p><p>For unstable conditions, the convective (Deardorff) velocity scale <code>w_*</code>  is calculated using the mixed-layer height <code>zi</code> from parameters, and  passed to the universal function. <code>Δz_eff</code> is the effective aerodynamic height.</p><p><strong>Arguments</strong></p><ul><li><code>param_set</code>: Parameter set.</li><li><code>Δz_eff</code>: Effective aerodynamic height [m].</li><li><code>ustar</code>: Friction velocity [m/s].</li><li><code>ζ</code>: Monin-Obukhov stability parameter.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/SurfaceFluxes.jl/blob/b15e2bfe4c2851534beb8063e89c2313ebb0b527/src/physical_scales.jl#L172-L186">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SurfaceFluxes.scalar_variance" href="#SurfaceFluxes.scalar_variance"><code>SurfaceFluxes.scalar_variance</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">scalar_variance(param_set, scale, ζ)</code></pre><p>Compute the scalar variance <code>σ_s^2 = (c_s * ϕ_σs)^2</code>.</p><p><strong>Arguments</strong></p><ul><li><code>param_set</code>: Parameter set.</li><li><code>scale</code>: Similarity scale of the scalar (e.g., <code>theta_star</code>, <code>q_star</code>).</li><li><code>ζ</code>: Monin-Obukhov stability parameter.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/SurfaceFluxes.jl/blob/b15e2bfe4c2851534beb8063e89c2313ebb0b527/src/physical_scales.jl#L210-L219">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SurfaceFluxes.theta_variance" href="#SurfaceFluxes.theta_variance"><code>SurfaceFluxes.theta_variance</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">theta_variance(param_set, inputs, shf, ustar, ζ, rho_sfc)</code></pre><p>Computes potential temperature variance from sensible heat flux <code>shf</code>. Calculates <code>θ_* = -shf / (ρ * c_p * u_*)</code> and calls <code>scalar_variance</code>.</p><p><strong>Arguments</strong></p><ul><li><code>param_set</code>: Parameter set.</li><li><code>inputs</code>: The inputs container. See <a href="@ref"><code>build_surface_flux_inputs</code></a>.</li><li><code>shf</code>: Sensible heat flux [W/m^2].</li><li><code>ustar</code>: Friction velocity [m/s].</li><li><code>ζ</code>: Monin-Obukhov stability parameter.</li><li><code>rho_sfc</code>: Surface density [kg/m^3].</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/SurfaceFluxes.jl/blob/b15e2bfe4c2851534beb8063e89c2313ebb0b527/src/physical_scales.jl#L228-L241">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SurfaceFluxes.obukhov_length" href="#SurfaceFluxes.obukhov_length"><code>SurfaceFluxes.obukhov_length</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">obukhov_length(param_set, ustar, buoy_flux)</code></pre><p>Computes the Monin-Obukhov length [m].</p><p>Returns zero if <code>ustar</code> is zero.</p><p><strong>Arguments</strong></p><ul><li><code>param_set</code>: Parameter set.</li><li><code>ustar</code>: Friction velocity [m/s].</li><li><code>buoy_flux</code>: Surace buoyancy flux [m^2/s^3].</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/SurfaceFluxes.jl/blob/b15e2bfe4c2851534beb8063e89c2313ebb0b527/src/physical_scales.jl#L254-L265">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SurfaceFluxes.obukhov_stability_parameter" href="#SurfaceFluxes.obukhov_stability_parameter"><code>SurfaceFluxes.obukhov_stability_parameter</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">obukhov_stability_parameter(param_set, Δz_eff, ustar, buoy_flux)</code></pre><p>Computes the Monin-Obukhov stability parameter <code>ζ = Δz_eff / L_MO</code>, where <code>Δz_eff</code> is the effective aerodynamic height (<span>$z-d$</span>).</p><p>Returns zero if <code>ustar</code> and hence <code>L_MO</code> are zero.</p><p><strong>Arguments</strong></p><ul><li><code>param_set</code>: Parameter set.</li><li><code>Δz_eff</code>: Effective aerodynamic height [m].</li><li><code>ustar</code>: Friction velocity [m/s].</li><li><code>buoy_flux</code>: Surace buoyancy flux [m^2/s^3].</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/SurfaceFluxes.jl/blob/b15e2bfe4c2851534beb8063e89c2313ebb0b527/src/physical_scales.jl#L273-L286">source</a></section></article><h2 id="Roughness-and-Gustiness"><a class="docs-heading-anchor" href="#Roughness-and-Gustiness">Roughness &amp; Gustiness</a><a id="Roughness-and-Gustiness-1"></a><a class="docs-heading-anchor-permalink" href="#Roughness-and-Gustiness" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="SurfaceFluxes.ConstantRoughnessParams" href="#SurfaceFluxes.ConstantRoughnessParams"><code>SurfaceFluxes.ConstantRoughnessParams</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">ConstantRoughnessParams{FT} &lt;: AbstractRoughnessParams</code></pre><p>Roughness lengths fixed to constant values.</p><p><strong>Fields</strong></p><ul><li><code>z0m</code>: Momentum roughness length [m]</li><li><code>z0s</code>: Scalar roughness length [m]. Used for both heat (<code>z0h</code>) and humidity (<code>z0q</code>).</li></ul><p>The default values specified here are used when constructing the struct manually. When loading via <code>ClimaParams</code>, these values are overwritten by the parameters in the <code>ClimaParams</code> TOML file.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/SurfaceFluxes.jl/blob/b15e2bfe4c2851534beb8063e89c2313ebb0b527/src/roughness_lengths.jl#L6-L17">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SurfaceFluxes.COARE3RoughnessParams" href="#SurfaceFluxes.COARE3RoughnessParams"><code>SurfaceFluxes.COARE3RoughnessParams</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">COARE3RoughnessParams{FT} &lt;: AbstractRoughnessParams</code></pre><p>COARE 3.0 roughness parameterization (Fairall et al. 2003).</p><p><strong>References</strong></p><ul><li>Fairall, C. W., Bradley, E. F., Hare, J. E., Grachev, A. A., &amp; Edson, J. B. (2003).    Bulk parameterization of air–sea fluxes: Updates and verification for the COARE algorithm.   Journal of Climate, 16, 571–591.   <a href="https://doi.org/10.1175/1520-0442(2003)016&lt;0571:BPOASF&gt;2.0.CO;2">DOI: 10.1175/1520-0442(2003)016&lt;0571:BPOASF&gt;2.0.CO;2</a></li></ul><p>The default values specified here are used when constructing the struct manually. When loading via <code>ClimaParams</code>, these values are overwritten by the parameters in the TOML file.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/SurfaceFluxes.jl/blob/b15e2bfe4c2851534beb8063e89c2313ebb0b527/src/roughness_lengths.jl#L23-L37">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SurfaceFluxes.RaupachRoughnessParams" href="#SurfaceFluxes.RaupachRoughnessParams"><code>SurfaceFluxes.RaupachRoughnessParams</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">RaupachRoughnessParams &lt;: AbstractRoughnessParams</code></pre><p>Raupach (1994) canopy roughness model.</p><p><strong>References</strong></p><ul><li>Raupach, M. R. (1994). Simplified expressions for vegetation roughness length and zero-plane displacement    as functions of canopy height and area index.   Boundary-Layer Meteorology, 71, 211–216.   <a href="https://doi.org/10.1007/BF00709229">DOI: 10.1007/BF00709229</a></li></ul><p>The default values specified here are used when constructing the struct manually. When loading via <code>ClimaParams</code>, <code>stanton_number</code> is overwritten by the parameter in the TOML file, while other parameters (<code>C_R</code>, <code>C_S</code>, <code>c_d1</code>) retain their default values.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/SurfaceFluxes.jl/blob/b15e2bfe4c2851534beb8063e89c2313ebb0b527/src/roughness_lengths.jl#L47-L61">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SurfaceFluxes.ConstantGustinessSpec" href="#SurfaceFluxes.ConstantGustinessSpec"><code>SurfaceFluxes.ConstantGustinessSpec</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">ConstantGustinessSpec{TG &lt;: Real}</code></pre><p>A gustiness model where the gustiness velocity is a constant value.</p><p><strong>Fields</strong></p><ul><li><code>value</code>: The constant gustiness velocity [m/s].</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/SurfaceFluxes.jl/blob/b15e2bfe4c2851534beb8063e89c2313ebb0b527/src/types.jl#L11-L17">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SurfaceFluxes.DeardorffGustinessSpec" href="#SurfaceFluxes.DeardorffGustinessSpec"><code>SurfaceFluxes.DeardorffGustinessSpec</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">DeardorffGustinessSpec</code></pre><p>A gustiness model based on Deardorff (1970) scaling with convective velocity scale <span>$w_*$</span>. The gustiness velocity is computed as: <span>$U_{gust} = \beta w_*^{1/3}$</span></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/SurfaceFluxes.jl/blob/b15e2bfe4c2851534beb8063e89c2313ebb0b527/src/types.jl#L22-L28">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SurfaceFluxes.MoistModel" href="#SurfaceFluxes.MoistModel"><code>SurfaceFluxes.MoistModel</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">MoistModel</code></pre><p>Indicates that moisture effects (latent heat, virtual temperature) should be included in the flux calculations.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/SurfaceFluxes.jl/blob/b15e2bfe4c2851534beb8063e89c2313ebb0b527/src/types.jl#L36-L40">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SurfaceFluxes.DryModel" href="#SurfaceFluxes.DryModel"><code>SurfaceFluxes.DryModel</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">DryModel</code></pre><p>Indicates that moisture effects should be ignored (sensible heat and momentum only).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/SurfaceFluxes.jl/blob/b15e2bfe4c2851534beb8063e89c2313ebb0b527/src/types.jl#L43-L47">source</a></section></article><h2 id="Universal-Functions"><a class="docs-heading-anchor" href="#Universal-Functions">Universal Functions</a><a id="Universal-Functions-1"></a><a class="docs-heading-anchor-permalink" href="#Universal-Functions" title="Permalink"></a></h2><p>The <code>UniversalFunctions</code> sub-module defines the stability functions <span>$\phi(\zeta)$</span> and <span>$\psi(\zeta)$</span>.</p><article class="docstring"><header><a class="docstring-binding" id="SurfaceFluxes.UniversalFunctions" href="#SurfaceFluxes.UniversalFunctions"><code>SurfaceFluxes.UniversalFunctions</code></a> — <span class="docstring-category">Module</span></header><section><div><pre><code class="language-julia hljs">UniversalFunctions</code></pre><p>Universal stability and stability correction functions for <code>SurfaceFluxes</code> module.  Supports the following universal functions:</p><ul><li><code>Businger</code>: Businger et al. (1971), Dyer (1974)</li><li><code>Gryanik</code>: Gryanik et al. (2020)</li><li><code>Grachev</code>: Grachev et al. (2007)</li></ul><p>It supports standard finite-difference (point-value) and finite-volume  (layer-averaged) schemes. The finite-volume scheme is based on the Nishizawa &amp; Kitamura (2018) formulation.</p><p>References:</p><ul><li>Businger et al. (1971): <a href="https://doi.org/10.1175/1520-0469(1971)028&lt;0181:FPRITA&gt;2.0.CO;2">https://doi.org/10.1175/1520-0469(1971)028&lt;0181:FPRITA&gt;2.0.CO;2</a></li><li>Dyer (1974): <a href="https://doi.org/10.1007/BF00240838">https://doi.org/10.1007/BF00240838</a></li><li>Gryanik et al. (2020): <a href="https://doi.org/10.1175/JAS-D-19-0255.1">https://doi.org/10.1175/JAS-D-19-0255.1</a></li><li>Grachev et al. (2007): <a href="https://doi.org/10.1007/s10546-007-9177-6">https://doi.org/10.1007/s10546-007-9177-6</a></li><li>Nishizawa &amp; Kitamura (2018): <a href="https://doi.org/10.1029/2018MS001534">https://doi.org/10.1029/2018MS001534</a></li><li>Panofsky et al. (1977): <a href="https://doi.org/10.1007/BF02186086">https://doi.org/10.1007/BF02186086</a></li><li>Wyngaard et al. (1971): <a href="https://doi.org/10.1175/1520-0469(1971)028&lt;1171:LFCSAT&gt;2.0.CO;2">https://doi.org/10.1175/1520-0469(1971)028&lt;1171:LFCSAT&gt;2.0.CO;2</a></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/SurfaceFluxes.jl/blob/b15e2bfe4c2851534beb8063e89c2313ebb0b527/src/UniversalFunctions.jl#L1-L21">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SurfaceFluxes.UniversalFunctions.phi" href="#SurfaceFluxes.UniversalFunctions.phi"><code>SurfaceFluxes.UniversalFunctions.phi</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">phi</code></pre><p>Universal stability function for wind shear (<code>ϕ_m</code>) and  temperature gradient (<code>ϕ_h</code>)</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/SurfaceFluxes.jl/blob/b15e2bfe4c2851534beb8063e89c2313ebb0b527/src/UniversalFunctions.jl#L90-L95">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SurfaceFluxes.UniversalFunctions.psi" href="#SurfaceFluxes.UniversalFunctions.psi"><code>SurfaceFluxes.UniversalFunctions.psi</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">psi(p, ζ, transport_type)</code></pre><p>The standard integrated stability correction function <code>ψ(ζ)</code>. Defined as:     ψ(ζ) = ∫<code>[0 to ζ]</code> (ϕ(0) - ϕ(x)) / x dx</p><p>This is the standard correction used in point-based Monin-Obukhov similarity theory. </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/SurfaceFluxes.jl/blob/b15e2bfe4c2851534beb8063e89c2313ebb0b527/src/UniversalFunctions.jl#L106-L115">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SurfaceFluxes.UniversalFunctions.Psi" href="#SurfaceFluxes.UniversalFunctions.Psi"><code>SurfaceFluxes.UniversalFunctions.Psi</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">Psi(p, ζ, transport_type)</code></pre><p>The volume-averaged stability correction function <code>Ψ(ζ)</code>. Mathematically, this is defined as:     Ψ(ζ) = (1/ζ) ∫<code>[0 to ζ]</code> ψ(x) dx</p><p>This function is required for finite-volume models where fluxes are calculated using cell-averaged values rather than point values at the cell center.</p><p>See Nishizawa &amp; Kitamura (2018), Eqs. 14 &amp; 15.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/SurfaceFluxes.jl/blob/b15e2bfe4c2851534beb8063e89c2313ebb0b527/src/UniversalFunctions.jl#L118-L130">source</a></section></article><h3 id="Parameter-Types"><a class="docs-heading-anchor" href="#Parameter-Types">Parameter Types</a><a id="Parameter-Types-1"></a><a class="docs-heading-anchor-permalink" href="#Parameter-Types" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-binding" id="SurfaceFluxes.UniversalFunctions.BusingerParams" href="#SurfaceFluxes.UniversalFunctions.BusingerParams"><code>SurfaceFluxes.UniversalFunctions.BusingerParams</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">BusingerParams{FT}</code></pre><p>Parameter bundle for the Businger (1971) similarity relations. Mappings to Nishizawa &amp; Kitamura (2018) coefficients:</p><ul><li><code>a_m</code>, <code>a_h</code>: The linear coefficients for stable conditions (β in some texts).</li><li><code>b_m</code>, <code>b_h</code>: The coefficients γ inside the unstable sqrt/cbrt terms (e.g., (1 - γζ)).</li><li><code>Pr_0</code>: The neutral Prandtl number.</li></ul><p>See Businger et al. (1971) and Nishizawa &amp; Kitamura (2018).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/SurfaceFluxes.jl/blob/b15e2bfe4c2851534beb8063e89c2313ebb0b527/src/UniversalFunctions.jl#L274-L284">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SurfaceFluxes.UniversalFunctions.GryanikParams" href="#SurfaceFluxes.UniversalFunctions.GryanikParams"><code>SurfaceFluxes.UniversalFunctions.GryanikParams</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">GryanikParams{FT}</code></pre><p>Parameter bundle for the Gryanik et al. (2020) similarity relations. These functions are designed to be valid across the entire stability range, including very stable conditions.</p><ul><li><code>a_m</code>, <code>b_m</code>: Coefficients for momentum stability function (Eq. 32).</li><li><code>a_h</code>, <code>b_h</code>: Coefficients for heat stability function (Eq. 33).</li><li><code>Pr_0</code>: Neutral Prandtl number. (The paper recommends Pr_0 ≈ 0.98.)</li></ul><p>Reference: Gryanik et al. (2020).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/SurfaceFluxes.jl/blob/b15e2bfe4c2851534beb8063e89c2313ebb0b527/src/UniversalFunctions.jl#L482-L494">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SurfaceFluxes.UniversalFunctions.GrachevParams" href="#SurfaceFluxes.UniversalFunctions.GrachevParams"><code>SurfaceFluxes.UniversalFunctions.GrachevParams</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">GrachevParams{FT}</code></pre><p>Parameter bundle for the Grachev et al. (2007) similarity relations, based on SHEBA data.</p><ul><li><code>a_h</code>, <code>b_h</code>, <code>c_h</code>: Coefficients for heat/scalar stability function (Eq. 9b). Note: <code>c_h</code> is the coefficient for the linear ζ term in the denominator.</li><li><code>Pr_0</code>: Neutral Prandtl number. In the original Grachev et al. (2007) derivation,   this is 1.0. It is included here for structural consistency with other   parameterizations.</li></ul><p>Reference: Grachev et al. (2007).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/SurfaceFluxes.jl/blob/b15e2bfe4c2851534beb8063e89c2313ebb0b527/src/UniversalFunctions.jl#L716-L729">source</a></section></article><h3 id="Transport-Types"><a class="docs-heading-anchor" href="#Transport-Types">Transport Types</a><a id="Transport-Types-1"></a><a class="docs-heading-anchor-permalink" href="#Transport-Types" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-binding" id="SurfaceFluxes.UniversalFunctions.MomentumTransport" href="#SurfaceFluxes.UniversalFunctions.MomentumTransport"><code>SurfaceFluxes.UniversalFunctions.MomentumTransport</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">MomentumTransport</code></pre><p>Type selecting momentum-transfer stability functions (ϕₘ, ψₘ, Ψₘ).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/SurfaceFluxes.jl/blob/b15e2bfe4c2851534beb8063e89c2313ebb0b527/src/UniversalFunctions.jl#L59-L63">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SurfaceFluxes.UniversalFunctions.HeatTransport" href="#SurfaceFluxes.UniversalFunctions.HeatTransport"><code>SurfaceFluxes.UniversalFunctions.HeatTransport</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">HeatTransport</code></pre><p>Type selecting heat/scalar-transfer stability functions (ϕₕ, ψₕ, Ψₕ).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/SurfaceFluxes.jl/blob/b15e2bfe4c2851534beb8063e89c2313ebb0b527/src/UniversalFunctions.jl#L66-L70">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../TestSuite/">« Test Suite</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Wednesday 18 February 2026 21:21">Wednesday 18 February 2026</span>. Using Julia version 1.11.9.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
