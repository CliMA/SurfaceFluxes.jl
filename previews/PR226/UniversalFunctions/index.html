<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Universal Functions · SurfaceFluxes.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="SurfaceFluxes.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">SurfaceFluxes.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../SurfaceFluxes/">Surface Fluxes Theory</a></li><li class="is-active"><a class="tocitem" href>Universal Functions</a><ul class="internal"><li><a class="tocitem" href="#Mathematical-Framework"><span>Mathematical Framework</span></a></li><li><a class="tocitem" href="#.-Businger-Dyer-Functions"><span>1. Businger-Dyer Functions</span></a></li><li><a class="tocitem" href="#.-Gryanik-Universal-Functions"><span>2. Gryanik Universal Functions</span></a></li><li><a class="tocitem" href="#.-Grachev-Universal-Functions"><span>3. Grachev Universal Functions</span></a></li><li><a class="tocitem" href="#Visualization-of-Universal-Functions"><span>Visualization of Universal Functions</span></a></li><li><a class="tocitem" href="#References"><span>References</span></a></li></ul></li><li><a class="tocitem" href="../PhysicalScales/">Physical Scales</a></li><li><a class="tocitem" href="../ExchangeFluxes/">Exchange Fluxes</a></li><li><a class="tocitem" href="../PrescribedConditions/">Prescribed Conditions</a></li><li><a class="tocitem" href="../TestSuite/">Test Suite</a></li><li><a class="tocitem" href="../API/">API Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Universal Functions</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Universal Functions</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/CliMA/SurfaceFluxes.jl/blob/main/docs/src/UniversalFunctions.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Universal-Functions-in-SurfaceFluxes.jl"><a class="docs-heading-anchor" href="#Universal-Functions-in-SurfaceFluxes.jl">Universal Functions in SurfaceFluxes.jl</a><a id="Universal-Functions-in-SurfaceFluxes.jl-1"></a><a class="docs-heading-anchor-permalink" href="#Universal-Functions-in-SurfaceFluxes.jl" title="Permalink"></a></h1><p><a href="https://github.com/CliMA/SurfaceFluxes.jl/blob/main/src/UniversalFunctions.jl"><code>UniversalFunctions.jl</code></a> provides the stability functions (universal functions) required by Monin-Obukhov Similarity Theory (MOST) to calculate surface fluxes of momentum and heat/tracers. These functions describe the non-dimensional gradients of wind speed and potential temperature/tracers as a function of the stability parameter</p><p class="math-container">\[\zeta = \frac{z - d}{L},\]</p><p>where <span>$z$</span> is the height above surface, <span>$d$</span> is the displacement height, and <span>$L$</span> is the Obukhov length.</p><p>The module supports three distinct parameterizations:</p><ol><li><strong>Businger</strong>: The classic Businger-Dyer formulations (<a href="https://doi.org/10.1175/1520-0469(1971)028&lt;0181:FPRITA&gt;2.0.CO;2">Businger et al. 1971</a>, <a href="https://doi.org/10.1007/BF00240838">Dyer 1974</a>).</li><li><strong>Gryanik</strong>: Improved functions for the stable boundary layer (<a href="https://doi.org/10.1175/JAS-D-19-0255.1">Gryanik et al. 2020</a>).</li><li><strong>Grachev</strong>: Functions derived from the SHEBA experiment for stable conditions over sea ice (<a href="https://doi.org/10.1007/s10546-007-9177-6">Grachev et al. 2007</a>).</li></ol><h2 id="Mathematical-Framework"><a class="docs-heading-anchor" href="#Mathematical-Framework">Mathematical Framework</a><a id="Mathematical-Framework-1"></a><a class="docs-heading-anchor-permalink" href="#Mathematical-Framework" title="Permalink"></a></h2><p>In MOST, the vertical gradients of mean wind speed (<span>$u$</span>) and potential temperature (<span>$\theta$</span>) are scaled by the friction velocity (<span>$u_*$</span>) and temperature scale (<span>$\theta_*$</span>),</p><p class="math-container">\[\begin{equation}
\frac{\kappa (z-d)}{u_*} \frac{\partial u}{\partial z} = \phi_m(\zeta)
\end{equation}\]</p><p>and</p><p class="math-container">\[\begin{equation}
\frac{\kappa (z-d)}{\theta_*} \frac{\partial \theta}{\partial z} = \phi_h(\zeta),
\end{equation}\]</p><p>where <span>$\phi_m$</span> and <span>$\phi_h$</span> are the universal stability functions for momentum and heat, respectively, and <span>$\kappa \approx 0.4$</span> is the von Kármán constant.</p><h3 id="Neutral-Limits"><a class="docs-heading-anchor" href="#Neutral-Limits">Neutral Limits</a><a id="Neutral-Limits-1"></a><a class="docs-heading-anchor-permalink" href="#Neutral-Limits" title="Permalink"></a></h3><p>A key consistency rule in SurfaceFluxes.jl is how the functions behave at neutral stability (<span>$\zeta = 0$</span>):</p><ul><li><strong>Momentum:</strong> <span>$\phi_m(0) = 1$</span>.</li><li><strong>Heat/Scalars:</strong> <span>$\phi_h(0) = \text{Pr}_0$</span>.<ul><li>For <strong>Businger</strong> and <strong>Gryanik</strong>, <span>$\text{Pr}_0$</span> is a configurable parameter (typically 0.74 or 0.98).</li><li>For <strong>Grachev</strong>, <span>$\text{Pr}_0$</span> is physically 1.0 (matching the derivation in Grachev et al. 2007). In the code, <code>Pr_0</code> is explicitly set to 1.0 by the constructor, but the variable is retained in the equations for structural consistency.</li></ul></li></ul><h3 id="Integrated-Stability-Correction-Functions"><a class="docs-heading-anchor" href="#Integrated-Stability-Correction-Functions">Integrated Stability Correction Functions</a><a id="Integrated-Stability-Correction-Functions-1"></a><a class="docs-heading-anchor-permalink" href="#Integrated-Stability-Correction-Functions" title="Permalink"></a></h3><p>We also define the <strong>integrated stability correction functions</strong> (<span>$\psi$</span>) that define corrections to logarithmic profiles, including their <strong>volume-averaged forms</strong> (<span>$\Psi$</span>) used with finite-volume schemes:</p><ul><li><strong>The function <span>$\psi(\zeta)$</span></strong>: The standard integral form used to correct point profiles (for finite-difference schemes):</li></ul><p class="math-container">\[\begin{equation}
\psi(\zeta) = \int_{0}^{\zeta} \frac{\phi(0) - \phi(x)}{x} dx.
\end{equation}\]</p><p>This function is used to obtain the wind profile:</p><p class="math-container">\[\begin{equation}
u(z) = \frac{u_*}{\kappa} \left[ \ln\left(\frac{z-d}{z_0}\right) - \psi_m(\zeta) + \psi_m(\zeta_0) \right],
\end{equation}\]</p><p>where <span>$\zeta_0 = z_{0m}/L$</span> is the stability parameter at the roughness height <span>$z_{0m}$</span>.</p><p>Similarly, the potential temperature profile is obtained using the heat stability correction function:</p><p class="math-container">\[\begin{equation}
\theta(z) = \theta_0 + \frac{\theta_*}{\kappa}  \left[ \phi_h(0) \ln\left(\frac{z-d}{z_{0h}}\right) - \psi_h(\zeta) + \psi_h(\zeta_0) \right],
\end{equation}\]</p><p>where <span>$\theta_0$</span> is the surface potential temperature, <span>$\zeta_0 = z_{0h}/L$</span> is the stability parameter at the roughness height <span>$z_{0h}$</span>, and <span>$\theta_*$</span> is the temperature scale.</p><div class="admonition is-info"><header class="admonition-header">Neutral Prandtl Number</header><div class="admonition-body"><p>Note the inclusion of <span>$\phi_h(0)$</span> in the logarithmic term for heat and scalars. This accounts for the neutral limit of the non-dimensional gradient, which depends on the parameterization (typically <span>$\phi_h(0) = \text{Pr}_0$</span>, where <span>$\text{Pr}_0 = 1.0$</span> for Grachev).</p></div></div><ul><li><strong>The function <span>$\Psi(\zeta)$</span></strong>: The volume-averaged form required when model variables represent cell averages (in finite-volume schemes) rather than point values (<a href="https://doi.org/10.1029/2018MS001534">Nishizawa &amp; Kitamura, 2018</a>):</li></ul><p class="math-container">\[\begin{equation}
\Psi(\zeta) = \frac{1}{\zeta} \int_{0}^{\zeta} \psi(x) dx.
\end{equation}\]</p><p>For finite-volume schemes, where fluxes are computed using cell-averaged values, this function is used to obtain the vertical profiles. For example, the layer-averaged wind speed is calculated as:</p><p class="math-container">\[\begin{equation}
\bar{u}(z) = \frac{u_*}{\kappa} \left[ \ln\left(\frac{z-d}{z_0}\right) - \Psi_m(\zeta) + \frac{z_0}{\Delta z} \Psi_m(\zeta_0) + \left(1 - \frac{z_0}{\Delta z}\right)(\psi_m(\zeta_0) - 1) \right]
\end{equation}\]</p><p>where <span>$\Delta z = z - d$</span> is the thickness of the first layer.</p><hr/><h2 id=".-Businger-Dyer-Functions"><a class="docs-heading-anchor" href="#.-Businger-Dyer-Functions">1. Businger-Dyer Functions</a><a id=".-Businger-Dyer-Functions-1"></a><a class="docs-heading-anchor-permalink" href="#.-Businger-Dyer-Functions" title="Permalink"></a></h2><p>The Businger parameterization is the standard formulation for the unstable and weakly stable boundary layer. Our implementation follows the forms detailed in <strong><a href="https://doi.org/10.1029/2018MS001534">Nishizawa &amp; Kitamura (2018)</a></strong>, which provides a unified treatment of both stable and unstable conditions.</p><h3 id="Parameter-Structure"><a class="docs-heading-anchor" href="#Parameter-Structure">Parameter Structure</a><a id="Parameter-Structure-1"></a><a class="docs-heading-anchor-permalink" href="#Parameter-Structure" title="Permalink"></a></h3><p>The <code>BusingerParams</code> struct contains:</p><ul><li><code>Pr_0</code>: The neutral Prandtl number</li><li><code>a_m</code>, <code>a_h</code>: Linear coefficients for stable conditions (denoted as <span>$\beta$</span> in some texts)</li><li><code>b_m</code>, <code>b_h</code>: Coefficients inside the unstable sqrt/cbrt terms (denoted as <span>$\gamma$</span> in the unstable forms)</li></ul><h3 id="Unstable-Conditions-(\\zeta-0)"><a class="docs-heading-anchor" href="#Unstable-Conditions-(\\zeta-0)">Unstable Conditions (<span>$\zeta &lt; 0$</span>)</a><a id="Unstable-Conditions-(\\zeta-0)-1"></a><a class="docs-heading-anchor-permalink" href="#Unstable-Conditions-(\\zeta-0)" title="Permalink"></a></h3><p>For unstable conditions, the functions follow the Dyer-Hicks form (<a href="https://doi.org/10.1029/2018MS001534">Nishizawa &amp; Kitamura 2018</a>, Eqs. A1-A2 for <span>$L &lt; 0$</span>), scaled by <span>$\text{Pr}_0$</span> for heat to ensure continuity at <span>$\zeta=0$</span>:</p><p class="math-container">\[\begin{equation}
\phi_m(\zeta) = (1 - b_m \zeta)^{-1/4},
\end{equation}\]</p><p>and</p><p class="math-container">\[\begin{equation}
\phi_h(\zeta) = \text{Pr}_0 (1 - b_h \zeta)^{-1/2},
\end{equation}\]</p><p>where, typically, <span>$b_m=15$</span> and <span>$b_h=9$</span>.</p><p>The corresponding integrated functions (<span>$\psi$</span>) involve logarithmic and arctangent terms (<a href="https://doi.org/10.1029/2018MS001534">Nishizawa &amp; Kitamura 2018</a>, Eqs. A3-A4 for <span>$L &lt; 0$</span>):</p><p class="math-container">\[\begin{equation}
\psi_m(\zeta) = \ln\left[\frac{(1 + x)^2(1 + x^2)}{8}\right] - 2\tan^{-1}(x) + \frac{\pi}{2},
\end{equation}\]</p><p>where <span>$x = (1 - b_m \zeta)^{1/4}$</span>. For heat, the function is scaled by <span>$\text{Pr}_0$</span>:</p><p class="math-container">\[\begin{equation}
\psi_h(\zeta) = 2 \text{Pr}_0 \ln\left(\frac{1 + y}{2}\right),
\end{equation}\]</p><p>where <span>$y = (1 - b_h \zeta)^{1/2}$</span>.</p><h3 id="Stable-Conditions-(\\zeta-\\ge-0)"><a class="docs-heading-anchor" href="#Stable-Conditions-(\\zeta-\\ge-0)">Stable Conditions (<span>$\zeta \ge 0$</span>)</a><a id="Stable-Conditions-(\\zeta-\\ge-0)-1"></a><a class="docs-heading-anchor-permalink" href="#Stable-Conditions-(\\zeta-\\ge-0)" title="Permalink"></a></h3><p>For stable conditions, the Businger-Dyer functions are linear:</p><p class="math-container">\[\begin{equation}
\phi_m(\zeta) = 1 + a_m \zeta
\end{equation}\]</p><p>and</p><p class="math-container">\[\begin{equation}
\phi_h(\zeta) = \text{Pr}_0 + a_h \zeta.
\end{equation}\]</p><div class="admonition is-info"><header class="admonition-header">Neutral Prandtl Number</header><div class="admonition-body"><p>In our implementation, we ensure that the heat functions satisfy the neutral limit <span>$\phi_h(0) = \text{Pr}_0$</span>. This ensures consistency with other parameterizations, such as Gryanik et al. (2020), and proper behavior of the dimensionless profiles.</p></div></div><p>The integrated forms are (<a href="https://doi.org/10.1029/2018MS001534">Nishizawa &amp; Kitamura 2018</a>, Eqs. A3-A4 for <span>$L \ge 0$</span>):</p><p class="math-container">\[\begin{equation}
\psi_m(\zeta) = -a_m \zeta
\end{equation}\]</p><p>and</p><p class="math-container">\[\begin{equation}
\psi_h(\zeta) = -a_h \zeta,
\end{equation}\]</p><p>where in the second equation we have applied the scaling by <span>$\text{Pr}_0$</span> relative to the equations in <a href="https://doi.org/10.1029/2018MS001534">Nishizawa &amp; Kitamura (2018)</a>.</p><h3 id="Volume-Averaged-Forms"><a class="docs-heading-anchor" href="#Volume-Averaged-Forms">Volume-Averaged Forms</a><a id="Volume-Averaged-Forms-1"></a><a class="docs-heading-anchor-permalink" href="#Volume-Averaged-Forms" title="Permalink"></a></h3><p>The volume-averaged functions <span>$\Psi$</span> are implemented for both momentum and heat transport, following <a href="https://doi.org/10.1029/2018MS001534">Nishizawa &amp; Kitamura (2018</a>, Eqs. A5-A6, A13-A14), with heat functions scaled by <span>$\text{Pr}_0$</span>.</p><p><strong>Stable Conditions (<span>$\zeta \ge 0$</span>):</strong></p><p>For stable conditions, the volume-averaged functions reduce to:</p><p class="math-container">\[\begin{equation}
\Psi_m(\zeta) = -\frac{a_m \zeta}{2}
\end{equation}\]</p><p>and</p><p class="math-container">\[\begin{equation}
\Psi_h(\zeta) = -\frac{a_h \zeta}{2}.
\end{equation}\]</p><p><strong>Unstable Conditions (<span>$\zeta &lt; 0$</span>):</strong></p><p>For unstable conditions, computations follow <a href="https://doi.org/10.1029/2018MS001534">Nishizawa &amp; Kitamura (2018</a>, Eqs. A5-A6), with appropriate <span>$\text{Pr}_0$</span> scaling for heat.</p><p>For momentum:</p><p class="math-container">\[\begin{equation}
\Psi_m(\zeta) = \ln\left[\frac{(1 + x)^2(1 + x^2)}{8}\right] - 2\tan^{-1}(x) + \frac{\pi}{2} - 1 + \frac{1 - x^3}{3b_m \zeta/4},
\end{equation}\]</p><p>where <span>$x = (1 - b_m \zeta)^{1/4}$</span>. For small <span>$\zeta$</span>, this reduces to <span>$\Psi_m(\zeta) \approx -b_m \zeta/8$</span> (<a href="https://doi.org/10.1029/2018MS001534">Nishizawa &amp; Kitamura 2018</a>, Eq. A13). We use the linearized form for small <span>$\zeta$</span> to avoid numerical precision issues.</p><p>For heat:</p><p class="math-container">\[\begin{equation}
\Psi_h(\zeta) = \text{Pr}_0 \left[ 2\ln\left(\frac{1 + y}{2}\right) + \frac{2(1 - y)}{b_h \zeta} - 1 \right],
\end{equation}\]</p><p>where <span>$y = (1 - b_h \zeta)^{1/2}$</span>. For small <span>$\zeta$</span>, this reduces to <span>$\Psi_h(\zeta) \approx - \text{Pr}_0 b_h \zeta/4$</span> (<a href="https://doi.org/10.1029/2018MS001534">Nishizawa &amp; Kitamura 2018</a>, Eq. A14, with the scaling by <span>$\text{Pr}_0$</span> applied).</p><hr/><h2 id=".-Gryanik-Universal-Functions"><a class="docs-heading-anchor" href="#.-Gryanik-Universal-Functions">2. Gryanik Universal Functions</a><a id=".-Gryanik-Universal-Functions-1"></a><a class="docs-heading-anchor-permalink" href="#.-Gryanik-Universal-Functions" title="Permalink"></a></h2><p>The <strong><a href="https://doi.org/10.1175/JAS-D-19-0255.1">Gryanik et al. (2020)</a></strong> parameterization is designed to improve surface flux calculations in the <strong>stable boundary layer</strong>. It addresses issues where standard functions underestimate fluxes in very stable conditions.</p><h3 id="Parameter-Structure-2"><a class="docs-heading-anchor" href="#Parameter-Structure-2">Parameter Structure</a><a class="docs-heading-anchor-permalink" href="#Parameter-Structure-2" title="Permalink"></a></h3><p>The <code>GryanikParams</code> struct contains:</p><ul><li><code>Pr_0</code>: Neutral Prandtl number (Grayanik et al. recommend <span>$\text{Pr}_0 \approx 0.98$</span>)</li><li><code>a_m</code>, <code>b_m</code>: Coefficients for momentum stability function</li><li><code>a_h</code>, <code>b_h</code>: Coefficients for heat stability function</li><li><code>b_m_unstable</code>, <code>b_h_unstable</code>: Parameters for unstable branch (automatically set to Businger values)</li></ul><div class="admonition is-info"><header class="admonition-header">Unstable Branch Parameters</header><div class="admonition-body"><p>The unstable branch parameters (<code>b_m_unstable</code> and <code>b_h_unstable</code>) are automatically set to the Businger parameter values to ensure consistency. This means the unstable branches of Gryanik functions use the same coefficients as the Businger formulation and continuously connect to the unstable branch of Businger functions.</p></div></div><h3 id="Stable-Conditions-(\\zeta-0)"><a class="docs-heading-anchor" href="#Stable-Conditions-(\\zeta-0)">Stable Conditions (<span>$\zeta &gt; 0$</span>)</a><a id="Stable-Conditions-(\\zeta-0)-1"></a><a class="docs-heading-anchor-permalink" href="#Stable-Conditions-(\\zeta-0)" title="Permalink"></a></h3><p>Gryanik proposes new forms that remain valid across a wide stability range.</p><p><strong>Momentum (<span>$\phi_m$</span>):</strong></p><p class="math-container">\[\begin{equation}
\phi_m(\zeta) = 1 + \frac{a_m \zeta}{(1 + b_m \zeta)^{2/3}}.
\end{equation}\]</p><p><strong>Heat (<span>$\phi_h$</span>):</strong></p><p class="math-container">\[\begin{equation}
\phi_h(\zeta) = \text{Pr}_0 \left( 1 + \frac{a_h \zeta}{1 + b_h \zeta} \right).
\end{equation}\]</p><p>Note that <span>$\phi_h(0) = \text{Pr}_0$</span> for Gryanik, consistent with our Businger implementation.</p><p><strong>Integrated Corrections (<span>$\psi$</span>):</strong> The code implements the analytical integrals derived in the paper:</p><p class="math-container">\[\begin{equation}
\psi_m(\zeta) = -3 \frac{a_m}{b_m} \left[ (1 + b_m \zeta)^{1/3} - 1 \right],
\end{equation}\]</p><p>and</p><p class="math-container">\[\begin{equation}
\psi_h(\zeta) = -\text{Pr}_0 \frac{a_h}{b_h} \ln(1 + b_h \zeta).
\end{equation}\]</p><p><strong>Volume-Averaged Forms (<span>$\Psi$</span>):</strong> The volume-averaged functions are analytically derived from the <span>$\psi$</span> functions:</p><p class="math-container">\[\begin{equation}
\Psi_m(\zeta) = 3\frac{a_m}{b_m} - \frac{9 a_m}{4 b_m^2 \zeta} \left[ (1 + b_m \zeta)^{4/3} - 1 \right]
\end{equation}\]</p><p>and</p><p class="math-container">\[\begin{equation}
\Psi_h(\zeta) = -\frac{\text{Pr}_0 a_h}{b_h \zeta} \left[ \left(\frac{1}{b_h} + \zeta\right) \ln(1 + b_h \zeta) - \zeta \right].
\end{equation}\]</p><h3 id="Unstable-Conditions-(\\zeta-0)-2"><a class="docs-heading-anchor" href="#Unstable-Conditions-(\\zeta-0)-2">Unstable Conditions (<span>$\zeta &lt; 0$</span>)</a><a class="docs-heading-anchor-permalink" href="#Unstable-Conditions-(\\zeta-0)-2" title="Permalink"></a></h3><p>For the unstable regime, Gryanik et al. (2020) recommend reverting to the standard Businger-Dyer forms to ensure continuity at <span>$\zeta=0$</span>. Our implementation uses the Businger unstable forms with coefficients <code>b_m_unstable</code> and <code>b_h_unstable</code> (which are set to the Businger parameters). The unstable heat function is scaled by <span>$\text{Pr}_0$</span> to ensure a continuous transition at the neutral limit (<span>$\zeta=0$</span>):</p><p class="math-container">\[\begin{equation}
\phi_h(\zeta) = \text{Pr}_0 (1 - b_{h,\text{unstable}} \zeta)^{-1/2}
\end{equation}\]</p><hr/><h2 id=".-Grachev-Universal-Functions"><a class="docs-heading-anchor" href="#.-Grachev-Universal-Functions">3. Grachev Universal Functions</a><a id=".-Grachev-Universal-Functions-1"></a><a class="docs-heading-anchor-permalink" href="#.-Grachev-Universal-Functions" title="Permalink"></a></h2><p>The <strong><a href="https://doi.org/10.1007/s10546-007-9177-6">Grachev et al. (2007)</a></strong> functions were derived from measurements of the <strong>stable atmospheric boundary layer over sea ice</strong> from the SHEBA dataset.</p><h3 id="Parameter-Structure-3"><a class="docs-heading-anchor" href="#Parameter-Structure-3">Parameter Structure</a><a class="docs-heading-anchor-permalink" href="#Parameter-Structure-3" title="Permalink"></a></h3><p>The <code>GrachevParams</code> struct contains:</p><ul><li><code>Pr_0</code>: Neutral Prandtl number (explicitly set to 1.0)</li><li><code>a_m</code>, <code>b_m</code>: Coefficients for momentum stability function</li><li><code>a_h</code>, <code>b_h</code>, <code>c_h</code>: Coefficients for heat stability function (note: <code>c_h</code> is the coefficient for the linear <span>$\zeta$</span> term in the denominator)</li><li><code>b_m_unstable</code>, <code>b_h_unstable</code>: Parameters for unstable branch (automatically set to the Businger parameters)</li></ul><div class="admonition is-info"><header class="admonition-header">Unstable Branch Parameters</header><div class="admonition-body"><p>Similar to Gryanik, the unstable branch parameters are automatically set to the Businger parameters to ensure consistency and continuity at <span>$\zeta=0$</span>.</p></div></div><div class="admonition is-info"><header class="admonition-header">Neutral Prandtl Number</header><div class="admonition-body"><p>For Grachev, <code>Pr_0</code> is explicitly set to <strong>1.0</strong> in the <code>GrachevParams</code> constructor. This matches the physical derivation in Grachev et al. (2007), which assumes <span>$\phi_h(0) = 1$</span>. The code retains the <code>Pr_0</code> variable in the functions for generality, but it will always be 1.0 for this parameterization.</p></div></div><h3 id="Stable-Conditions-(\\zeta-0)-2"><a class="docs-heading-anchor" href="#Stable-Conditions-(\\zeta-0)-2">Stable Conditions (<span>$\zeta &gt; 0$</span>)</a><a class="docs-heading-anchor-permalink" href="#Stable-Conditions-(\\zeta-0)-2" title="Permalink"></a></h3><p><strong>Momentum (<span>$\phi_m$</span>):</strong></p><p class="math-container">\[\begin{equation}
\phi_m(\zeta) = 1 + \frac{a_m \zeta (1 + \zeta)^{1/3}}{1 + b_m \zeta}.
\end{equation}\]</p><p><strong>Heat (<span>$\phi_h$</span>):</strong></p><p class="math-container">\[\begin{equation}
\phi_h(\zeta) = \text{Pr}_0 \left( 1 + \frac{a_h \zeta + b_h \zeta^2}{1 + c_h \zeta + \zeta^2} \right).
\end{equation}\]</p><p><strong>Integrated Corrections (<span>$\psi$</span>):</strong> The integrated forms are complex, involving multiple logarithmic and arctangent terms. See Grachev et al. (2007, Eqs. 12 and 13) for the full derivation.</p><p>For momentum (Grachev et al. 2007, Eq. 12):</p><p class="math-container">\[\begin{equation}
\psi_m(\zeta) = -3\frac{a_m}{b_m}(x - 1) + \frac{a_m B_m}{2 b_m} \left[ 2\ln\left(\frac{x + B_m}{1 + B_m}\right) - \ln\left(\frac{x^2 - x B_m + B_m^2}{1 - B_m + B_m^2}\right) + 2\sqrt{3}\left(\arctan\left(\frac{2x - B_m}{\sqrt{3} B_m}\right) - \arctan\left(\frac{2 - B_m}{\sqrt{3} B_m}\right)\right) \right],
\end{equation}\]</p><p>where <span>$x = (1 + \zeta)^{1/3}$</span> and <span>$B_m = ((1 - b_m)/b_m)^{1/3}$</span>.</p><p>For heat (Grachev et al. 2007, Eq. 13):</p><p class="math-container">\[\begin{equation}
\psi_h(\zeta) = \text{Pr}_0 \left( -\frac{b_h}{2} \ln(1 + c_h \zeta + \zeta^2) + \left[-\frac{a_h}{B_h} + \frac{b_h c_h}{2 B_h}\right] \left[\ln\left(\frac{2\zeta + c_h - B_h}{2\zeta + c_h + B_h}\right) - \ln\left(\frac{c_h - B_h}{c_h + B_h}\right)\right] \right),
\end{equation}\]</p><p>where <span>$B_h = \sqrt{c_h^2 - 4}$</span>. Note that scalar multiplication by <span>$\text{Pr}_0$</span> is applied to the entire result (consistent with the code), though physically <span>$\text{Pr}_0 = 1.0$</span> for this parameterization.</p><h3 id="Unstable-Conditions-(\\zeta-0)-3"><a class="docs-heading-anchor" href="#Unstable-Conditions-(\\zeta-0)-3">Unstable Conditions (<span>$\zeta &lt; 0$</span>)</a><a class="docs-heading-anchor-permalink" href="#Unstable-Conditions-(\\zeta-0)-3" title="Permalink"></a></h3><p>As for the Gryanik parameterization, the Grachev parameterization falls back to the Businger-Dyer forms for unstable conditions, using the <code>b_m_unstable</code> and <code>b_h_unstable</code> parameters. The heat function is scaled by <code>Pr_0</code> (which is 1.0) for consistency with the code structure.</p><div class="admonition is-info"><header class="admonition-header">Volume-Averaged Grachev Function</header><div class="admonition-body"><p>The volume-averaged function <span>$\Psi(\zeta)$</span> is <strong>not implemented</strong> for Grachev due to the lack of closed-form analytical integrals for these complex functions.</p></div></div><hr/><h2 id="Visualization-of-Universal-Functions"><a class="docs-heading-anchor" href="#Visualization-of-Universal-Functions">Visualization of Universal Functions</a><a id="Visualization-of-Universal-Functions-1"></a><a class="docs-heading-anchor-permalink" href="#Visualization-of-Universal-Functions" title="Permalink"></a></h2><p>The following plots compare the behavior of these functions across different stability regimes and reproduce figures from the literature.</p><h3 id="Comparison-with-Gryanik-et-al.-(2020)"><a class="docs-heading-anchor" href="#Comparison-with-Gryanik-et-al.-(2020)">Comparison with Gryanik et al. (2020)</a><a id="Comparison-with-Gryanik-et-al.-(2020)-1"></a><a class="docs-heading-anchor-permalink" href="#Comparison-with-Gryanik-et-al.-(2020)" title="Permalink"></a></h3><p>The following plots reproduce Figures 1 and 2 from Gryanik et al. (2020), showing the behavior of <span>$\phi$</span> and <span>$\psi$</span> in stable conditions.</p><pre><code class="language-julia hljs">include(&quot;plot_universal_functions.jl&quot;)</code></pre><h4 id="Figures-1-and-2:-Stable-Conditions-(Linear-Scale)"><a class="docs-heading-anchor" href="#Figures-1-and-2:-Stable-Conditions-(Linear-Scale)">Figures 1 &amp; 2: Stable Conditions (Linear Scale)</a><a id="Figures-1-and-2:-Stable-Conditions-(Linear-Scale)-1"></a><a class="docs-heading-anchor-permalink" href="#Figures-1-and-2:-Stable-Conditions-(Linear-Scale)" title="Permalink"></a></h4><p><em>Momentum stability function <span>$\phi_m$</span> for stable conditions.</em></p><p><img src="../Gryanik12_phi_m.svg" alt/></p><p><em>Heat stability function <span>$\phi_h$</span> for stable conditions. Note that Gryanik has <span>$\phi_h(0) = \text{Pr}_0 \approx 0.98$</span>.</em></p><p><img src="../Gryanik12_phi_h.svg" alt/></p><p><em>Momentum stability correction function <span>$\psi_m$</span> for stable conditions.</em></p><p><img src="../Gryanik12_psi_m.svg" alt/></p><p><em>Heat stability correction function <span>$\psi_h$</span> for stable conditions.</em></p><p><img src="../Gryanik12_psi_h.svg" alt/></p><h4 id="Figure-3:-Extended-Stability-Range-(Log-Log-Scale)"><a class="docs-heading-anchor" href="#Figure-3:-Extended-Stability-Range-(Log-Log-Scale)">Figure 3: Extended Stability Range (Log-Log Scale)</a><a id="Figure-3:-Extended-Stability-Range-(Log-Log-Scale)-1"></a><a class="docs-heading-anchor-permalink" href="#Figure-3:-Extended-Stability-Range-(Log-Log-Scale)" title="Permalink"></a></h4><p><em>Momentum stability function <span>$\phi_m$</span> over extended stability range (log-log scale).</em></p><p><img src="../Gryanik3_phi_m.svg" alt/></p><p><em>Heat stability function <span>$\phi_h$</span> over extended stability range (log-log scale).</em></p><p><img src="../Gryanik3_phi_h.svg" alt/></p><h3 id="Comparison-with-Businger-(1971)"><a class="docs-heading-anchor" href="#Comparison-with-Businger-(1971)">Comparison with Businger (1971)</a><a id="Comparison-with-Businger-(1971)-1"></a><a class="docs-heading-anchor-permalink" href="#Comparison-with-Businger-(1971)" title="Permalink"></a></h3><p>The classic Businger et al. (1971) curves for <span>$\phi_m$</span> and <span>$\phi_h$</span>, along with the other parameterizations, across both stable and unstable conditions.</p><p><em>Momentum stability functions <span>$\phi_m$</span> for stable and unstable conditions, illustrating continuity across the regimes and convergence of all parameterizations to the Businger-Dyer forms in the unstable regime.</em></p><p><img src="../Businger_phi_m.svg" alt/></p><p><em>Heat stability function <span>$\phi_h$</span> for stable and unstable conditions, illustrating continuity across the regimes and convergence of all parameterizations to the Businger-Dyer forms in the unstable regime.</em></p><p><img src="../Businger_phi_h.svg" alt/></p><h2 id="References"><a class="docs-heading-anchor" href="#References">References</a><a id="References-1"></a><a class="docs-heading-anchor-permalink" href="#References" title="Permalink"></a></h2><ul><li><p>Businger, J. A., Wyngaard, J. C., Izumi, Y., &amp; Bradley, E. F. (1971). Flux-profile relationships in the atmospheric surface layer. <em>Journal of the Atmospheric Sciences</em>, 28, 181-189. <a href="https://doi.org/10.1175/1520-0469(1971)028&lt;0181:FPRITA&gt;2.0.CO;2">DOI: 10.1175/1520-0469(1971)028&lt;0181:FPRITA&gt;2.0.CO;2</a></p></li><li><p>Dyer, A. J. (1974). A review of flux-profile relationships. <em>Boundary-Layer Meteorology</em>, 7, 363-372. <a href="https://doi.org/10.1007/BF00240838">DOI: 10.1007/BF00240838</a></p></li><li><p>Gryanik, V. M., Lüpkes, C., Grachev, A., and Sidorenko, D. (2020). New modified and extended stability functions for the stable boundary layer based on SHEBA and parametrizations of bulk transfer coefficients for climate models. <em>Journal of the Atmospheric Sciences</em>, 77, 2687–2716. <a href="https://doi.org/10.1175/JAS-D-19-0255.1">DOI: 10.1175/JAS-D-19-0255.1</a></p></li><li><p>Grachev, A. A., Andreas, E. L., Fairall, C. W., Guest, P. S., and Persson, P. O. G. (2007). SHEBA flux–profile relationships in the stable atmospheric boundary layer. <em>Boundary-Layer Meteorology</em>, 124, 315–333. <a href="https://doi.org/10.1007/s10546-007-9177-6">DOI: 10.1007/s10546-007-9177-6</a></p></li><li><p>Nishizawa, S., &amp; Kitamura, Y. (2018). A surface flux scheme based on the Monin-Obukhov similarity for finite volume models. <em>Journal of Advances in Modeling Earth Systems</em>, 10, 1-17. <a href="https://doi.org/10.1029/2018MS001534">DOI: 10.1029/2018MS001534</a></p></li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../SurfaceFluxes/">« Surface Fluxes Theory</a><a class="docs-footer-nextpage" href="../PhysicalScales/">Physical Scales »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Wednesday 18 February 2026 21:21">Wednesday 18 February 2026</span>. Using Julia version 1.11.9.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
