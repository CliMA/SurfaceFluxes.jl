<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Universal Functions · SurfaceFluxes.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">SurfaceFluxes.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../API/">API Reference</a></li><li><a class="tocitem" href="../References/">References</a></li><li><a class="tocitem" href="../SurfaceFluxes/">Equations</a></li><li class="is-active"><a class="tocitem" href>Universal Functions</a><ul class="internal"><li><a class="tocitem" href="#Mathematical-Framework"><span>Mathematical Framework</span></a></li><li><a class="tocitem" href="#.-Businger-Dyer-Functions"><span>1. Businger-Dyer Functions</span></a></li><li><a class="tocitem" href="#.-Gryanik-Universal-Functions"><span>2. Gryanik Universal Functions</span></a></li><li><a class="tocitem" href="#.-Grachev-Universal-Functions"><span>3. Grachev Universal Functions</span></a></li><li><a class="tocitem" href="#Visualization-of-Universal-Functions"><span>Visualization of Universal Functions</span></a></li><li><a class="tocitem" href="#Test-Suite"><span>Test Suite</span></a></li><li><a class="tocitem" href="#References"><span>References</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Universal Functions</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Universal Functions</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/CliMA/SurfaceFluxes.jl/blob/main/docs/src/UniversalFunctions.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Universal-Functions-in-SurfaceFluxes.jl"><a class="docs-heading-anchor" href="#Universal-Functions-in-SurfaceFluxes.jl">Universal Functions in SurfaceFluxes.jl</a><a id="Universal-Functions-in-SurfaceFluxes.jl-1"></a><a class="docs-heading-anchor-permalink" href="#Universal-Functions-in-SurfaceFluxes.jl" title="Permalink"></a></h1><p><code>UniversalFunctions.jl</code> provides the stability functions (universal functions) required by Monin-Obukhov Similarity Theory (MOST) to calculate surface fluxes of momentum and heat/tracers. These functions describe the non-dimensional gradients of wind speed and potential temperature/tracers as a function of the stability parameter <span>$\zeta = z/L$</span>, where <span>$z$</span> is height and <span>$L$</span> is the Obukhov length.</p><p>The module supports three distinct parameterizations:</p><ol><li><strong>Businger</strong>: The classic Businger-Dyer formulations (Businger et al. 1971, Dyer 1974).</li><li><strong>Gryanik</strong>: Improved functions for the stable boundary layer (Gryanik et al. 2020).</li><li><strong>Grachev</strong>: Functions derived from the SHEBA experiment for stable conditions over sea ice (Grachev et al. 2007).</li></ol><h2 id="Mathematical-Framework"><a class="docs-heading-anchor" href="#Mathematical-Framework">Mathematical Framework</a><a id="Mathematical-Framework-1"></a><a class="docs-heading-anchor-permalink" href="#Mathematical-Framework" title="Permalink"></a></h2><p>In MOST, the vertical gradients of mean wind speed (<span>$u$</span>) and potential temperature (<span>$\theta$</span>) are scaled by the friction velocity (<span>$u_*$</span>) and temperature scale (<span>$\theta_*$</span>) according to</p><p class="math-container">\[\begin{equation}
\frac{\kappa z}{u_*} \frac{\partial u}{\partial z} = \phi_m(\zeta)
\end{equation}\]</p><p>and</p><p class="math-container">\[\begin{equation}
\frac{\kappa z}{\theta_*} \frac{\partial \theta}{\partial z} = \phi_h(\zeta),
\end{equation}\]</p><p>where <span>$\phi_m$</span> and <span>$\phi_h$</span> are the universal stability functions for momentum and heat, respectively, and <span>$\kappa \approx 0.4$</span> is the von Kármán constant.</p><p>We also define the <strong>integrated stability correction functions</strong> (<span>$\psi$</span>) that define corrections to logarithmic profiles, including their <strong>volume-averaged forms</strong> (<span>$\Psi$</span>) used with finite-volume schemes:</p><ul><li><strong>The function <span>$\psi(\zeta)$</span></strong>: The standard integral form used to correct point profiles (for finite-difference schemes):</li></ul><p class="math-container">\[\begin{equation}
\psi(\zeta) = \int_{0}^{\zeta} \frac{\phi(0) - \phi(x)}{x} dx.
\end{equation}\]</p><p>This function is used to obtain the wind profile:</p><p class="math-container">\[\begin{equation}
\label{eq:windprofile}
u(z) = \frac{u_*}{\kappa} \left[ \ln\left(\frac{z}{z_0}\right) - \psi_m(\zeta) + \psi_m(\zeta_0) \right].
\end{equation}\]</p><p>Similarly, the potential temperature profile is obtained using the heat stability correction function:</p><p class="math-container">\[\begin{equation}
\label{eq:thetaprofile}
\theta(z) = \theta_0 + \frac{\theta_*}{\kappa} \left[ \ln\left(\frac{z}{z_{0h}}\right) - \psi_h(\zeta) + \psi_h(\zeta_0) \right],
\end{equation}\]</p><p>where <span>$\theta_0$</span> is the surface potential temperature, <span>$\theta_*$</span> is the temperature scale, and <span>$z_{0h}$</span> is the roughness length for heat.</p><ul><li><strong>The function <span>$\Psi(\zeta)$</span></strong>: The volume-averaged form required when model variables represent cell averages (in finite-volume schemes) rather than point values (Nishizawa &amp; Kitamura, 2018):</li></ul><p class="math-container">\[\begin{equation}
\Psi(\zeta) = \frac{1}{\zeta} \int_{0}^{\zeta} \psi(x) dx.
\end{equation}\]</p><p>For finite-volume schemes, where fluxes are computed using cell-averaged values, this function is used in lieu of <span>$\psi(\zeta)$</span>.</p><hr/><h2 id=".-Businger-Dyer-Functions"><a class="docs-heading-anchor" href="#.-Businger-Dyer-Functions">1. Businger-Dyer Functions</a><a id=".-Businger-Dyer-Functions-1"></a><a class="docs-heading-anchor-permalink" href="#.-Businger-Dyer-Functions" title="Permalink"></a></h2><p>The Businger parameterization is the standard formulation for the unstable and weakly stable boundary layer. Our implementation follows the forms detailed in <strong>Nishizawa &amp; Kitamura (2018)</strong>, which provides a unified treatment of both stable and unstable conditions.</p><h3 id="Parameter-Structure"><a class="docs-heading-anchor" href="#Parameter-Structure">Parameter Structure</a><a id="Parameter-Structure-1"></a><a class="docs-heading-anchor-permalink" href="#Parameter-Structure" title="Permalink"></a></h3><p>The <code>BusingerParams</code> struct contains:</p><ul><li><code>a_m</code>, <code>a_h</code>: Linear coefficients for stable conditions (denoted as <span>$\beta$</span> in some texts)</li><li><code>b_m</code>, <code>b_h</code>: Coefficients inside the unstable sqrt/cbrt terms (denoted as <span>$\gamma$</span> in the unstable forms)</li><li><code>Pr_0</code>: The neutral Prandtl number</li></ul><h3 id="Unstable-Conditions-(\\zeta-0)"><a class="docs-heading-anchor" href="#Unstable-Conditions-(\\zeta-0)">Unstable Conditions (<span>$\zeta &lt; 0$</span>)</a><a id="Unstable-Conditions-(\\zeta-0)-1"></a><a class="docs-heading-anchor-permalink" href="#Unstable-Conditions-(\\zeta-0)" title="Permalink"></a></h3><p>For unstable conditions, the functions follow the Dyer-Hicks form (Nishizawa &amp; Kitamura 2018, Eqs. A1-A2 for <span>$L &lt; 0$</span>):</p><p class="math-container">\[\begin{equation}
\phi_m(\zeta) = (1 - b_m \zeta)^{-1/4},
\end{equation}\]</p><p>and</p><p class="math-container">\[\begin{equation}
\phi_h(\zeta) = (1 - b_h \zeta)^{-1/2},
\end{equation}\]</p><p>where, typically, <span>$b_m=15$</span> and <span>$b_h=9$</span>.</p><p>The corresponding integrated functions (<span>$\psi$</span>) involve logarithmic and arctangent terms (Nishizawa &amp; Kitamura 2018, Eqs. A3-A4 for <span>$L &lt; 0$</span>):</p><p class="math-container">\[\begin{equation}
\psi_m(\zeta) = \ln\left[\frac{(1 + x)^2(1 + x^2)}{8}\right] - 2\tan^{-1}(x) + \frac{\pi}{2},
\end{equation}\]</p><p>where <span>$x = (1 - b_m \zeta)^{1/4}$</span>, and</p><p class="math-container">\[\begin{equation}
\psi_h(\zeta) = 2\ln\left(\frac{1 + y}{2}\right),
\end{equation}\]</p><p>where <span>$y = (1 - b_h \zeta)^{1/2}$</span>.</p><h3 id="Stable-Conditions-(\\zeta-\\ge-0)"><a class="docs-heading-anchor" href="#Stable-Conditions-(\\zeta-\\ge-0)">Stable Conditions (<span>$\zeta \ge 0$</span>)</a><a id="Stable-Conditions-(\\zeta-\\ge-0)-1"></a><a class="docs-heading-anchor-permalink" href="#Stable-Conditions-(\\zeta-\\ge-0)" title="Permalink"></a></h3><p>For stable conditions, the Businger-Dyer functions are linear (Nishizawa &amp; Kitamura 2018, Eqs. A1-A2 for <span>$L \ge 0$</span>):</p><p class="math-container">\[\begin{equation}
\phi_m(\zeta) = 1 + a_m \zeta
\end{equation}\]</p><p>and</p><p class="math-container">\[\begin{equation}
\phi_h(\zeta) = 1 + \frac{a_h \zeta}{\text{Pr}_0}.
\end{equation}\]</p><p>The integrated forms are (Nishizawa &amp; Kitamura 2018, Eqs. A3-A4 for <span>$L \ge 0$</span>):</p><p class="math-container">\[\begin{equation}
\psi_m(\zeta) = -a_m \zeta
\end{equation}\]</p><p>and</p><p class="math-container">\[\begin{equation}
\psi_h(\zeta) = -\frac{a_h \zeta}{\text{Pr}_0}.
\end{equation}\]</p><h3 id="Volume-Averaged-Forms"><a class="docs-heading-anchor" href="#Volume-Averaged-Forms">Volume-Averaged Forms</a><a id="Volume-Averaged-Forms-1"></a><a class="docs-heading-anchor-permalink" href="#Volume-Averaged-Forms" title="Permalink"></a></h3><p>The volume-averaged functions <span>$\Psi$</span> are implemented for both momentum and heat transport, following Nishizawa &amp; Kitamura (2018, Eqs. A5-A6, A13-A14).</p><p><strong>Stable Conditions (<span>$\zeta \ge 0$</span>):</strong></p><p>For stable conditions, the volume-averaged functions reduce to:</p><p class="math-container">\[\begin{equation}
\Psi_m(\zeta) = -\frac{a_m \zeta}{2}
\end{equation}\]</p><p>and</p><p class="math-container">\[\begin{equation}
\Psi_h(\zeta) = -\frac{a_h \zeta}{2 \text{Pr}_0}.
\end{equation}\]</p><p><strong>Unstable Conditions (<span>$\zeta &lt; 0$</span>):</strong></p><p>For unstable conditions, the volume-averaged functions are more complex (Nishizawa &amp; Kitamura 2018, Eqs. A5-A6 for <span>$L &lt; 0$</span>):</p><p>For momentum:</p><p class="math-container">\[\begin{equation}
\Psi_m(\zeta) = \ln\left[\frac{(1 + x)^2(1 + x^2)}{8}\right] - 2\tan^{-1}(x) + \frac{\pi}{2} - 1 + \frac{1 - x^3}{3b_m \zeta/4},
\end{equation}\]</p><p>where <span>$x = (1 - b_m \zeta)^{1/4}$</span>. For small <span>$\zeta$</span>, this reduces to <span>$\Psi_m(\zeta) \approx -b_m \zeta/8$</span> (Nishizawa &amp; Kitamura 2018, Eq. A13).</p><p>For heat:</p><p class="math-container">\[\begin{equation}
\Psi_h(\zeta) = 2\ln\left(\frac{1 + y}{2}\right) + \frac{2(1 - y)}{b_h \zeta} - 1,
\end{equation}\]</p><p>where <span>$y = (1 - b_h \zeta)^{1/2}$</span>. For small <span>$\zeta$</span>, this reduces to <span>$\Psi_h(\zeta) \approx -b_h \zeta/4$</span> (Nishizawa &amp; Kitamura 2018, Eq. A14).</p><hr/><h2 id=".-Gryanik-Universal-Functions"><a class="docs-heading-anchor" href="#.-Gryanik-Universal-Functions">2. Gryanik Universal Functions</a><a id=".-Gryanik-Universal-Functions-1"></a><a class="docs-heading-anchor-permalink" href="#.-Gryanik-Universal-Functions" title="Permalink"></a></h2><p>The <strong>Gryanik et al. (2020)</strong> parameterization is designed to improve surface flux calculations in the <strong>stable boundary layer</strong>. It addresses issues where standard functions underestimate fluxes in very stable conditions.</p><h3 id="Parameter-Structure-2"><a class="docs-heading-anchor" href="#Parameter-Structure-2">Parameter Structure</a><a class="docs-heading-anchor-permalink" href="#Parameter-Structure-2" title="Permalink"></a></h3><p>The <code>GryanikParams</code> struct contains:</p><ul><li><code>a_m</code>, <code>b_m</code>: Coefficients for momentum stability function</li><li><code>a_h</code>, <code>b_h</code>: Coefficients for heat stability function</li><li><code>Pr_0</code>: Neutral Prandtl number (the paper recommends <span>$\text{Pr}_0 \approx 0.98$</span>)</li><li><code>b_m_unstable</code>, <code>b_h_unstable</code>: Parameters for unstable branch (automatically set from Businger values)</li></ul><div class="admonition is-info"><header class="admonition-header">Unstable Branch Parameters</header><div class="admonition-body"><p>The unstable branch parameters (<code>b_m_unstable</code> and <code>b_h_unstable</code>) are automatically set to the Businger parameter values to ensure consistency. This means the unstable branches of Gryanik functions use the same coefficients as the Businger formulation.</p></div></div><h3 id="Stable-Conditions-(\\zeta-0)"><a class="docs-heading-anchor" href="#Stable-Conditions-(\\zeta-0)">Stable Conditions (<span>$\zeta &gt; 0$</span>)</a><a id="Stable-Conditions-(\\zeta-0)-1"></a><a class="docs-heading-anchor-permalink" href="#Stable-Conditions-(\\zeta-0)" title="Permalink"></a></h3><p>Gryanik proposes new forms that remain valid across the entire stability range.</p><p><strong>Momentum (<span>$\phi_m$</span>):</strong></p><p class="math-container">\[\begin{equation}
\phi_m(\zeta) = 1 + \frac{a_m \zeta}{(1 + b_m \zeta)^{2/3}}.
\end{equation}\]</p><p><strong>Heat (<span>$\phi_h$</span>):</strong></p><p class="math-container">\[\begin{equation}
\phi_h(\zeta) = \text{Pr}_0 \left( 1 + \frac{a_h \zeta}{1 + b_h \zeta} \right)
\end{equation}\]</p><p>Note that <span>$\phi_h(0) = \text{Pr}_0$</span> for Gryanik, unlike Businger where <span>$\phi_h(0) = 1$</span>.</p><p><strong>Integrated Corrections (<span>$\psi$</span>):</strong> The code implements the analytical integrals derived in the paper:</p><p class="math-container">\[\begin{equation}
\psi_m(\zeta) = -3 \frac{a_m}{b_m} \left[ (1 + b_m \zeta)^{1/3} - 1 \right],
\end{equation}\]</p><p>and</p><p class="math-container">\[\begin{equation}
\psi_h(\zeta) = -\text{Pr}_0 \frac{a_h}{b_h} \ln(1 + b_h \zeta).
\end{equation}\]</p><p><strong>Volume-Averaged Forms (<span>$\Psi$</span>):</strong> The volume-averaged functions are analytically derived from the <span>$\psi$</span> functions:</p><p class="math-container">\[\begin{equation}
\Psi_m(\zeta) = 3\frac{a_m}{b_m} - \frac{9 a_m}{4 b_m^2 \zeta} \left[ (1 + b_m \zeta)^{4/3} - 1 \right]
\end{equation}\]</p><p>and</p><p class="math-container">\[\begin{equation}
\Psi_h(\zeta) = -\frac{\text{Pr}_0 a_h}{b_h \zeta} \left[ \left(\frac{1}{b_h} + \zeta\right) \ln(1 + b_h \zeta) - \zeta \right].
\end{equation}\]</p><h3 id="Unstable-Conditions-(\\zeta-0)-2"><a class="docs-heading-anchor" href="#Unstable-Conditions-(\\zeta-0)-2">Unstable Conditions (<span>$\zeta &lt; 0$</span>)</a><a class="docs-heading-anchor-permalink" href="#Unstable-Conditions-(\\zeta-0)-2" title="Permalink"></a></h3><p>For the unstable regime, Gryanik et al. (2020) recommend reverting to the standard Businger-Dyer forms to ensure continuity at <span>$\zeta=0$</span>. Our implementation uses the Businger unstable forms with coefficients <code>b_m_unstable</code> and <code>b_h_unstable</code> (which are set from Businger parameters). The unstable heat function is scaled by <span>$\text{Pr}_0$</span> to ensure a continuous transition at the neutral limit (<span>$\zeta=0$</span>):</p><p class="math-container">\[\begin{equation}
\phi_h(\zeta) = \text{Pr}_0 \cdot \phi_{h,\text{Businger}}(\zeta; b_h = b_{h,\text{unstable}})
\end{equation}\]</p><hr/><h2 id=".-Grachev-Universal-Functions"><a class="docs-heading-anchor" href="#.-Grachev-Universal-Functions">3. Grachev Universal Functions</a><a id=".-Grachev-Universal-Functions-1"></a><a class="docs-heading-anchor-permalink" href="#.-Grachev-Universal-Functions" title="Permalink"></a></h2><p>The <strong>Grachev et al. (2007)</strong> functions were derived from measurements of the <strong>stable atmospheric boundary layer over sea ice</strong> from the SHEBA dataset. </p><h3 id="Parameter-Structure-3"><a class="docs-heading-anchor" href="#Parameter-Structure-3">Parameter Structure</a><a class="docs-heading-anchor-permalink" href="#Parameter-Structure-3" title="Permalink"></a></h3><p>The <code>GrachevParams</code> struct contains:</p><ul><li><code>a_m</code>, <code>b_m</code>: Coefficients for momentum stability function</li><li><code>a_h</code>, <code>b_h</code>, <code>c_h</code>: Coefficients for heat stability function (note: <code>c_h</code> is the coefficient for the linear <span>$\zeta$</span> term in the denominator)</li><li><code>b_m_unstable</code>, <code>b_h_unstable</code>: Parameters for unstable branch (automatically set from Businger values)</li></ul><div class="admonition is-info"><header class="admonition-header">Unstable Branch Parameters</header><div class="admonition-body"><p>Similar to Gryanik, the unstable branch parameters are automatically set from Businger values to ensure consistency.</p></div></div><h3 id="Stable-Conditions-(\\zeta-0)-2"><a class="docs-heading-anchor" href="#Stable-Conditions-(\\zeta-0)-2">Stable Conditions (<span>$\zeta &gt; 0$</span>)</a><a class="docs-heading-anchor-permalink" href="#Stable-Conditions-(\\zeta-0)-2" title="Permalink"></a></h3><p><strong>Momentum (<span>$\phi_m$</span>):</strong></p><p class="math-container">\[\begin{equation}
\phi_m(\zeta) = 1 + \frac{a_m \zeta (1 + \zeta)^{1/3}}{1 + b_m \zeta}.
\end{equation}\]</p><p><strong>Heat (<span>$\phi_h$</span>):</strong></p><p class="math-container">\[\begin{equation}
\phi_h(\zeta) = 1 + \frac{a_h \zeta + b_h \zeta^2}{1 + c_h \zeta + \zeta^2}.
\end{equation}\]</p><p><strong>Integrated Corrections (<span>$\psi$</span>):</strong> The integrated forms are complex, involving multiple logarithmic and arctangent terms. See Grachev et al. (2007, Eqs. 12 and 13) for the full derivation.</p><p>For momentum (Grachev et al. 2007, Eq. 12):</p><p class="math-container">\[\begin{equation}
\psi_m(\zeta) = -3\frac{a_m}{b_m}(x - 1) + \frac{a_m B_m}{2 b_m} \left[ 2\ln\left(\frac{x + B_m}{1 + B_m}\right) - \ln\left(\frac{x^2 - x B_m + B_m^2}{1 - B_m + B_m^2}\right) + 2\sqrt{3}\left(\arctan\left(\frac{2x - B_m}{\sqrt{3} B_m}\right) - \arctan\left(\frac{2 - B_m}{\sqrt{3} B_m}\right)\right) \right],
\end{equation}\]</p><p>where <span>$x = (1 + \zeta)^{1/3}$</span> and <span>$B_m = ((1 - b_m)/b_m)^{1/3}$</span>.</p><p>For heat (Grachev et al. 2007, Eq. 13):</p><p class="math-container">\[\begin{equation}
\psi_h(\zeta) = -\frac{b_h}{2} \ln(1 + c_h \zeta + \zeta^2) + \left[-\frac{a_h}{B_h} + \frac{b_h c_h}{2 B_h}\right] \left[\ln\left(\frac{2\zeta + c_h - B_h}{2\zeta + c_h + B_h}\right) - \ln\left(\frac{c_h - B_h}{c_h + B_h}\right)\right],
\end{equation}\]</p><p>where <span>$B_h = \sqrt{c_h^2 - 4}$</span>.</p><h3 id="Unstable-Conditions-(\\zeta-0)-3"><a class="docs-heading-anchor" href="#Unstable-Conditions-(\\zeta-0)-3">Unstable Conditions (<span>$\zeta &lt; 0$</span>)</a><a class="docs-heading-anchor-permalink" href="#Unstable-Conditions-(\\zeta-0)-3" title="Permalink"></a></h3><p>Similar to Gryanik, the Grachev parameterization falls back to the Businger-Dyer forms for unstable conditions, using the <code>b_m_unstable</code> and <code>b_h_unstable</code> parameters.</p><div class="admonition is-info"><header class="admonition-header">Volume-Averaged Grachev Function</header><div class="admonition-body"><p>The volume-averaged function <span>$\Psi(\zeta)$</span> is <strong>not implemented</strong> for Grachev due to the lack of closed-form analytical integrals for these complex functions.</p></div></div><hr/><h2 id="Visualization-of-Universal-Functions"><a class="docs-heading-anchor" href="#Visualization-of-Universal-Functions">Visualization of Universal Functions</a><a id="Visualization-of-Universal-Functions-1"></a><a class="docs-heading-anchor-permalink" href="#Visualization-of-Universal-Functions" title="Permalink"></a></h2><p>The following plots compare the behavior of these functions across different stability regimes and reproduce figures from the literature.</p><h3 id="Comparison-with-Gryanik-et-al.-(2020)"><a class="docs-heading-anchor" href="#Comparison-with-Gryanik-et-al.-(2020)">Comparison with Gryanik et al. (2020)</a><a id="Comparison-with-Gryanik-et-al.-(2020)-1"></a><a class="docs-heading-anchor-permalink" href="#Comparison-with-Gryanik-et-al.-(2020)" title="Permalink"></a></h3><p>The following plots reproduce Figures 1 and 2 from Gryanik et al. (2020), showing the behavior of <span>$\phi$</span> and <span>$\psi$</span> in stable conditions.</p><pre><code class="language-julia hljs">include(&quot;plot_universal_functions.jl&quot;)</code></pre><h4 id="Figures-1-and-2:-Stable-Conditions-(Linear-Scale)"><a class="docs-heading-anchor" href="#Figures-1-and-2:-Stable-Conditions-(Linear-Scale)">Figures 1 &amp; 2: Stable Conditions (Linear Scale)</a><a id="Figures-1-and-2:-Stable-Conditions-(Linear-Scale)-1"></a><a class="docs-heading-anchor-permalink" href="#Figures-1-and-2:-Stable-Conditions-(Linear-Scale)" title="Permalink"></a></h4><p><em>Momentum stability function <span>$\phi_m$</span> for stable conditions.</em></p><p><img src="../Gryanik12_phi_m.svg" alt/></p><p><em>Heat stability function <span>$\phi_h$</span> for stable conditions. Note that Gryanik has <span>$\phi_h(0) = \text{Pr}_0 \approx 0.98$</span>.</em></p><p><img src="../Gryanik12_phi_h.svg" alt/></p><p><em>Momentum stability correction function <span>$\psi_m$</span> for stable conditions.</em></p><p><img src="../Gryanik12_psi_m.svg" alt/></p><p><em>Heat stability correction function <span>$\psi_h$</span> for stable conditions.</em></p><p><img src="../Gryanik12_psi_h.svg" alt/></p><h4 id="Figure-3:-Extended-Stability-Range-(Log-Log-Scale)"><a class="docs-heading-anchor" href="#Figure-3:-Extended-Stability-Range-(Log-Log-Scale)">Figure 3: Extended Stability Range (Log-Log Scale)</a><a id="Figure-3:-Extended-Stability-Range-(Log-Log-Scale)-1"></a><a class="docs-heading-anchor-permalink" href="#Figure-3:-Extended-Stability-Range-(Log-Log-Scale)" title="Permalink"></a></h4><p><em>Momentum stability function <span>$\phi_m$</span> over extended stability range (log-log scale).</em></p><p><img src="../Gryanik3_phi_m.svg" alt/></p><p><em>Heat stability function <span>$\phi_h$</span> over extended stability range (log-log scale).</em></p><p><img src="../Gryanik3_phi_h.svg" alt/></p><h3 id="Comparison-with-Businger-(1971)"><a class="docs-heading-anchor" href="#Comparison-with-Businger-(1971)">Comparison with Businger (1971)</a><a id="Comparison-with-Businger-(1971)-1"></a><a class="docs-heading-anchor-permalink" href="#Comparison-with-Businger-(1971)" title="Permalink"></a></h3><p>The classic Businger et al. (1971) curves for <span>$\phi_m$</span> and <span>$\phi_h$</span>, along with the other parameterizations, across both stable and unstable conditions.</p><p><em>Momentum stability functions <span>$\phi_m$</span> for stable and unstable conditions, illustrating continuity across the regimes and convergence of all parameterizations to the Businger-Dyer forms in the unstable regime.</em></p><p><img src="../Businger_phi_m.svg" alt/></p><p><em>Heat stability function <span>$\phi_h$</span> for stable and unstable conditions, illustrating continuity across the regimes and convergence of all parameterizations to the Businger-Dyer forms in the unstable regime.</em></p><p><img src="../Businger_phi_h.svg" alt/></p><h3 id="Profile-Recovery-Example"><a class="docs-heading-anchor" href="#Profile-Recovery-Example">Profile Recovery Example</a><a id="Profile-Recovery-Example-1"></a><a class="docs-heading-anchor-permalink" href="#Profile-Recovery-Example" title="Permalink"></a></h3><p>The following figure demonstrates profile recovery using the universal functions, reproducing Figure 6.4 from Bonan (2019). The profiles are computed using the wind and potential temperature profile equations (equations \eqref{eq:windprofile} and \eqref{eq:thetaprofile}) with the <strong>Businger-Dyer parameterization</strong> for both stable and unstable conditions. This shows how the universal functions are used to reconstruct vertical profiles of wind speed and potential temperature from surface flux parameters.</p><p><em>Profile recovery for wind speed (left) and potential temperature (right) under different stability conditions. The figure shows profiles for unstable conditions (LMO = -10, -50, -1000) and stable conditions (LMO = 30, 50, 1000), demonstrating how the universal functions capture the stability dependence of the boundary layer structure.</em></p><p><img src="../Bonan_Fig6-4.svg" alt/></p><hr/><h2 id="Test-Suite"><a class="docs-heading-anchor" href="#Test-Suite">Test Suite</a><a id="Test-Suite-1"></a><a class="docs-heading-anchor-permalink" href="#Test-Suite" title="Permalink"></a></h2><p>The universal functions are thoroughly tested to ensure correctness, numerical stability, and mathematical consistency. The test suite (<code>test/test_universal_functions.jl</code>) verifies the following properties:</p><h3 id="Type-Stability"><a class="docs-heading-anchor" href="#Type-Stability">Type Stability</a><a id="Type-Stability-1"></a><a class="docs-heading-anchor-permalink" href="#Type-Stability" title="Permalink"></a></h3><p><strong>Test:</strong> <code>Type stability</code></p><p>Verifies that all functions return values of the correct floating-point type (<code>Float32</code> or <code>Float64</code>) matching the input parameter type. This is tested across:</p><ul><li>Fine grids covering a wide range of stability parameters (<span>$\zeta$</span> from -2 to 200)</li><li>Values very close to zero (near machine epsilon)</li><li>All parameterizations (Businger, Gryanik, Grachev)</li><li>Both momentum and heat transport</li></ul><h3 id="Neutral-Limit-Behavior"><a class="docs-heading-anchor" href="#Neutral-Limit-Behavior">Neutral Limit Behavior</a><a id="Neutral-Limit-Behavior-1"></a><a class="docs-heading-anchor-permalink" href="#Neutral-Limit-Behavior" title="Permalink"></a></h3><p><strong>Test:</strong> <code>Neutral logarithmic velocity profile</code></p><p>Verifies that in the neutral limit (<span>$L \to \infty$</span>, i.e., <span>$\zeta \to 0$</span>), the velocity profile collapses to the logarithmic law of the wall:</p><p class="math-container">\[\begin{equation}
u(z) = \frac{u_*}{\kappa} \ln\left(\frac{z}{z_0}\right)
\end{equation}\]</p><p>This is tested by using a very large Obukhov length and verifying that the stability correction terms vanish, leaving only the logarithmic term.</p><h3 id="Asymptotic-Behavior"><a class="docs-heading-anchor" href="#Asymptotic-Behavior">Asymptotic Behavior</a><a id="Asymptotic-Behavior-1"></a><a class="docs-heading-anchor-permalink" href="#Asymptotic-Behavior" title="Permalink"></a></h3><p><strong>Test:</strong> <code>Asymptotic behavior (|ζ| → ∞)</code></p><p>For very stable conditions (<span>$\zeta \gg 1$</span>), the functions should approach their asymptotic limits. This test verifies:</p><ul><li><strong>Gryanik</strong>: <span>$\phi_m(\zeta) \sim (a_m/b_m^{2/3}) \zeta^{1/3}$</span> and <span>$\phi_h(\zeta) \sim 1 + (\text{Pr}_0 a_h \zeta)/(1 + b_h \zeta)$</span></li><li><strong>Grachev</strong>: <span>$\phi_m(\zeta) \sim (a_m/b_m) \zeta^{1/3}$</span> and <span>$\phi_h(\zeta) \sim 1 + b_h$</span></li></ul><p>These asymptotic forms are important for very stable boundary layers where standard functions may fail.</p><h3 id="Monotonicity"><a class="docs-heading-anchor" href="#Monotonicity">Monotonicity</a><a id="Monotonicity-1"></a><a class="docs-heading-anchor-permalink" href="#Monotonicity" title="Permalink"></a></h3><p><strong>Test:</strong> <code>Monotonicity of ϕ(ζ)</code></p><p>Verifies that <span>$\phi(\zeta)$</span> is monotonically increasing with <span>$\zeta$</span> across the entire stability range (both stable and unstable). This is a fundamental physical property: as stability increases (larger <span>$\zeta$</span>), the gradient should increase. The test allows for small numerical noise near zero.</p><h3 id="Boundary-Conditions"><a class="docs-heading-anchor" href="#Boundary-Conditions">Boundary Conditions</a><a id="Boundary-Conditions-1"></a><a class="docs-heading-anchor-permalink" href="#Boundary-Conditions" title="Permalink"></a></h3><p><strong>Test:</strong> <code>ψ(0) == 0</code></p><p>Verifies that the integrated stability correction function <span>$\psi$</span> satisfies the boundary condition <span>$\psi(0) = 0$</span>, which is required by the definition:</p><p class="math-container">\[\begin{equation}
\psi(\zeta) = \int_0^{\zeta} \frac{\phi(0) - \phi(x)}{x} dx
\end{equation}\]</p><h3 id="Continuity-at-Neutral-Conditions"><a class="docs-heading-anchor" href="#Continuity-at-Neutral-Conditions">Continuity at Neutral Conditions</a><a id="Continuity-at-Neutral-Conditions-1"></a><a class="docs-heading-anchor-permalink" href="#Continuity-at-Neutral-Conditions" title="Permalink"></a></h3><p><strong>Test:</strong> <code>Neutral continuity (ζ → 0)</code></p><p>Verifies that all functions are continuous at <span>$\zeta = 0$</span>, meaning:</p><ul><li>The limit <span>$\lim_{\zeta \to 0^+} \phi(\zeta) = \lim_{\zeta \to 0^-} \phi(\zeta) = \phi(0)$</span></li><li>The limit <span>$\lim_{\zeta \to 0^+} \psi(\zeta) = \lim_{\zeta \to 0^-} \psi(\zeta) = \psi(0)$</span></li><li>The limit <span>$\lim_{\zeta \to 0^+} \Psi(\zeta) = \lim_{\zeta \to 0^-} \Psi(\zeta) = \Psi(0)$</span> (where implemented)</li></ul><p>This ensures continuous transitions between stable and unstable regimes.</p><h3 id="Derivative-Consistency"><a class="docs-heading-anchor" href="#Derivative-Consistency">Derivative Consistency</a><a id="Derivative-Consistency-1"></a><a class="docs-heading-anchor-permalink" href="#Derivative-Consistency" title="Permalink"></a></h3><p><strong>Test:</strong> <code>Derivative consistency ϕ(ζ) ≈ ϕ(0) - ζ·ψ&#39;(ζ)</code></p><p>Verifies the mathematical relationship between <span>$\phi$</span> and <span>$\psi$</span>:</p><p class="math-container">\[\begin{equation}
\phi(\zeta) = \phi(0) - \zeta \cdot \frac{d\psi}{d\zeta}
\end{equation}\]</p><p>This is tested using finite-difference approximations of <span>$\psi&#39;(\zeta)$</span> and comparing against the analytical <span>$\phi(\zeta)$</span>. This relationship follows from the definition of <span>$\psi$</span> and ensures internal consistency of the implementation.</p><h3 id="Integral-Consistency"><a class="docs-heading-anchor" href="#Integral-Consistency">Integral Consistency</a><a id="Integral-Consistency-1"></a><a class="docs-heading-anchor-permalink" href="#Integral-Consistency" title="Permalink"></a></h3><p><strong>Test:</strong> <code>Integral consistency ψ(ζ) = ∫(ϕ(0)-ϕ)/ζ′ dζ′</code></p><p>Verifies that the analytical implementation of <span>$\psi(\zeta)$</span> matches the integral definition:</p><p class="math-container">\[\begin{equation}
\psi(\zeta) = \int_{\epsilon}^{\zeta} \frac{\phi(0) - \phi(x)}{x} dx.
\end{equation}\]</p><p>This is tested using numerical quadrature (Gauss-Kronrod) to compute the integral and comparing against the analytical <span>$\psi$</span> function. This ensures that the analytical integrals derived in the papers are correctly implemented.</p><h3 id="Small-\\zeta-Linearization"><a class="docs-heading-anchor" href="#Small-\\zeta-Linearization">Small-<span>$\zeta$</span> Linearization</a><a id="Small-\\zeta-Linearization-1"></a><a class="docs-heading-anchor-permalink" href="#Small-\\zeta-Linearization" title="Permalink"></a></h3><p><strong>Test:</strong> <code>Small-ζ Linearization Consistency</code></p><p>For very small <span>$\zeta$</span>, the volume-averaged function <span>$\Psi$</span> should satisfy:</p><p class="math-container">\[\begin{equation}
\lim_{\zeta \to 0} \frac{\Psi(\zeta)}{\zeta} = -\frac{\phi&#39;(0)}{2}
\end{equation}\]</p><p>This test verifies that the linear approximations used near zero in the <span>$\Psi$</span> implementations are consistent with the theoretical slope derived from the <span>$\phi$</span> parameters. This is important for numerical stability when <span>$\zeta$</span> is very close to zero.</p><hr/><h2 id="References"><a class="docs-heading-anchor" href="#References">References</a><a id="References-1"></a><a class="docs-heading-anchor-permalink" href="#References" title="Permalink"></a></h2><ul><li><p>Businger, J. A., Wyngaard, J. C., Izumi, Y., &amp; Bradley, E. F. (1971). Flux-profile relationships in the atmospheric surface layer. <em>Journal of the Atmospheric Sciences</em>, 28, 181-189. <a href="https://doi.org/10.1175/1520-0469(1971)028&lt;0181:FPRITA&gt;2.0.CO;2">https://doi.org/10.1175/1520-0469(1971)028&lt;0181:FPRITA&gt;2.0.CO;2</a></p></li><li><p>Dyer, A. J. (1974). A review of flux-profile relationships. <em>Boundary-Layer Meteorology</em>, 7, 363-372. <a href="https://doi.org/10.1007/BF00240838">https://doi.org/10.1007/BF00240838</a></p></li><li><p>Gryanik, V. M., Lüpkes, C., Grachev, A., and Sidorenko, D. (2020). New modified and extended stability functions for the stable boundary layer based on SHEBA and parametrizations of bulk transfer coefficients for climate models. <em>Journal of the Atmospheric Sciences</em>, 77, 2687–2716. <a href="https://doi.org/10.1175/JAS-D-19-0255.1">https://doi.org/10.1175/JAS-D-19-0255.1</a></p></li><li><p>Grachev, A. A., Andreas, E. L., Fairall, C. W., Guest, P. S., and Persson, P. O. G. (2007). SHEBA flux–profile relationships in the stable atmospheric boundary layer. <em>Boundary-Layer Meteorology</em>, 124, 315–333. <a href="https://doi.org/10.1007/s10546-007-9177-6">https://doi.org/10.1007/s10546-007-9177-6</a></p></li><li><p>Nishizawa, S., &amp; Kitamura, Y. (2018). A surface flux scheme based on the Monin-Obukhov similarity for finite volume models. <em>Journal of Advances in Modeling Earth Systems</em>, 10, 1-17. <a href="https://doi.org/10.1029/2018MS001534">https://doi.org/10.1029/2018MS001534</a></p></li><li><p>Bonan, G. (2019). <em>Climate Change and Terrestrial Ecosystem Modeling</em>. Cambridge University Press. ISBN: 978-1-107-04378-7</p></li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../SurfaceFluxes/">« Equations</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Monday 1 December 2025 04:02">Monday 1 December 2025</span>. Using Julia version 1.11.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
