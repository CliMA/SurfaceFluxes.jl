<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Prescribed Conditions · SurfaceFluxes.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="SurfaceFluxes.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">SurfaceFluxes.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../SurfaceFluxes/">Surface Fluxes Theory</a></li><li><a class="tocitem" href="../UniversalFunctions/">Universal Functions</a></li><li><a class="tocitem" href="../PhysicalScales/">Physical Scales</a></li><li><a class="tocitem" href="../ExchangeFluxes/">Exchange Fluxes</a></li><li class="is-active"><a class="tocitem" href>Prescribed Conditions</a><ul class="internal"><li><a class="tocitem" href="#Flux-Specification"><span>Flux Specification</span></a></li><li><a class="tocitem" href="#Operating-Modes"><span>Operating Modes</span></a></li><li><a class="tocitem" href="#State-Callbacks"><span>State Callbacks</span></a></li></ul></li><li><a class="tocitem" href="../TestSuite/">Test Suite</a></li><li><a class="tocitem" href="../API/">API Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Prescribed Conditions</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Prescribed Conditions</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/CliMA/SurfaceFluxes.jl/blob/main/docs/src/PrescribedConditions.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Prescribed-Conditions"><a class="docs-heading-anchor" href="#Prescribed-Conditions">Prescribed Conditions</a><a id="Prescribed-Conditions-1"></a><a class="docs-heading-anchor-permalink" href="#Prescribed-Conditions" title="Permalink"></a></h1><p>SurfaceFluxes.jl supports flexible operating modes for specifying boundary conditions. While the default behavior is to solve for the surface fluxes iteratively using Monin-Obukhov Similarity Theory (MOST) given the temperature and humidity at the surface, users can also prescribe specific fluxes or exchange coefficients. It is also possible to compute the surface temperature and humidity interactively via callbacks. This is particularly useful for:</p><ul><li>Driving models with observed fluxes.</li><li>Coupling to components that compute their own exchange coefficients (e.g., wave models).</li><li>Determining skin temperature over land/ice and implementing moisture limitations on evaporation.</li><li>Idealized experiments with fixed boundary conditions.</li></ul><h2 id="Flux-Specification"><a class="docs-heading-anchor" href="#Flux-Specification">Flux Specification</a><a id="Flux-Specification-1"></a><a class="docs-heading-anchor-permalink" href="#Flux-Specification" title="Permalink"></a></h2><p>The operating mode is controlled by the optional <code>flux_specs</code> argument in <a href="../API/#SurfaceFluxes.surface_fluxes"><code>surface_fluxes</code></a>. This argument accepts a <a href="../API/#SurfaceFluxes.FluxSpecs"><code>FluxSpecs</code></a> struct, which acts as a container for prescribed quantities:</p><pre><code class="language-julia hljs">FluxSpecs(shf=..., lhf=..., ustar=..., Cd=..., Ch=...)</code></pre><table><tr><th style="text-align: left">Field</th><th style="text-align: left">Symbol</th><th style="text-align: left">Description</th><th style="text-align: left">Units</th></tr><tr><td style="text-align: left"><code>shf</code></td><td style="text-align: left"><span>$H$</span></td><td style="text-align: left">Sensible Heat Flux</td><td style="text-align: left"><span>$\mathrm{W~m^{-2}}$</span></td></tr><tr><td style="text-align: left"><code>lhf</code></td><td style="text-align: left"><span>$LE$</span></td><td style="text-align: left">Latent Heat Flux</td><td style="text-align: left"><span>$\mathrm{W~m^{-2}}$</span></td></tr><tr><td style="text-align: left"><code>ustar</code></td><td style="text-align: left"><span>$u_*$</span></td><td style="text-align: left">Friction Velocity</td><td style="text-align: left"><span>$\mathrm{m~s^{-1}}$</span></td></tr><tr><td style="text-align: left"><code>Cd</code></td><td style="text-align: left"><span>$C_d$</span></td><td style="text-align: left">Momentum Exchange Coefficient</td><td style="text-align: left">-</td></tr><tr><td style="text-align: left"><code>Ch</code></td><td style="text-align: left"><span>$C_h$</span></td><td style="text-align: left">Heat Exchange Coefficient</td><td style="text-align: left">-</td></tr></table><p>The solver detects which combination of parameters is provided and dispatches to the appropriate routine.</p><h2 id="Operating-Modes"><a class="docs-heading-anchor" href="#Operating-Modes">Operating Modes</a><a id="Operating-Modes-1"></a><a class="docs-heading-anchor-permalink" href="#Operating-Modes" title="Permalink"></a></h2><h3 id=".-Iterative-Solver-(Standard-MOST)"><a class="docs-heading-anchor" href="#.-Iterative-Solver-(Standard-MOST)">1. Iterative Solver (Standard MOST)</a><a id=".-Iterative-Solver-(Standard-MOST)-1"></a><a class="docs-heading-anchor-permalink" href="#.-Iterative-Solver-(Standard-MOST)" title="Permalink"></a></h3><ul><li><strong>Inputs:</strong> Surface state (<span>$T_s, q_s, \mathbf{u}_s$</span>) and Atmospheric state (<span>$T_a, q_a, \mathbf{u}_a, z, d$</span>).</li><li><strong>Unknowns:</strong> Fluxes (<span>$H, LE, \boldsymbol{\tau}$</span>), Coefficients (<span>$C_d, C_h$</span>), Stability (<span>$\zeta$</span>).</li></ul><p>This is the default mode when <code>flux_specs</code> is empty or <code>nothing</code>. The solver iterates to find the Monin-Obukhov stability parameter <span>$\zeta$</span> that satisfies the similarity relations.</p><pre><code class="language-julia hljs"># Standard call (positional arguments)
conditions = surface_fluxes(param_set, T_int, ..., u_sfc, ...)</code></pre><div class="admonition is-info"><header class="admonition-header">Simplified Examples</header><div class="admonition-body"><p>The examples below use simplified syntax (e.g., <code>flux_specs=...</code>) for clarity. In the actual API, <a href="../API/#SurfaceFluxes.surface_fluxes"><code>surface_fluxes</code></a> uses positional arguments. Users must provide all preceding arguments or use <code>nothing</code> for optional inputs. See the <a href="../API/">API Reference</a> for the exact signature.</p></div></div><h3 id=".-Prescribed-Coefficients"><a class="docs-heading-anchor" href="#.-Prescribed-Coefficients">2. Prescribed Coefficients</a><a id=".-Prescribed-Coefficients-1"></a><a class="docs-heading-anchor-permalink" href="#.-Prescribed-Coefficients" title="Permalink"></a></h3><ul><li><strong>Inputs:</strong> Coefficients (<span>$C_d, C_h$</span>).</li><li><strong>Unknowns:</strong> Fluxes (<span>$H, LE, \boldsymbol{\tau}$</span>).</li></ul><p>When both <code>Cd</code> and <code>Ch</code> are prescribed, the fluxes are computed directly from the bulk aerodynamic formulas without iteration. This is typical when coefficients are diagnosed by an external parameterization (e.g., a wave model).</p><pre><code class="language-julia hljs">specs = FluxSpecs(Cd = 1.2e-3, Ch = 1.2e-3)
conditions = surface_fluxes(param_set, ..., flux_specs=specs)</code></pre><h3 id=".-Fully-Prescribed-Fluxes"><a class="docs-heading-anchor" href="#.-Fully-Prescribed-Fluxes">3. Fully Prescribed Fluxes</a><a id=".-Fully-Prescribed-Fluxes-1"></a><a class="docs-heading-anchor-permalink" href="#.-Fully-Prescribed-Fluxes" title="Permalink"></a></h3><ul><li><strong>Inputs:</strong> Fluxes (<span>$H, LE$</span>) and Friction Velocity (<span>$u_*$</span>).</li><li><strong>Unknowns:</strong> Stability (<span>$\zeta$</span>), Coefficients (<span>$C_d, C_h$</span>).</li></ul><p>When <code>shf</code>, <code>lhf</code>, and <code>ustar</code> are all provided, the solver bypasses the flux calculation. It uses the prescribed values to:</p><ol><li>Compute the Monin-Obukhov length <span>$L$</span>.</li><li>Diagnose the stability parameter <span>$\zeta = z/L$</span>.</li><li>Back-calculate the exchange coefficients consistent with these fluxes.</li></ol><pre><code class="language-julia hljs">specs = FluxSpecs(shf = 20.0, lhf = 100.0, ustar = 0.3)
conditions = surface_fluxes(param_set, ..., flux_specs=specs)</code></pre><h3 id=".-Prescribed-Heat-Fluxes-and-Drag-Coefficient"><a class="docs-heading-anchor" href="#.-Prescribed-Heat-Fluxes-and-Drag-Coefficient">4. Prescribed Heat Fluxes and Drag Coefficient</a><a id=".-Prescribed-Heat-Fluxes-and-Drag-Coefficient-1"></a><a class="docs-heading-anchor-permalink" href="#.-Prescribed-Heat-Fluxes-and-Drag-Coefficient" title="Permalink"></a></h3><ul><li><strong>Inputs:</strong> Fluxes (<span>$H, LE$</span>) and Drag Coefficient (<span>$C_d$</span>).</li><li><strong>Unknowns:</strong> Friction Velocity (<span>$u_*$</span>), Stability (<span>$\zeta$</span>).</li></ul><p>When <code>shf</code>, <code>lhf</code>, and <code>Cd</code> are provided (but not <code>ustar</code>):</p><ol><li>Friction velocity is derived from the drag law: <span>$u_* = \sqrt{C_d} U_{\text{eff}}$</span>.</li><li>Stability <span>$\zeta$</span> is computed from the fluxes and the derived <span>$u_*$</span>.</li></ol><pre><code class="language-julia hljs">specs = FluxSpecs(shf = 50.0, lhf = 150.0, Cd = 1.5e-3)
conditions = surface_fluxes(param_set, ..., flux_specs=specs)</code></pre><h2 id="State-Callbacks"><a class="docs-heading-anchor" href="#State-Callbacks">State Callbacks</a><a id="State-Callbacks-1"></a><a class="docs-heading-anchor-permalink" href="#State-Callbacks" title="Permalink"></a></h2><p>In coupled systems, the surface state (e.g., skin temperature <span>$T_s$</span>) may respond rapidly to the surface fluxes. To ensure consistency without external fixed-point iteration, <a href="../API/#SurfaceFluxes.surface_fluxes"><code>surface_fluxes</code></a> accepts callback functions that update the surface state <em>within</em> the MOST iteration loop.</p><pre><code class="language-julia hljs"># Update Ts based on current flux guess
function update_Ts(T_sfc, local_geometry, surface_fluxes_conditions)
    # ... physics to update skin temperature ...
    return new_T_sfc
end

conditions = surface_fluxes(..., update_T_sfc=update_Ts)</code></pre><p>Available callbacks:</p><ul><li><code>update_T_sfc</code>: Updates surface temperature.</li><li><code>update_q_vap_sfc</code>: Updates surface specific humidity.</li></ul><p>This mechanism ensures that the final fluxes and surface state are in equilibrium with respect to the surface energy/moisture balance.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../ExchangeFluxes/">« Exchange Fluxes</a><a class="docs-footer-nextpage" href="../TestSuite/">Test Suite »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Saturday 17 January 2026 01:51">Saturday 17 January 2026</span>. Using Julia version 1.11.8.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
